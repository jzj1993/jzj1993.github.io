<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/logo-128.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/logo-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/logo-16.png">
  <link rel="mask-icon" href="/images/logo-128.png" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.paincker.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="说明 本文主要从实现原理和代码层面介绍Gradle开发相关知识。关于本文中提到的、Gradle中的基本概念等内容，可参考">
<meta property="og:type" content="article">
<meta property="og:title" content="Gradle开发快速入门——DSL语法原理与常用API介绍">
<meta property="og:url" content="https://www.paincker.com/gradle-develop-basics/">
<meta property="og:site_name" content="Paincker">
<meta property="og:description" content="说明 本文主要从实现原理和代码层面介绍Gradle开发相关知识。关于本文中提到的、Gradle中的基本概念等内容，可参考">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://www.paincker.com/gradle-develop-basics/img/http://docs.groovy-lang.org/latest/html/documentation/assets/img/GroovyInterceptions.png">
<meta property="article:published_time" content="2017-09-08T12:27:40.000Z">
<meta property="article:modified_time" content="2022-05-22T16:49:30.969Z">
<meta property="article:author" content="jzj1993">
<meta property="article:tag" content="Android">
<meta property="article:tag" content="安卓">
<meta property="article:tag" content="移动开发">
<meta property="article:tag" content="编程">
<meta property="article:tag" content="Gradle">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.paincker.com/gradle-develop-basics/img/http://docs.groovy-lang.org/latest/html/documentation/assets/img/GroovyInterceptions.png">

<link rel="canonical" href="https://www.paincker.com/gradle-develop-basics/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Gradle开发快速入门——DSL语法原理与常用API介绍 | Paincker</title>
  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?01cb9081555fb604776b223fe01db45d";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Paincker</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">273</span></a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">111</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">6</span></a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.paincker.com/gradle-develop-basics/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="jzj1993">
      <meta itemprop="description" content="江子健的个人博客，90后理工男、微软程序员、互联网从业者，分享软件编程、开发技术、学习与思考">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Paincker">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Gradle开发快速入门——DSL语法原理与常用API介绍
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-09-08 20:27:40" itemprop="dateCreated datePublished" datetime="2017-09-08T20:27:40+08:00">2017-09-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/develop/" itemprop="url" rel="index"><span itemprop="name">开发技术</span></a>
                </span>
            </span>

          
            <span id="/gradle-develop-basics/" class="post-meta-item leancloud_visitors" data-flag-title="Gradle开发快速入门——DSL语法原理与常用API介绍" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/gradle-develop-basics/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/gradle-develop-basics/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>31k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>28 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="说明">说明</h2>
<p>本文主要从实现原理和代码层面介绍Gradle开发相关知识。关于本文中提到的、Gradle中的基本概念等内容，可参考</p>
<blockquote>
<p>Android Gradle配置快速入门 <a href="http://www.paincker.com/android-gradle-basics">http://www.paincker.com/android-gradle-basics</a></p>
</blockquote>
<p>本文配套示例工程</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/jzj1993/GradleStudy">https://github.com/jzj1993/GradleStudy</a></p>
</blockquote>
<h2 id="Groovy语言简介">Groovy语言简介</h2>
<p>Groovy语言的特性很多很复杂，这里先介绍一些Gradle脚本中常用到的Groovy语言基础。</p>
<p>Groovy是一种开源的脚本语言，在Java基础上进行了扩展，支持闭包、动态类型、元编程等特性，几乎兼容所有Java语法。因此很容易用Groovy实现领域特定语言(DSL, Domain-Specific Language)。</p>
<blockquote>
<p>Apache Groovy is a powerful, optionally typed and dynamic language, with static-typing and static compilation capabilities, for the Java platform aimed at improving developer productivity thanks to a concise, familiar and easy to learn syntax. It integrates smoothly with any Java program, and immediately delivers to your application powerful features, including scripting capabilities, Domain-Specific Language authoring, runtime and compile-time meta-programming and functional programming.</p>
</blockquote>
<p>官方网站、文档、源码</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://groovy-lang.org/">http://groovy-lang.org/</a> <a target="_blank" rel="noopener" href="http://groovy-lang.org/documentation.html">http://groovy-lang.org/documentation.html</a> <a target="_blank" rel="noopener" href="https://github.com/apache/groovy">https://github.com/apache/groovy</a></p>
</blockquote>
<h3 id="HelloWorld">HelloWorld</h3>
<p>和所有解释性语言一样，Groovy可以从源文件直接运行。而实际执行过程，也是先转换成class文件，再运行在JVM上。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装groovy(Mac系统)</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> brew install groovy</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建Groovy脚本。Groovy语句末尾分号可省略。</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">echo</span> <span class="string">&#x27;println &quot;hello groovy!&quot;&#x27;</span> &gt; hello.groovy</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 运行Groovy脚本</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> groovy hello.groovy</span></span><br><span class="line">hello groovy!</span><br></pre></td></tr></table></figure>
<p>在Unix/Linux系统中，同样可以给Groovy脚本第一行加上<code>shebang line</code>，表示这个文件应该用groovy解释器执行。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env groovy</span></span><br><span class="line">println <span class="string">&quot;hello groovy!&quot;</span></span><br></pre></td></tr></table></figure>
<h3 id="GroovyObject，Script">GroovyObject，Script</h3>
<p>Groovy提供了一个groovyc命令，可将groovy文件转化成class文件。再用JD-GUI或其他工具打开class，就可以看到Java代码。</p>
<p>创建一个groovy脚本如下，第一行打印字符串，第二行声明了一个类。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">println <span class="string">&quot;hello groovy!&quot;</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> &#123;</span>&#125;</span><br></pre></td></tr></table></figure>
<p>用groovyc对其编译，会生成两个class。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">echo</span> <span class="string">&#x27;println &quot;hello groovy!&quot;\nclass Test &#123;&#125;&#x27;</span> &gt; hello.groovy</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> groovyc hello.groovy</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ls</span></span><br><span class="line">Test.class   hello.class  hello.groovy</span><br></pre></td></tr></table></figure>
<p>分别反编译成Java代码如下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> groovy.lang.GroovyObject;</span><br><span class="line"><span class="keyword">import</span> groovy.lang.MetaClass;</span><br><span class="line"><span class="keyword">import</span> org.codehaus.groovy.runtime.callsite.CallSite;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> <span class="keyword">implements</span> <span class="title">GroovyObject</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Test <span class="keyword">this</span>;</span><br><span class="line">        CallSite[] arrayOfCallSite = $getCallSiteArray();</span><br><span class="line">        MetaClass localMetaClass = $getStaticMetaClass();</span><br><span class="line">        <span class="keyword">this</span>.metaClass = localMetaClass;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> groovy.lang.Binding;</span><br><span class="line"><span class="keyword">import</span> groovy.lang.Script;</span><br><span class="line"><span class="keyword">import</span> org.codehaus.groovy.runtime.InvokerHelper;</span><br><span class="line"><span class="keyword">import</span> org.codehaus.groovy.runtime.callsite.CallSite;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">hello</span> <span class="keyword">extends</span> <span class="title">Script</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">hello</span><span class="params">(Binding context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String... args)</span> </span>&#123;</span><br><span class="line">        CallSite[] arrayOfCallSite = $getCallSiteArray();</span><br><span class="line">        arrayOfCallSite[<span class="number">0</span>].call(InvokerHelper.class, hello.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        CallSite[] arrayOfCallSite = $getCallSiteArray();</span><br><span class="line">        <span class="keyword">return</span> arrayOfCallSite[<span class="number">1</span>].callCurrent(<span class="keyword">this</span>, <span class="string">&quot;hello groovy!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以总结一些特点：</p>
<ol>
<li>Groovy中的所有类最终都会实现<code>groovy.lang.GroovyObject</code>接口。</li>
<li>除了显式定义的类，在Groovy文件中的脚本代码，会生成一个继承自<code>groovy.lang.Script</code>的Java类，这个类也实现了GroovyObject接口。</li>
</ol>
<h3 id="动态类型">动态类型</h3>
<p>Groovy定义变量时：可以用Groovy风格的def声明，不指定类型；也可以兼容Java风格，指定变量类型；甚至还可以省略def或类型。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> t1 = <span class="string">&#x27;t1&#x27;</span></span><br><span class="line">String t2 = <span class="string">&#x27;t2&#x27;</span></span><br><span class="line">t3 = <span class="string">&#x27;t3&#x27;</span></span><br></pre></td></tr></table></figure>
<p>Groovy风格定义的变量类型是动态的，编译成class时会自动转换成正确的Java类型。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> var = <span class="string">&#x27;text&#x27;</span></span><br><span class="line">println var</span><br><span class="line">var = <span class="number">5</span></span><br><span class="line">println var + <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>可用Java实现类似效果如下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Object o = <span class="string">&quot;text&quot;</span>;</span><br><span class="line">System.out.println(String.valueOf(o));</span><br><span class="line">o = <span class="number">5</span>;</span><br><span class="line">System.out.println(String.valueOf(Integer.valueOf(o) + <span class="number">1</span>));</span><br></pre></td></tr></table></figure>
<h3 id="字符串">字符串</h3>
<p>Groovy支持灵活的字符串语法，例如：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 单引号字符串</span></span><br><span class="line"><span class="keyword">def</span> a = <span class="string">&#x27;hello &quot;world&quot;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 双引号字符串</span></span><br><span class="line"><span class="keyword">def</span> b = <span class="string">&quot;What&#x27;s the weather like?&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 用加号连接字符串，用等号对比字符串</span></span><br><span class="line"><span class="keyword">assert</span> <span class="string">&#x27;ab&#x27;</span> == <span class="string">&#x27;a&#x27;</span> + <span class="string">&#x27;b&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 三个单引号字符串，支持直接换行</span></span><br><span class="line"><span class="keyword">def</span> aMultilineString = <span class="string">&#x27;&#x27;&#x27;line one</span></span><br><span class="line"><span class="string">line two</span></span><br><span class="line"><span class="string">line three&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 斜线字符串中，反斜线不需要转义，常用于正则表达式</span></span><br><span class="line"><span class="keyword">def</span> fooPattern = <span class="regexp">/.*foo.*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 双引号字符串支持用$嵌入变量</span></span><br><span class="line"><span class="keyword">def</span> name = <span class="string">&#x27;Tom&#x27;</span></span><br><span class="line"><span class="keyword">def</span> greeting = <span class="string">&quot;Hello $&#123;name&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 如需函数调用，则$后表达式要加大括号</span></span><br><span class="line"><span class="keyword">def</span> pi = <span class="number">3.14</span></span><br><span class="line"><span class="keyword">def</span> piString = <span class="string">&quot;Pi = $&#123;pi.toString()&#125;&quot;</span></span><br></pre></td></tr></table></figure>
<h3 id="闭包-Closure">闭包 (Closure)</h3>
<p>闭包是一个变量，又是一个函数，类似C语言中的函数指针，或者Java中只有一个方法的接口（Runnable等）。</p>
<p>反编译class文件可以看出，Groovy闭包都会转化为继承<code>groovy.lang.Closure</code>的类。</p>
<p>闭包方法的参数用箭头定义，如果不特殊指定，则默认有一个<code>it</code>参数。</p>
<p>闭包方法的返回值可以用return显示指定，如果不指定则使用最后一条语句的值。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> c1 = &#123;</span><br><span class="line">    println <span class="string">&#x27;hello&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">def</span> c2 = &#123; a, b -&gt;</span><br><span class="line">    println a</span><br><span class="line">    println b</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">def</span> c3 = &#123; <span class="keyword">int</span> a, String b -&gt;</span><br><span class="line">    println a</span><br><span class="line">    println b</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">def</span> c4 = &#123; -&gt;</span><br><span class="line">    println <span class="string">&#x27;hello&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">def</span> c5 = &#123;</span><br><span class="line">    println it</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">def</span> c6 = &#123;</span><br><span class="line"><span class="keyword">return</span> it + <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">def</span> c7 = &#123;</span><br><span class="line">it + <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>闭包调用可以用call，也可以直接像Java方法一样加括号调用。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> c = &#123;</span><br><span class="line">    println it</span><br><span class="line">&#125;</span><br><span class="line">c.call(<span class="string">&#x27;text1&#x27;</span>)</span><br><span class="line">c(<span class="string">&#x27;text2&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>Java实现闭包效果：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">MyClosure</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(Object o)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line">MyClosure c = <span class="keyword">new</span> MyClosure() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">call</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        System.out.println(String.valueOf(o));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">c.call(<span class="string">&quot;text&quot;</span>);</span><br></pre></td></tr></table></figure>
<h3 id="方法-闭包的定义与调用">方法/闭包的定义与调用</h3>
<p>Groovy中定义方法既可以用Groovy闭包风格，也可以用Java风格，参数/返回值类型也是可选的。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> f1 = &#123; text -&gt;</span><br><span class="line">    println text</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">def</span> f2(text) &#123;</span><br><span class="line">    println text</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">void</span> f3(String text) &#123;</span><br><span class="line">    println text</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意函数定义不能这么写，会被视为函数调用。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">f4(text) &#123;</span><br><span class="line">println text</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>调用带参数的闭包/函数，通常可以省略括号，如果最后一个参数是闭包，还可以单独写在括号后面，如下。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">println(<span class="string">&#x27;hello&#x27;</span>)</span><br><span class="line">println <span class="string">&#x27;hello&#x27;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> func = &#123; text, Closure closure -&gt;</span><br><span class="line">    println text</span><br><span class="line">    closure.call()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func(<span class="string">&#x27;1&#x27;</span>, &#123;</span><br><span class="line">    println <span class="string">&#x27;2&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line">func <span class="string">&#x27;3&#x27;</span>, &#123;</span><br><span class="line">    println <span class="string">&#x27;4&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">func(<span class="string">&#x27;5&#x27;</span>) &#123;</span><br><span class="line">    println <span class="string">&#x27;6&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="delegate，owner，this">delegate，owner，this</h3>
<p>查看Closure类的源码，可以发现闭包中有delegate、owner、thisObject三个成员变量，调用闭包没有的属性/方法时，会尝试在这三个变量上调用。一般情况下：</p>
<ul>
<li>this指向闭包外部的Object，指定义闭包的类。</li>
<li>owner指向闭包外部的Object/Closure，指直接包含闭包的类或闭包。</li>
<li>delegate默认和owner一致，指用于处理闭包属性/方法调用的第三方对象，可以修改。</li>
</ul>
<p>在闭包构造时this和owner就已经确定并传入，是只读的。如果需要修改，可以用<code>Closure.rehydrate()</code>方法克隆新的闭包，同时设置其this和owner。</p>
<p>Closure还有一个resolveStrategy属性，有多种值（<code>OWNER_FIRST</code>、<code>DELEGATE_FIRST</code>、<code>OWNER_ONLY</code>、<code>DELEGATE_ONLY</code>、<code>TO_SELF</code>），默认为<code>OWNER_FIRST</code>，表示调用闭包没有定义的属性/方法时，先尝试从owner取，再尝试从delegate取。</p>
<p>Groovy代码示例：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyDelegate</span> &#123;</span></span><br><span class="line">    <span class="keyword">def</span> func = &#123;</span><br><span class="line">        println(<span class="string">&#x27;hello&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">def</span> c = &#123;</span><br><span class="line">    func()</span><br><span class="line">&#125;</span><br><span class="line">c.delegate = <span class="keyword">new</span> MyDelegate()</span><br><span class="line">c.call()</span><br></pre></td></tr></table></figure>
<p>用Java实现类似效果如下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">callMethod</span><span class="params">(Object o, String method, Object... args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Method func = o.getClass().getDeclaredMethod(method);</span><br><span class="line">        <span class="keyword">if</span> (func != <span class="keyword">null</span>) &#123;</span><br><span class="line">            func.invoke(o, args);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception ignored) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyDelegate</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">func</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;func&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">MyClosure</span> </span>&#123;</span><br><span class="line">    Object delegate;</span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line">MyClosure c = <span class="keyword">new</span> MyClosure() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">call</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!callMethod(<span class="keyword">this</span>, <span class="string">&quot;func&quot;</span>)) &#123;</span><br><span class="line">            callMethod(delegate, <span class="string">&quot;func&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">c.delegate = <span class="keyword">new</span> MyDelegate();</span><br><span class="line">c.call();</span><br></pre></td></tr></table></figure>
<h3 id="属性与Getter、Setter">属性与Getter、Setter</h3>
<p>Groovy中对象的属性（通常即成员变量）可以直接用名字访问，实际上会调用getter和setter</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// File没有absolutePath的成员变量，但有getAbsolutePath方法，可以直接当属性访问</span></span><br><span class="line">println <span class="keyword">new</span> File(<span class="string">&#x27;text&#x27;</span>).absolutePath</span><br><span class="line"></span><br><span class="line"><span class="comment">// File没有setAbsolutePath方法，这句会报ReadOnlyPropertyException</span></span><br><span class="line"><span class="keyword">new</span> File(<span class="string">&#x27;text&#x27;</span>).absolutePath = <span class="string">&#x27;1&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="元编程-MetaProgramming">元编程 (MetaProgramming)</h3>
<p>Groovy支持两类元编程：运行时和编译时。前者在代码运行阶段可以修改类的成员变量、方法，后者则只是在编译时进行（类似Java的注解生成代码）。这里只介绍运行时元编程。</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://groovy-lang.org/metaprogramming.html">http://groovy-lang.org/metaprogramming.html</a></p>
<p>The Groovy language supports two flavors of metaprogramming: runtime and compile-time. The first allows altering the class model and the behavior of a program at runtime while the second only occurs at compile-time.</p>
</blockquote>
<p>Groovy拦截机制（Groovy interception mechanism）如下图。</p>
<p><img data-src="img/http://docs.groovy-lang.org/latest/html/documentation/assets/img/GroovyInterceptions.png" alt=""></p>
<h4 id="示例一：propertyMissing和methodMissing">示例一：propertyMissing和methodMissing</h4>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cls1</span> &#123;</span></span><br><span class="line">    <span class="keyword">def</span> name = <span class="string">&#x27;hello name&#x27;</span></span><br><span class="line"><span class="comment">// 处理未定义的属性调用</span></span><br><span class="line">    Object propertyMissing(String name) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;missing property &#x27;$name&#x27;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 处理未定义的方法调用</span></span><br><span class="line">    <span class="keyword">void</span> methodMissing(String name, Object args) &#123;</span><br><span class="line">        println <span class="string">&quot;call missing method &#x27;$name()&#x27;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> var1 = <span class="keyword">new</span> Cls1()</span><br><span class="line">println var1.name</span><br><span class="line">println var1.myName</span><br><span class="line">var1.missingFunc()</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hello name</span><br><span class="line">missing property &#x27;myName&#x27;</span><br><span class="line">call missing method &#x27;missingFunc()&#x27;</span><br></pre></td></tr></table></figure>
<h4 id="示例二：MetaClass">示例二：MetaClass</h4>
<p>MetaClass的支持是GroovyObject接口定义的，前面已经提到所有Groovy类都会实现这个接口。</p>
<p>MetaClass的作用类似闭包的delegate，当调用对象的属性/方法时，如果原始Class中没定义，会尝试在MetaClass上调用。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cls2</span> &#123;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> var2 = <span class="keyword">new</span> Cls2()</span><br><span class="line"><span class="comment">// 新增一个func方法</span></span><br><span class="line">var2.metaClass.func = &#123;</span><br><span class="line">    println <span class="string">&#x27;hello&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 拦截所有方法调用,先输出一个log,再调用原始方法</span></span><br><span class="line">var2.metaClass.invokeMethod = &#123; String name, Object[] args -&gt;</span><br><span class="line">    println <span class="string">&quot;invoke method &#x27;$name()&#x27;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> originMethod = var2.metaClass.getMetaMethod(name, args)</span><br><span class="line">    <span class="keyword">if</span> (originMethod != <span class="literal">null</span>) originMethod.invoke(var2, args)</span><br><span class="line">&#125;</span><br><span class="line">var2.func()</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">invoke method &#x27;func()&#x27;</span><br><span class="line">hello</span><br></pre></td></tr></table></figure>
<h2 id="理解Gradle-DSL语法——用Groovy实现自己的DSL">理解Gradle DSL语法——用Groovy实现自己的DSL</h2>
<p>为了较好的理解Gradle DSL语法，本节先给出一段常见的gradle脚本，然后一边对其执行过程进行分析，一边用Groovy自己定义DSL，实现类似的语法效果。</p>
<p>** 注意这里只是简化版的示例，和Gradle的实际实现并不完全相同。**</p>
<p>完整示例工程如下。运行其中的<code>DemoDSL.groovy</code>即可看到执行结果（如果运行时提示找不到gradle文件，需要在IDEA/Android Studio的RunConfiguration中修改Working directory）。</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/jzj1993/GradleStudy">https://github.com/jzj1993/GradleStudy</a></p>
</blockquote>
<h3 id="build-gradle脚本"><code>build.gradle</code>脚本</h3>
<p>在<code>build.gradle</code>脚本中，可以给工程添加<code>compile</code>和<code>testCompile</code>两个<code>Configuration</code>，然后分别添加若干<code>Dependency</code>(包括远程模块和本地Project等类型依赖)，如下。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 给Project添加两个Configuration</span></span><br><span class="line">configurations &#123;</span><br><span class="line">    compile</span><br><span class="line">    testCompile</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在不同的Configuration中添加依赖项</span></span><br><span class="line">dependencies &#123;</span><br><span class="line">    add(<span class="string">&#x27;compile&#x27;</span>, <span class="string">&#x27;com.demo:module0&#x27;</span>)</span><br><span class="line">    compile <span class="string">&#x27;com.demo:module1&#x27;</span> <span class="comment">// 外部Module依赖</span></span><br><span class="line">    testCompile project(<span class="attr">path:</span> <span class="string">&quot;:library&quot;</span>) <span class="comment">// Project依赖</span></span><br><span class="line">    compile(<span class="string">&#x27;com.demo:module2&#x27;</span>) &#123; <span class="comment">// 支持Closure配置</span></span><br><span class="line">        transitive = <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    debugCompile <span class="string">&#x27;com.demo:module3&#x27;</span> <span class="comment">// 没有这个Configuration，会报错</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 其他变式写法</span></span><br><span class="line">dependencies.compile <span class="string">&#x27;com.demo:module4&#x27;</span></span><br><span class="line">project.dependencies.compile <span class="string">&#x27;com.demo:module5&#x27;</span></span><br><span class="line">project.dependencies &#123;</span><br><span class="line">    compile <span class="string">&#x27;com.demo:module6&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="build-gradle脚本的执行"><code>build.gradle</code>脚本的执行</h3>
<p>Gradle会在一个Project对象上执行<code>build.gradle</code>脚本（<code>Run build.gradle against a Project object</code>），可以理解成<code>build.gradle</code>的代理对象是Project。</p>
<p>示例代码中：</p>
<ol>
<li>创建Project对象。</li>
<li>通过Groovy加装<code>build.gradle</code>文件，并将其视为Groovy脚本编译生成Script类，创建出一个GroovyObject实例。</li>
<li>利用元编程，设置GroovyObject的代理对象为创建好的Project对象。</li>
<li>执行GroovyObject的<code>run()</code>方法，即执行<code>build.gradle</code>脚本。</li>
</ol>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Utils</span> &#123;</span></span><br><span class="line">    <span class="keyword">static</span> GroovyObject loadAndCreateGroovyObject(File sourceFile) &#123;</span><br><span class="line">        Class groovyClass = <span class="keyword">new</span> GroovyClassLoader().parseClass(sourceFile);</span><br><span class="line">        <span class="keyword">return</span> (GroovyObject) groovyClass.newInstance();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> setDelegateForGroovyObject(GroovyObject obj, Object delegate) &#123;</span><br><span class="line">        obj.metaClass.getProperty = &#123; String name -&gt;</span><br><span class="line">            <span class="keyword">def</span> metaProperty = obj.metaClass.getMetaProperty(name)</span><br><span class="line">            metaProperty != <span class="literal">null</span> ? metaProperty : delegate.getProperty(name)</span><br><span class="line">        &#125;</span><br><span class="line">        obj.metaClass.invokeMethod = &#123; String name, Object[] args -&gt;</span><br><span class="line">            <span class="keyword">def</span> metaMethod = obj.metaClass.getMetaMethod(name, args)</span><br><span class="line">            metaMethod != <span class="literal">null</span> ? metaMethod.invoke(obj, args) : delegate.invokeMethod(name, args)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Project</span> &#123;</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建Project对象</span></span><br><span class="line"><span class="keyword">def</span> project = <span class="keyword">new</span> Project()</span><br><span class="line"><span class="comment">// 加载并实例化Groovy对象</span></span><br><span class="line"><span class="keyword">def</span> groovyObject = Utils.loadAndCreateGroovyObject(<span class="keyword">new</span> File(<span class="string">&#x27;./build.gradle&#x27;</span>))</span><br><span class="line"><span class="comment">// 给groovyObject设置代理对象</span></span><br><span class="line">Utils.setDelegateForGroovyObject(groovyObject, project)</span><br><span class="line"><span class="comment">// 执行脚本(Run &quot;build.gradle&quot; against the Project object)</span></span><br><span class="line">groovyObject.invokeMethod(<span class="string">&quot;run&quot;</span>, <span class="literal">null</span>)</span><br></pre></td></tr></table></figure>
<h3 id="Project-configuraitons-dependencies">Project, configuraitons, dependencies</h3>
<ul>
<li><code>configurations &#123;&#125;</code>和<code>dependencies &#123;&#125;</code>语句其实都是调用Project定义的方法，后面的大括号则是方法的闭包参数。</li>
<li><code>denpendencies.compile</code>这种写法，这里的<code>dependencies</code>则是在调用Project定义的属性。</li>
<li><code>project.xxx</code>，这里的<code>project</code>也是Project定义的属性，指向其自身。</li>
</ul>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Utils</span> &#123;</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 指定代理对象,运行闭包</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> runClosureAgainstObject(Closure closure, Object delegate) &#123;</span><br><span class="line">        Closure c = (Closure) closure.clone()</span><br><span class="line">        c.delegate = delegate</span><br><span class="line">        c.call()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Project</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    ConfigurationContainer configurations = <span class="keyword">new</span> ConfigurationContainer()</span><br><span class="line">    DependencyHandler dependencies = <span class="keyword">new</span> DependencyHandler(<span class="built_in">this</span>)</span><br><span class="line">    Project project = <span class="built_in">this</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> configurations(Closure closure) &#123;</span><br><span class="line">        Utils.runClosureAgainstObject(closure, configurations)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> dependencies(Closure closure) &#123;</span><br><span class="line">        Utils.runClosureAgainstObject(closure, dependencies)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ConfigrationContainer">ConfigrationContainer</h3>
<p><code>configurations(Closure c)</code>方法在<code>ConfigurationContainer</code>对象上执行闭包参数，compile和testCompile都是在调用<code>ConfigurationContainer</code>的<code>propertyMissing()</code>。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConfigurationContainer</span> &#123;</span></span><br><span class="line">    Map&lt;String, Configuration&gt; configurations = <span class="keyword">new</span> HashMap&lt;&gt;()</span><br><span class="line"></span><br><span class="line">    Object propertyMissing(String name) &#123;</span><br><span class="line">        println <span class="string">&quot;add configuration &#x27;$name&#x27;&quot;</span></span><br><span class="line">        configurations.put(name, <span class="keyword">new</span> Configuration())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="DependencyHandler">DependencyHandler</h3>
<p><code>dependencies(Closure c)</code>方法在<code>DependencyHandler</code>上执行闭包参数。</p>
<ul>
<li>闭包中的<code>compile xxx</code>、<code>testCompile xxx</code>等都是在调用<code>DependencyHandler</code>的<code>methodMissing()</code>，最后被转到调用<code>add()</code>方法，从而添加依赖。</li>
<li>闭包中的<code>project(path: ‘xxx‘)</code>也是<code>DependencyHandler</code>定义的一个方法，参数为Map，返回一个<code>Dependency</code>对象。</li>
<li>调用<code>compile xxx &#123;&#125;</code>时，最后可以传入一个闭包参数，用于配置<code>transitive</code>属性等操作。当<code>DependencyHandler.add</code>方法传入了closure，会执行<code>Utils.configureObjectWithClosure(dependency, closure)</code>，用闭包配置<code>Dependency</code>，闭包中的<code>transitive=false</code>会覆盖<code>Dependency</code>中的对应属性。</li>
</ul>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Utils</span> &#123;</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> configureObjectWithClosure(Object object, Closure closure) &#123;</span><br><span class="line">        Closure c = (Closure) closure.clone()</span><br><span class="line">        c.resolveStrategy = Closure.DELEGATE_FIRST;</span><br><span class="line">        c.delegate = object</span><br><span class="line">        c.call()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DependencyHandler</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    Project project;</span><br><span class="line"></span><br><span class="line">    DependencyHandler(Project project) &#123;</span><br><span class="line">        <span class="built_in">this</span>.project = project;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> add(String configuration, String dependencyNotation) &#123;</span><br><span class="line">        add(configuration, <span class="keyword">new</span> Dependency(dependencyNotation), <span class="literal">null</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> add(String configuration, String dependencyNotation, Closure closure) &#123;</span><br><span class="line">        add(configuration, <span class="keyword">new</span> Dependency(dependencyNotation), closure)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> add(String configuration, Dependency dependency) &#123;</span><br><span class="line">        add(configuration, dependency, <span class="literal">null</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> add(String configuration, Dependency dependency, Closure closure) &#123;</span><br><span class="line">        Configuration cfg = <span class="built_in">this</span>.project.configurations.configurations.get(configuration)</span><br><span class="line">        <span class="keyword">if</span> (cfg != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (closure != <span class="literal">null</span>) &#123;</span><br><span class="line">                Utils.configureObjectWithClosure(dependency, closure)</span><br><span class="line">            &#125;</span><br><span class="line">            cfg.dependencies.add(dependency)</span><br><span class="line">            println <span class="string">&quot;add dependency &#x27;$&#123;dependency&#125;&#x27; to &#x27;$&#123;configuration&#125;&#x27;&quot;</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            println <span class="string">&quot;configuration &#x27;$&#123;configuration&#125;&#x27; not found, dependency is &#x27;$&#123;dependency&#125;&#x27;&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Dependency project(Map&lt;String, ?&gt; notation) &#123;</span><br><span class="line">        return new Dependency(<span class="string">&quot;project($&#123;notation.get(&quot;</span>path<span class="string">&quot;)&#125;)&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Object methodMissing(String name, Object args) &#123;</span><br><span class="line">        Object[] arr = (Object[]) args;</span><br><span class="line">        if (arr.length &gt;= <span class="number">1</span> &amp;&amp; (arr[<span class="number">0</span>] instanceof String  arr[<span class="number">0</span>] instanceof Dependency)</span><br><span class="line">                &amp;&amp; this.project.configurations.configurations.get(name) != null) &#123;</span><br><span class="line">            Dependency dependency = arr[<span class="number">0</span>] instanceof String ? new Dependency((String) arr[<span class="number">0</span>]) : (Dependency) arr[<span class="number">0</span>];</span><br><span class="line">            if (arr.length == <span class="number">1</span>) &#123;</span><br><span class="line">                add(name, dependency)</span><br><span class="line">            &#125; else if (arr.length == <span class="number">2</span> &amp;&amp; arr[<span class="number">1</span>] instanceof Closure) &#123;</span><br><span class="line">                add(name, dependency, (Closure) arr[<span class="number">1</span>])</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            println <span class="string">&quot;method &#x27;$&#123;name&#125;&#x27; with args &#x27;$&#123;args&#125;&#x27; not found!&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        return null</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Gradle构建过程">Gradle构建过程</h2>
<p>The Build Lifecycle</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://docs.gradle.org/3.3/userguide/build_lifecycle.html">https://docs.gradle.org/3.3/userguide/build_lifecycle.html</a></p>
</blockquote>
<p>Gradle构建过程通常分为三步。</p>
<blockquote>
<p>A Gradle build has three distinct phases.</p>
</blockquote>
<h3 id="1、初始化阶段-Initialization">1、初始化阶段 (Initialization)</h3>
<p>Gradle支持单个和多个工程的编译。在初始化阶段，Gradle判断需要参与编译的工程，为每个工程创建一个Project对象。</p>
<p>在这个阶段，Gradle会创建Settings对象，并在其上执行<code>settings.gradle</code>脚本，建立工程之间的层次关系。</p>
<blockquote>
<p>Gradle supports single and multi-project builds. During the initialization phase, Gradle determines which projects are going to take part in the build, and creates a Project instance for each of these projects.</p>
</blockquote>
<h3 id="2、配置阶段-Configuration">2、配置阶段 (Configuration)</h3>
<p>在这个阶段，Gradle会分别在每个Project对象上执行对应的<code>build.gradle</code>脚本，对Project进行配置。</p>
<blockquote>
<p>During this phase the project objects are configured. The build scripts of all projects which are part of the build are executed. Gradle 1.4 introduced an incubating opt-in feature called configuration on demand. In this mode, Gradle configures only relevant projects (see the section called “Configuration on demand”).</p>
</blockquote>
<h3 id="3、执行阶段-Execution">3、执行阶段 (Execution)</h3>
<p>在执行阶段，Gradle会判断配置阶段创建的哪些Task需要被执行，然后执行选中的每个Task。</p>
<blockquote>
<p>Gradle determines the subset of the tasks, created and configured during the configuration phase, to be executed. The subset is determined by the task name arguments passed to the gradle command and the current directory. Gradle then executes each of the selected tasks.</p>
</blockquote>
<h2 id="Gradle源码查看">Gradle源码查看</h2>
<p>Gradle是开源的，学习Gradle最好的资料就是Gradle官方文档和Gradle源码。这里介绍查看Gradle源码比较好的方法。</p>
<h3 id="查看gradle脚本调用的API">查看gradle脚本调用的API</h3>
<p>在Android Studio/IDEA的Gradle工程中，可以光标选中gradle脚本语句，用<code>Navigate - Declaration</code>菜单或快捷键，跳转到其调用的Gradle API方法。</p>
<p>例如选中<code>build.gradle</code>中的<code>dependencies</code>，可跳转到<code>Project.dependencies(Closure)</code>方法。</p>
<p>这个操作需要IDE支持，有时不一定管用；另外对于动态添加的方法，也不能正常跳转。</p>
<h3 id="查看完整的源码">查看完整的源码</h3>
<ul>
<li>
<p>Gradle将整个源码分为若干个模块分别发布到了Maven仓库，可参考 <a target="_blank" rel="noopener" href="https://maven-repository.com/artifact/org.gradle">https://maven-repository.com/artifact/org.gradle</a></p>
</li>
<li>
<p>官网 <a target="_blank" rel="noopener" href="https://gradle.org/releases/">https://gradle.org/releases/</a> 可下载Gradle的jar包，分两种（<code>xx</code>表示版本号）：</p>
<ul>
<li><code>gradle-xx-bin.zip</code>，包含所有class的jar包。</li>
<li><code>gradle-xx-all.zip</code>，包含所有class和源码等内容。</li>
</ul>
</li>
</ul>
<p>为方便阅读，可用Android Studio或IDEA关联源码（推荐IDEA Ultimate版），具体操作如下。</p>
<ol>
<li>
<p>克隆并用IDEA打开下面的工程。打开时Gradle选<code>Use default gradle wrapper</code>，同步工程。项目配置了依赖本地gradle库<code>compile gradleApi()</code>，同步完成后一般会下载并关联gradle的jar包。</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/jzj1993/GradleStudy">https://github.com/jzj1993/GradleStudy</a></p>
</blockquote>
<blockquote>
<p>如果打开工程没有正确选择Gradle，可以在<code>Preferences</code> - <code>Build Execution Deployment</code> - <code>Build Tools</code> - <code>Gradle</code>中设置。</p>
</blockquote>
</li>
<li>
<p>通过搜索打开任意Gradle类，例如<code>org.gradle.api.Project</code>（或在左侧Project窗口中展开<code>External Libraries</code> - <code>gradle-api-xx.jar</code>打开）。</p>
<ul>
<li>如果IDEA已经关联了<code>gradle-xx-all.zip</code>，此时就能看到源码。</li>
<li>如果关联的是<code>gradle-xx-bin.zip</code>，此时只能看到class反编译的结果，点击提示栏的<code>Choose Source</code>，选择<code>gradle-3.3-all.zip</code>关联源码即可（Mac系统中默认存放在<code>~/.gradle/wrapper/dists/</code>，如果没有可以自行从官网下载）。</li>
</ul>
</li>
</ol>
<h2 id="常用API">常用API</h2>
<p>本节介绍一些Gradle开发最常用的API，并通过实例介绍其使用。</p>
<p>官方DSL Reference</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://docs.gradle.org/current/dsl/index.html">https://docs.gradle.org/current/dsl/index.html</a></p>
</blockquote>
<h3 id="org-gradle-api-Project">org.gradle.api.Project</h3>
<p><code>Project</code>对象是Gradle中最核心的API，通过<code>Project</code>对象可以访问所有Gradle特性。</p>
<blockquote>
<p>This interface is the main API you use to interact with Gradle from your build file. From a Project, you have programmatic access to all of Gradle’s features.</p>
</blockquote>
<h4 id="Project与build-gradle">Project与build.gradle</h4>
<p>Project对象和<code>build.gradle</code>文件一一对应。在Gradle构建时，会先创建Settings实例并在其上执行<code>settings.gradle</code>；再通过Settings对象定义的Project层级，创建若干个Project实例，并分别在其上执行对应的<code>build.gradle</code>。</p>
<blockquote>
<p><strong>Lifecycle</strong> There is a one-to-one relationship between a Project and a build.gradle file. During build initialisation, Gradle assembles a Project object for each project which is to participate in the build, as follows:</p>
<ul>
<li>Create a org.gradle.api.initialization.Settings instance for the build.</li>
<li>Evaluate the settings.gradle script, if present, against the org.gradle.api.initialization.Settings object to configure it.</li>
<li>Use the configured org.gradle.api.initialization.Settings object to create the hierarchy of Project instances.</li>
<li>Finally, evaluate each Project by executing its build.gradle file, if present, against the project. The projects are evaluated in breadth-wise order, such that a project is evaluated before its child projects. This order can be overridden by calling evaluationDependsOnChildren() or by adding an explicit evaluation dependency using evaluationDependsOn(String).</li>
</ul>
</blockquote>
<h4 id="Extra属性">Extra属性</h4>
<p>Project有一个Extra属性，可通过ext前缀在其中定义属性，定义好后可以不加ext前缀直接访问。</p>
<blockquote>
<p>All extra properties must be defined through the “ext” namespace. Once an extra property has been defined, it is available directly on the owning object (in the below case the Project, Task, and sub-projects respectively) and can be read and updated. Only the initial declaration that needs to be done via the namespace.</p>
</blockquote>
<p>示例代码如下。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">project.ext.prop1 = <span class="string">&quot;foo&quot;</span></span><br><span class="line">task doStuff &#123;</span><br><span class="line">    ext.prop2 = <span class="string">&quot;bar&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ext.isSnapshot = version.endsWith(<span class="string">&quot;-SNAPSHOT&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> (isSnapshot) &#123;</span><br><span class="line">    <span class="comment">// do snapshot stuff</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Project的属性-方法调用">Project的属性/方法调用</h4>
<p>在<code>build.gradle</code>中调用属性，或调用<code>Project.property(java.lang.String)</code>方法时，会按顺序从以下范围查找：</p>
<ol>
<li>Project自身定义的属性</li>
<li>Project的Extra属性</li>
<li>插件添加的Extension属性</li>
<li>插件添加的Convension属性</li>
<li>Project中Task的名字</li>
<li>从父Project继承的属性，一直递归到RootProject</li>
</ol>
<p>在<code>build.gradle</code>中调用方法时，会按顺序从以下范围查找：</p>
<ol>
<li>Project自身定义的方法</li>
<li>build.gradle脚本定义的方法</li>
<li>插件添加类型为Action或Closure的Extension</li>
<li>插件添加的Convension方法</li>
<li>Project中Task的名字都会创建一个对应方法</li>
<li>从父Project继承的方法，一直递归到RootProject</li>
<li>Project中为Closure类型的属性可以作为方法调用</li>
</ol>
<h4 id="常用API-2">常用API</h4>
<p><code>Project</code>继承了<code>PluginAware</code>、<code>ExtensionAware</code>，分别用于支持Plugin和Extension方法。部分常用API如下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Project</span> <span class="keyword">extends</span> <span class="title">Comparable</span>&lt;<span class="title">Project</span>&gt;, <span class="title">ExtensionAware</span>, <span class="title">PluginAware</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">Project <span class="title">getRootProject</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">File <span class="title">getRootDir</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">File <span class="title">getBuildDir</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">allprojects</span><span class="params">(Closure configureClosure)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">ScriptHandler <span class="title">getBuildscript</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">buildscript</span><span class="params">(Closure configureClosure)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">RepositoryHandler <span class="title">getRepositories</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">repositories</span><span class="params">(Closure configureClosure)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">ConfigurationContainer <span class="title">getConfigurations</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">configurations</span><span class="params">(Closure configureClosure)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">DependencyHandler <span class="title">getDependencies</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dependencies</span><span class="params">(Closure configureClosure)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">ConfigurableFileCollection <span class="title">files</span><span class="params">(Object... paths)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">ConfigurableFileTree <span class="title">fileTree</span><span class="params">(Object baseDir)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">Convention <span class="title">getConvention</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">ExtensionContainer <span class="title">getExtensions</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">Task <span class="title">task</span><span class="params">(String name)</span> <span class="keyword">throws</span> InvalidUserDataException</span>;</span><br><span class="line"></span><br><span class="line"><span class="function">Task <span class="title">task</span><span class="params">(String name, Closure configureClosure)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">afterEvaluate</span><span class="params">(Closure closure)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>常用API示例（以下脚本均写在<code>build.gradle</code>中）：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 配置Gradle插件，闭包参数会在ScriptHandler上执行</span></span><br><span class="line">buildscript &#123;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置所有工程，闭包参数会分别在每个Project上执行</span></span><br><span class="line">allprojects &#123;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置使用的仓库，闭包参数会在RepositoryHandler上执行</span></span><br><span class="line">repositories &#123;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置依赖项，闭包参数会在DependencyHandler上执行。</span></span><br><span class="line"><span class="comment">// files和fileTree也是Project提供的API，</span></span><br><span class="line"><span class="comment">// 而project则是DependencyHandler提供的API。</span></span><br><span class="line">dependencies &#123;</span><br><span class="line">compile files(<span class="string">&#x27;hibernate.jar&#x27;</span>, <span class="string">&#x27;libs/spring.jar&#x27;</span>)</span><br><span class="line">compile fileTree(<span class="string">&#x27;libs&#x27;</span>)</span><br><span class="line">    compile project(<span class="attr">path:</span> <span class="string">&#x27;:library&#x27;</span>)</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在当前Project配置完成后，闭包会被执行</span></span><br><span class="line">afterEvaluate &#123;</span><br><span class="line">    println <span class="string">&quot;Project &#x27;$name&#x27; has been evaluated!&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在RootProject配置完成后，闭包会被执行</span></span><br><span class="line">rootProject.afterEvaluate &#123;</span><br><span class="line">    println <span class="string">&quot;RootProject &#x27;$name&#x27; has been evaluated!&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="org-gradle-api-invocation-Gradle">org.gradle.api.invocation.Gradle</h3>
<p><code>Gradle</code>对象表示一次Gradle调用，通过<code>Project.getGradle()</code>可以获取这个对象。在一次构建过程中只有一个<code>Gradle</code>对象，可在其上保存一些全局配置参数，包括StartParameter等。</p>
<blockquote>
<p>Represents an invocation of Gradle. You can obtain a Gradle instance by calling Project.getGradle().</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Gradle</span> <span class="keyword">extends</span> <span class="title">PluginAware</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">String <span class="title">getGradleVersion</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">File <span class="title">getGradleUserHomeDir</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">File <span class="title">getGradleHomeDir</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">Gradle <span class="title">getParent</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">Project <span class="title">getRootProject</span><span class="params">()</span> <span class="keyword">throws</span> IllegalStateException</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">rootProject</span><span class="params">(Action&lt; ? <span class="keyword">super</span> Project&gt; action)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">allprojects</span><span class="params">(Action&lt; ? <span class="keyword">super</span> Project&gt; action)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">TaskExecutionGraph <span class="title">getTaskGraph</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">StartParameter <span class="title">getStartParameter</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">ProjectEvaluationListener <span class="title">addProjectEvaluationListener</span><span class="params">(ProjectEvaluationListener listener)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">removeProjectEvaluationListener</span><span class="params">(ProjectEvaluationListener listener)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">beforeProject</span><span class="params">(Closure closure)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">afterProject</span><span class="params">(Closure closure)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">buildStarted</span><span class="params">(Closure closure)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">settingsEvaluated</span><span class="params">(Closure closure)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">projectsLoaded</span><span class="params">(Closure closure)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">projectsEvaluated</span><span class="params">(Closure closure)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">buildFinished</span><span class="params">(Closure closure)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addBuildListener</span><span class="params">(BuildListener buildListener)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addListener</span><span class="params">(Object listener)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeListener</span><span class="params">(Object listener)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">useLogger</span><span class="params">(Object logger)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">Gradle <span class="title">getGradle</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="org-gradle-api-initialization-Settings">org.gradle.api.initialization.Settings</h3>
<p><code>Settings</code>对象主要用于配置Project的层级结构。</p>
<p><code>Settings</code>对象和<code>settings.gradle</code>文件一一对应。Gradle构建的第一步，就是创建<code>Settings</code>对象并其上执行<code>settings.gradle</code>脚本。</p>
<blockquote>
<p>Declares the configuration required to instantiate and configure the hierarchy of org.gradle.api.Project instances which are to participate in a build.</p>
<p>There is a one-to-one correspondence between a Settings instance and a settings.gradle settings file. Before Gradle assembles the projects for a build, it creates a Settings instance and executes the settings file against it.</p>
</blockquote>
<p><code>Settings</code>的部分API如下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Settings</span> <span class="keyword">extends</span> <span class="title">PluginAware</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    String DEFAULT_SETTINGS_FILE = <span class="string">&quot;settings.gradle&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">include</span><span class="params">(String[] projectPaths)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">includeFlat</span><span class="params">(String[] projectNames)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">Settings <span class="title">getSettings</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">File <span class="title">getSettingsDir</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">File <span class="title">getRootDir</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">ProjectDescriptor <span class="title">getRootProject</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">ProjectDescriptor <span class="title">project</span><span class="params">(String path)</span> <span class="keyword">throws</span> UnknownProjectException</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">ProjectDescriptor <span class="title">findProject</span><span class="params">(String path)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">ProjectDescriptor <span class="title">project</span><span class="params">(File projectDir)</span> <span class="keyword">throws</span> UnknownProjectException</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">ProjectDescriptor <span class="title">findProject</span><span class="params">(File projectDir)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">StartParameter <span class="title">getStartParameter</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">Gradle <span class="title">getGradle</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>常用API示例：</p>
<ol>
<li>
<p><code>include()</code>可以配置包含Project，例如<code>include ':app', ':library'</code></p>
</li>
<li>
<p><code>project()</code>可获取ProjectDescriptor从而做一些配置，例如经常会配置Gradle依赖本地Library工程的路径：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">include <span class="string">&#x27;:img:library&#x27;</span></span><br><span class="line">project(<span class="string">&#x27;:img:library&#x27;</span>).projectDir = <span class="keyword">new</span> File(<span class="string">&#x27;../../img/library&#x27;</span>)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="org-gradle-api-Task">org.gradle.api.Task</h3>
<h4 id="Task">Task</h4>
<p><code>Task</code>也是Gradle中很重要的API。Task代表构建过程中的一个原子操作，例如编译classes文件或生成JavaDoc。</p>
<p>每个Task属于一个Project。每个Task都有一个名字。所属Project名+Task名可组成唯一的完整名(fully qualified path)，例如<code>:app:assemble</code>。</p>
<blockquote>
<p>A Task represents a single atomic piece of work for a build, such as compiling classes or generating javadoc.</p>
<p>Each task belongs to a Project.</p>
<p>Each task has a name, which can be used to refer to the task within its owning project, and a fully qualified path, which is unique across all tasks in all projects. The path is the concatenation of the owning project’s path and the task’s name. Path elements are separated using the : character.</p>
</blockquote>
<h4 id="Action">Action</h4>
<p>每个Task包含一个Action序列，并在Task执行时按先后顺序执行。通过Task的doFirst/doLast方法可以往Action序列的头部/末尾添加Action，支持Action或闭包（闭包会被转换成Action对象）。</p>
<blockquote>
<p>A Task is made up of a sequence of Action objects. When the task is executed, each of the actions is executed in turn, by calling Action.execute. You can add actions to a task by calling doFirst(Action) or doLast(Action).</p>
<p>Groovy closures can also be used to provide a task action. When the action is executed, the closure is called with the task as parameter. You can add action closures to a task by calling doFirst(Closure) or doLast(Closure).</p>
</blockquote>
<h4 id="Task依赖和排序">Task依赖和排序</h4>
<p>每个Task可以依赖其他Task，执行Task时会先执行其依赖的Task，通过dependsOn可设置依赖。每个Task还可以设置在其他Task之前、之后执行，一般可通过mustRunAfter设置。</p>
<blockquote>
<p>A task may have dependencies on other tasks or might be scheduled to always run after another task. Gradle ensures that all task dependencies and ordering rules are honored when executing tasks, so that the task is executed after all of its dependencies and any “must run after” tasks have been executed.</p>
</blockquote>
<p>例如下面的配置，执行A时一定会先执行B；执行A不一定会执行C；当A、C都要执行时一定先执行C。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">taskA.dependsOn(taskB)</span><br><span class="line">taskA.mustRunAfter(taskC)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>除了mustRunAfter，还有个shouldRunAfter要求宽松一些，大部分情况下两者效果相同，特殊情况下有差异，具体可参考官方文档： <a target="_blank" rel="noopener" href="https://docs.gradle.org/3.3/userguide/more_about_tasks.html">https://docs.gradle.org/3.3/userguide/more_about_tasks.html</a></p>
</blockquote>
<h4 id="常用API-3">常用API</h4>
<p>Task的部分常用API如下：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Task</span> <span class="keyword">extends</span> <span class="title">Comparable</span>&lt;<span class="title">Task</span>&gt;, <span class="title">ExtensionAware</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    String getName();</span><br><span class="line"></span><br><span class="line">    Project getProject();</span><br><span class="line"></span><br><span class="line">    TaskDependency getTaskDependencies();</span><br><span class="line"></span><br><span class="line">    Task dependsOn(Object... paths);</span><br><span class="line"></span><br><span class="line">    String getPath();</span><br><span class="line"></span><br><span class="line">    Task doFirst(Action&lt; ? super Task&gt; action);</span><br><span class="line"></span><br><span class="line">    Task doFirst(Closure action);</span><br><span class="line"></span><br><span class="line">    Task doLast(Action&lt; ? super Task&gt; action);</span><br><span class="line"></span><br><span class="line">    Task doLast(Closure action);</span><br><span class="line"></span><br><span class="line">    Task configure(Closure configureClosure);</span><br><span class="line"></span><br><span class="line">    Task mustRunAfter(Object... paths);</span><br><span class="line"></span><br><span class="line">    TaskDependency shouldRunAfter(Object... paths);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Task创建">Task创建</h4>
<blockquote>
<p>注：Gradle不推荐使用<code>task hello &lt;&lt; &#123; ... &#125;</code>的方式定义Task，并会在后续版本删除，因此这里不做介绍。</p>
</blockquote>
<p>在<code>build.gradle</code>中创建Task，最常见写法如下。<code>task(xxx)</code>是Project提供的API，最终调用了TaskContainer的create方法。可接收参数包括：</p>
<ul>
<li>Task名称(必选)</li>
<li><code>Map&lt;String, ?&gt;</code>类型配置(可选)</li>
<li>闭包配置(可选)</li>
</ul>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">task hello(<span class="attr">dependsOn:</span> clean) &#123;</span><br><span class="line">doLast &#123;</span><br><span class="line">    println <span class="string">&#x27;hello&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>也可以直接调用TaskContainer创建Task，Project中的tasks属性即为TaskContainer对象。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tasks.create(<span class="string">&#x27;hello&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>Task创建后会在Project上添加一个同名方法，调用这个方法可以配置Task。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">task hello</span><br><span class="line"></span><br><span class="line">hello &#123;</span><br><span class="line">doLast &#123;</span><br><span class="line">    println <span class="string">&#x27;hello&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Task的type属性，带参数的Task">Task的type属性，带参数的Task</h4>
<p>还可以用类实现Task，创建Task时指定type为这个class即可，定义Task的类通常继承自DefaultTask。下列示例代码中给Task定义了一个名为<code>name</code>的参数。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.gradle.api.internal.tasks.options.Option</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloTask</span> <span class="keyword">extends</span> <span class="title">DefaultTask</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    String personName = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    HelloTask() &#123;</span><br><span class="line">        doLast &#123;</span><br><span class="line">            println <span class="string">&quot;Hello &quot;</span> + personName</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Option</span>(description = <span class="string">&quot;set person name&quot;</span>, option = <span class="string">&quot;name&quot;</span>)</span><br><span class="line">    <span class="keyword">def</span> setMessage(String name) &#123;</span><br><span class="line">        <span class="built_in">this</span>.personName = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">task hello(<span class="attr">type:</span> HelloTask)</span><br></pre></td></tr></table></figure>
<p>命令行中执行效果：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ./gradlew hello --name Tom</span></span><br><span class="line">:hello</span><br><span class="line">Hello Tom</span><br><span class="line"></span><br><span class="line">BUILD SUCCESSFUL</span><br><span class="line"></span><br><span class="line">Total time: 0.889 secs</span><br></pre></td></tr></table></figure>
<h3 id="org-gradle-api-plugins-PluginAware">org.gradle.api.plugins.PluginAware</h3>
<p>前面介绍的<code>Gradle</code>、<code>Settings</code>、<code>Project</code>等接口均继承了<code>PluginAware</code>接口，<code>PluginAware</code>主要定义了插件相关API。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PluginAware</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    PluginContainer getPlugins();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> apply(Closure closure);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> apply(Action&lt; ? super ObjectConfigurationAction&gt; action);</span><br><span class="line"></span><br><span class="line">    void apply(Map&lt;String, ?&gt; options);</span><br><span class="line"></span><br><span class="line">    PluginManager getPluginManager();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="应用插件">应用插件</h4>
<p><code>apply plugin: 'java'</code>，表示应用Java插件。这个语句调用了<code>apply()</code>方法，后面的<code>plugin: 'java'</code>是一个Map类型参数。</p>
<p><code>apply plugin: MyClass</code>表示应用指定class实现的插件，将在后面的<code>Plugin</code>中介绍。</p>
<h4 id="执行其他Gradle脚本">执行其他Gradle脚本</h4>
<p>当一个gradle脚本（例如<code>build.gradle</code>）中的代码较多时，可以拆分成多个文件。</p>
<ol>
<li>新写一个gradle文件例如<code>my_script.gradle</code>，把拆分出来的代码放在这个文件中。</li>
<li>在<code>build.gradle</code>中通过<code>apply from: 'my_script.gradle'</code>或<code>apply from: new File('xxx/my_script.gradle')</code>，调用当前目录或指定路径的脚本文件。</li>
<li>新的<code>my_script.gradle</code>在被执行时，其代理对象和调用它的<code>build.gradle</code>一致，即Project对象。</li>
<li>注意，在新的<code>my_script.gradle</code>中定义的属性/方法，在<code>build.gradle</code>中不能访问。因为每个gradle文件最后都会被编译成单独的Groovy Script，这些属性/方法只是Script类中的成员。</li>
<li>如果要在不同的脚本文件之间传递数据，可以利用Gradle/Settings/Project对象的ext属性实现。</li>
</ol>
<h3 id="org-gradle-api-Plugin">org.gradle.api.Plugin</h3>
<p><code>Plugin</code>用于定义插件。Gradle提供了完整的API框架，而很多工作实际是由插件实现的。Gradle内置了Java、Groovy等几种基础插件，也可以自定义插件。</p>
<p><code>Plugin</code>接口很简单，只有一个apply方法。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Plugin</span>&lt;<span class="title">T</span>&gt; &#123;</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Apply this plugin to the given target object.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @param target The target object</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> apply(T target);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="简易插件开发">简易插件开发</h4>
<p>下面的示例代码实现了HelloPlugin的简易插件，代码可直接写在<code>build.gradle</code>中。</p>
<p>插件在<code>apply(Project)</code>方法里，给Project创建了一个名为<code>hello</code>的Extension和一个名为<code>welcome</code>的Task；Task执行时读取Extension并打印字符串。</p>
<p>在<code>build.gradle</code>执行到<code>apply plugin: HelloPlugin</code>时，<code>HelloPlugin.apply(Project)</code>方法被执行，从而Project有了<code>hello</code>的Extension，于是后面可以调用<code>hello &#123;&#125;</code>对插件进行配置。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloExtension</span> &#123;</span></span><br><span class="line">    Boolean enable = <span class="literal">true</span></span><br><span class="line">    String text = <span class="string">&#x27;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloPlugin</span> <span class="keyword">implements</span> <span class="title">Plugin</span>&lt;<span class="title">Project</span>&gt; &#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">void</span> apply(Project project) &#123;</span><br><span class="line">        project.extensions.create(<span class="string">&#x27;hello&#x27;</span>, HelloExtension)</span><br><span class="line">        project.task(<span class="string">&#x27;welcome&#x27;</span>) &#123;</span><br><span class="line">            doLast &#123;</span><br><span class="line">                HelloExtension ext = project.extensions.hello;</span><br><span class="line">                println ext.enable ? <span class="string">&quot;Hello $&#123;ext.text&#125;!&quot;</span> : <span class="string">&#x27;HelloPlugin is disabled.&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">apply <span class="attr">plugin:</span> HelloPlugin</span><br><span class="line"></span><br><span class="line">hello &#123;</span><br><span class="line">    enable = <span class="literal">true</span></span><br><span class="line">    text = <span class="string">&#x27;Gradle&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在命令行中执行结果如下。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ./gradlew welcome</span></span><br><span class="line">:welcome</span><br><span class="line">Hello Gradle!</span><br><span class="line"></span><br><span class="line">BUILD SUCCESSFUL</span><br><span class="line"></span><br><span class="line">Total time: 0.917 secs</span><br></pre></td></tr></table></figure>
<h4 id="独立工程开发插件">独立工程开发插件</h4>
<p>对于类似前面示例的简单插件，代码可以直接写在工程的gradle脚本中。而对于需要应用到很多工程的插件，或复杂的插件（例如Android插件），在独立的工程中开发是一个更好的选择。</p>
<p>独立工程开发时，可以新建基于Gradle的Groovy工程。</p>
<p>完整代码可参考示例工程中的plugin模块：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/jzj1993/GradleStudy">https://github.com/jzj1993/GradleStudy</a></p>
</blockquote>
<p>插件工程的文件结构如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── build.gradle</span><br><span class="line">└── src</span><br><span class="line">    └── main</span><br><span class="line">        ├── groovy</span><br><span class="line">        │   └── com</span><br><span class="line">        │       └── paincker</span><br><span class="line">        │           └── gradle</span><br><span class="line">        │               ├── GreetingExtension.groovy</span><br><span class="line">        │               └── GreetingPlugin.groovy</span><br><span class="line">        └── resources</span><br><span class="line">            └── META-INF</span><br><span class="line">                └── gradle-plugins</span><br><span class="line">                    └── greeting.properties</span><br></pre></td></tr></table></figure>
<p>其中<code>build.gradle</code>内容如下。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">apply <span class="attr">plugin:</span> <span class="string">&#x27;groovy&#x27;</span></span><br><span class="line"></span><br><span class="line">repositories &#123;</span><br><span class="line">    mavenCentral()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    compile localGroovy() <span class="comment">// Groovy支持(本地)</span></span><br><span class="line">    compile gradleApi() <span class="comment">// GradleAPI支持</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在<code>src/main/groovy</code>目录下，可编写插件源码，java、groovy均可。</p>
<p>在<code>src/main/resources/META-INF/gradle-plugins</code>目录下，可以创建若干properties文件：</p>
<ul>
<li>
<p>文件名即为插件名，例如<code>greeting.properties</code>，则插件名为<code>greeting</code></p>
</li>
<li>
<p>文件内容如下，用implementation-class指定插件的实现类</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation-class=com.paincker.gradle.GreetingPlugin</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>通过gradle的assemble命令将插件打包，默认输出到<code>build/libs/plugin.jar</code>。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ./gradlew clean :plugin:assemble</span></span><br></pre></td></tr></table></figure>
<h4 id="独立Gradle插件的使用">独立Gradle插件的使用</h4>
<p>在要使用插件的Gradle工程的<code>buildscript.dependencies &#123;&#125;</code>中，可引入Gradle插件包。</p>
<ul>
<li>可将前面生成的<code>plugin.jar</code>直接复制到工程根目录，通过<code>classpath files('plugin.jar')</code>引入。</li>
<li>也可以将插件jar包发布到Maven仓库，通过<code>classpath 'com.xxx:greeting:1.0'</code>的形式引入。</li>
</ul>
<p>引入插件包后，用<code>apply plugin: 'greeting'</code>应用插件，<code>greeting</code>即为前面通过<code>properties</code>文件名指定的插件名字。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">buildscript &#123;</span><br><span class="line">    dependencies &#123;</span><br><span class="line">        classpath files(<span class="string">&#x27;plugin.jar&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">apply <span class="attr">plugin:</span> <span class="string">&#x27;greeting&#x27;</span></span><br><span class="line"></span><br><span class="line">greet &#123;</span><br><span class="line">    enable = <span class="literal">true</span></span><br><span class="line">    text = <span class="string">&#x27;Plugin&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="org-gradle-api-logging-Logger">org.gradle.api.logging.Logger</h3>
<p>Logger用于输出Gradle的Log。在命令行执行gradle任务则Log输出到命令行，在Android Studio中执行则输出到Gradle Console。</p>
<p>Logger提供以下接口。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Logger</span> <span class="keyword">extends</span> <span class="title">org</span>.<span class="title">slf4j</span>.<span class="title">Logger</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">boolean</span> isLifecycleEnabled();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> debug(String message, Object... objects);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> lifecycle(String message);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> lifecycle(String message, Object... objects);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> lifecycle(String message, Throwable throwable);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">boolean</span> isQuietEnabled();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> quiet(String message);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> quiet(String message, Object... objects);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> info(String message, Object... objects);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> quiet(String message, Throwable throwable);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">boolean</span> isEnabled(LogLevel level);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> log(LogLevel level, String message);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> log(LogLevel level, String message, Object... objects);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> log(LogLevel level, String message, Throwable throwable);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中LogLevel表示Log等级，有以下值。可通过StartParameter控制Gradle要输出的Log等级。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">LogLevel</span> &#123;</span></span><br><span class="line">    DEBUG,</span><br><span class="line">    INFO,</span><br><span class="line">    LIFECYCLE,</span><br><span class="line">    WARN,</span><br><span class="line">    QUIET,</span><br><span class="line">    ERROR</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可通过以下方式获取Logger对象：</p>
<ul>
<li>org.gradle.api.logging.Logging.getLogger(Class)</li>
<li>org.gradle.api.logging.Logging.getLogger(String)</li>
<li>org.gradle.api.Project.getLogger()</li>
<li>org.gradle.api.Task.getLogger()</li>
<li>org.gradle.api.Script.getLogger()</li>
</ul>

    </div>

    
    
    
      
  <div class="popular-posts-header">相关文章</div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/android-gradle-basics/" rel="bookmark">Android Gradle配置快速入门</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/gradle-plugin-and-principle/" rel="bookmark">Gradle插件开发与执行原理浅析</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/gradle-dependencies/" rel="bookmark">Gradle依赖项学习总结，dependencies、transitive、force、exclude的使用与依赖冲突解决</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/gradle-download-jar-file/" rel="bookmark">Gradle不能下载jar包的解决思路</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/android-lint-2-implements/" rel="bookmark">Android Lint：自定义Lint调试与开发</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/android-lint-1-usage/" rel="bookmark">Android Lint：基本使用与配置</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/nine-patch-usage/" rel="bookmark">NinePatch图（9-Patch图，.9图）使用全面介绍</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/android-bitmap/" rel="bookmark">Android Bitmap操作内存问题总结(图片处理、截屏等)</a></div>
    </li>
  </ul>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Android/" rel="tag"># Android</a>
              <a href="/tags/%E5%AE%89%E5%8D%93/" rel="tag"># 安卓</a>
              <a href="/tags/%E7%A7%BB%E5%8A%A8%E5%BC%80%E5%8F%91/" rel="tag"># 移动开发</a>
              <a href="/tags/%E7%BC%96%E7%A8%8B/" rel="tag"># 编程</a>
              <a href="/tags/Gradle/" rel="tag"># Gradle</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/android-gradle-basics/" rel="prev" title="Android Gradle配置快速入门">
      <i class="fa fa-chevron-left"></i> Android Gradle配置快速入门
    </a></div>
      <div class="post-nav-item">
    <a href="/online-video-download/" rel="next" title="网页视频通用下载方法(支持网易云音乐MV、优酷等)">
      网页视频通用下载方法(支持网易云音乐MV、优酷等) <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AF%B4%E6%98%8E"><span class="nav-number">1.</span> <span class="nav-text">说明</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Groovy%E8%AF%AD%E8%A8%80%E7%AE%80%E4%BB%8B"><span class="nav-number">2.</span> <span class="nav-text">Groovy语言简介</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#HelloWorld"><span class="nav-number">2.1.</span> <span class="nav-text">HelloWorld</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#GroovyObject%EF%BC%8CScript"><span class="nav-number">2.2.</span> <span class="nav-text">GroovyObject，Script</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8A%A8%E6%80%81%E7%B1%BB%E5%9E%8B"><span class="nav-number">2.3.</span> <span class="nav-text">动态类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="nav-number">2.4.</span> <span class="nav-text">字符串</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%97%AD%E5%8C%85-Closure"><span class="nav-number">2.5.</span> <span class="nav-text">闭包 (Closure)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B9%E6%B3%95-%E9%97%AD%E5%8C%85%E7%9A%84%E5%AE%9A%E4%B9%89%E4%B8%8E%E8%B0%83%E7%94%A8"><span class="nav-number">2.6.</span> <span class="nav-text">方法&#x2F;闭包的定义与调用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#delegate%EF%BC%8Cowner%EF%BC%8Cthis"><span class="nav-number">2.7.</span> <span class="nav-text">delegate，owner，this</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B1%9E%E6%80%A7%E4%B8%8EGetter%E3%80%81Setter"><span class="nav-number">2.8.</span> <span class="nav-text">属性与Getter、Setter</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%83%E7%BC%96%E7%A8%8B-MetaProgramming"><span class="nav-number">2.9.</span> <span class="nav-text">元编程 (MetaProgramming)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B%E4%B8%80%EF%BC%9ApropertyMissing%E5%92%8CmethodMissing"><span class="nav-number">2.9.1.</span> <span class="nav-text">示例一：propertyMissing和methodMissing</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B%E4%BA%8C%EF%BC%9AMetaClass"><span class="nav-number">2.9.2.</span> <span class="nav-text">示例二：MetaClass</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%90%86%E8%A7%A3Gradle-DSL%E8%AF%AD%E6%B3%95%E2%80%94%E2%80%94%E7%94%A8Groovy%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%B7%B1%E7%9A%84DSL"><span class="nav-number">3.</span> <span class="nav-text">理解Gradle DSL语法——用Groovy实现自己的DSL</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#build-gradle%E8%84%9A%E6%9C%AC"><span class="nav-number">3.1.</span> <span class="nav-text">build.gradle脚本</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#build-gradle%E8%84%9A%E6%9C%AC%E7%9A%84%E6%89%A7%E8%A1%8C"><span class="nav-number">3.2.</span> <span class="nav-text">build.gradle脚本的执行</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Project-configuraitons-dependencies"><span class="nav-number">3.3.</span> <span class="nav-text">Project, configuraitons, dependencies</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ConfigrationContainer"><span class="nav-number">3.4.</span> <span class="nav-text">ConfigrationContainer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DependencyHandler"><span class="nav-number">3.5.</span> <span class="nav-text">DependencyHandler</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Gradle%E6%9E%84%E5%BB%BA%E8%BF%87%E7%A8%8B"><span class="nav-number">4.</span> <span class="nav-text">Gradle构建过程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%E3%80%81%E5%88%9D%E5%A7%8B%E5%8C%96%E9%98%B6%E6%AE%B5-Initialization"><span class="nav-number">4.1.</span> <span class="nav-text">1、初始化阶段 (Initialization)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%E3%80%81%E9%85%8D%E7%BD%AE%E9%98%B6%E6%AE%B5-Configuration"><span class="nav-number">4.2.</span> <span class="nav-text">2、配置阶段 (Configuration)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3%E3%80%81%E6%89%A7%E8%A1%8C%E9%98%B6%E6%AE%B5-Execution"><span class="nav-number">4.3.</span> <span class="nav-text">3、执行阶段 (Execution)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Gradle%E6%BA%90%E7%A0%81%E6%9F%A5%E7%9C%8B"><span class="nav-number">5.</span> <span class="nav-text">Gradle源码查看</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8Bgradle%E8%84%9A%E6%9C%AC%E8%B0%83%E7%94%A8%E7%9A%84API"><span class="nav-number">5.1.</span> <span class="nav-text">查看gradle脚本调用的API</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E5%AE%8C%E6%95%B4%E7%9A%84%E6%BA%90%E7%A0%81"><span class="nav-number">5.2.</span> <span class="nav-text">查看完整的源码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8API"><span class="nav-number">6.</span> <span class="nav-text">常用API</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#org-gradle-api-Project"><span class="nav-number">6.1.</span> <span class="nav-text">org.gradle.api.Project</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Project%E4%B8%8Ebuild-gradle"><span class="nav-number">6.1.1.</span> <span class="nav-text">Project与build.gradle</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Extra%E5%B1%9E%E6%80%A7"><span class="nav-number">6.1.2.</span> <span class="nav-text">Extra属性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Project%E7%9A%84%E5%B1%9E%E6%80%A7-%E6%96%B9%E6%B3%95%E8%B0%83%E7%94%A8"><span class="nav-number">6.1.3.</span> <span class="nav-text">Project的属性&#x2F;方法调用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8API-2"><span class="nav-number">6.1.4.</span> <span class="nav-text">常用API</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#org-gradle-api-invocation-Gradle"><span class="nav-number">6.2.</span> <span class="nav-text">org.gradle.api.invocation.Gradle</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#org-gradle-api-initialization-Settings"><span class="nav-number">6.3.</span> <span class="nav-text">org.gradle.api.initialization.Settings</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#org-gradle-api-Task"><span class="nav-number">6.4.</span> <span class="nav-text">org.gradle.api.Task</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Task"><span class="nav-number">6.4.1.</span> <span class="nav-text">Task</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Action"><span class="nav-number">6.4.2.</span> <span class="nav-text">Action</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Task%E4%BE%9D%E8%B5%96%E5%92%8C%E6%8E%92%E5%BA%8F"><span class="nav-number">6.4.3.</span> <span class="nav-text">Task依赖和排序</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8API-3"><span class="nav-number">6.4.4.</span> <span class="nav-text">常用API</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Task%E5%88%9B%E5%BB%BA"><span class="nav-number">6.4.5.</span> <span class="nav-text">Task创建</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Task%E7%9A%84type%E5%B1%9E%E6%80%A7%EF%BC%8C%E5%B8%A6%E5%8F%82%E6%95%B0%E7%9A%84Task"><span class="nav-number">6.4.6.</span> <span class="nav-text">Task的type属性，带参数的Task</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#org-gradle-api-plugins-PluginAware"><span class="nav-number">6.5.</span> <span class="nav-text">org.gradle.api.plugins.PluginAware</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E6%8F%92%E4%BB%B6"><span class="nav-number">6.5.1.</span> <span class="nav-text">应用插件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%89%A7%E8%A1%8C%E5%85%B6%E4%BB%96Gradle%E8%84%9A%E6%9C%AC"><span class="nav-number">6.5.2.</span> <span class="nav-text">执行其他Gradle脚本</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#org-gradle-api-Plugin"><span class="nav-number">6.6.</span> <span class="nav-text">org.gradle.api.Plugin</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AE%80%E6%98%93%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91"><span class="nav-number">6.6.1.</span> <span class="nav-text">简易插件开发</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%8B%AC%E7%AB%8B%E5%B7%A5%E7%A8%8B%E5%BC%80%E5%8F%91%E6%8F%92%E4%BB%B6"><span class="nav-number">6.6.2.</span> <span class="nav-text">独立工程开发插件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%8B%AC%E7%AB%8BGradle%E6%8F%92%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-number">6.6.3.</span> <span class="nav-text">独立Gradle插件的使用</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#org-gradle-api-logging-Logger"><span class="nav-number">6.7.</span> <span class="nav-text">org.gradle.api.logging.Logger</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">jzj1993</p>
  <div class="site-description" itemprop="description">江子健的个人博客，90后理工男、微软程序员、互联网从业者，分享软件编程、开发技术、学习与思考</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">273</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">111</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/jzj1993" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;jzj1993" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      友情链接
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="http://www.dappchaser.com/" title="http:&#x2F;&#x2F;www.dappchaser.com" rel="noopener" target="_blank">DAppChaser</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.chenwenguan.com/" title="https:&#x2F;&#x2F;www.chenwenguan.com&#x2F;" rel="noopener" target="_blank">陈文管的博客</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://yifeiyuan.me/" title="http:&#x2F;&#x2F;yifeiyuan.me&#x2F;" rel="noopener" target="_blank">程序亦非猿</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.trinea.cn/" title="https:&#x2F;&#x2F;www.trinea.cn&#x2F;" rel="noopener" target="_blank">Trinea</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://blog.weshinekx.cn/" title="https:&#x2F;&#x2F;blog.weshinekx.cn&#x2F;" rel="noopener" target="_blank">Shinya</a>
        </li>
    </ul>
  </div>

      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">jzj1993</span>
</div>
  <div class="sitemap"><a href="/sitemap.xml" class="theme-link">站点地图</a>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/medium-zoom@1/dist/medium-zoom.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>

<script src="/js/utils.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : true,
      notify     : true,
      appId      : '3YlzwEecQlMdJPH9KEbFt6PX-gzGzoHsz',
      appKey     : 'raIB2P7DewB4SAboVtpHakbh',
      placeholder: "输入评论...",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '20' || 10,
      visitor    : true,
      lang       : 'zh-cn' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>

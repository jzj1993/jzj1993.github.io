<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/logo-128.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/logo-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/logo-16.png">
  <link rel="mask-icon" href="/images/logo-128.png" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.paincker.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="先附上Publish Markdown的GitHub主页地址：https:&#x2F;&#x2F;github.com&#x2F;jzj1993&#x2F;PublishMarkdown 背景">
<meta property="og:type" content="article">
<meta property="og:title" content="PublishMarkdown技术实现">
<meta property="og:url" content="https://www.paincker.com/publish-markdown-tech/">
<meta property="og:site_name" content="Paincker">
<meta property="og:description" content="先附上Publish Markdown的GitHub主页地址：https:&#x2F;&#x2F;github.com&#x2F;jzj1993&#x2F;PublishMarkdown 背景">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://www.paincker.com/blog-imgs/dev/images/e7c5ce6a9fb683e8a13381909929bf40.png">
<meta property="article:published_time" content="2020-02-04T08:59:17.000Z">
<meta property="article:modified_time" content="2022-05-22T16:49:31.252Z">
<meta property="article:author" content="jzj1993">
<meta property="article:tag" content="编程">
<meta property="article:tag" content="Markdown">
<meta property="article:tag" content="node">
<meta property="article:tag" content="electron">
<meta property="article:tag" content="vue">
<meta property="article:tag" content="开源">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.paincker.com/blog-imgs/dev/images/e7c5ce6a9fb683e8a13381909929bf40.png">

<link rel="canonical" href="https://www.paincker.com/publish-markdown-tech/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>PublishMarkdown技术实现 | Paincker</title>
  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?01cb9081555fb604776b223fe01db45d";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Paincker</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">273</span></a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">111</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">6</span></a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.paincker.com/publish-markdown-tech/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="jzj1993">
      <meta itemprop="description" content="江子健的个人博客，90后理工男、微软程序员、互联网从业者，分享软件编程、开发技术、学习与思考">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Paincker">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          PublishMarkdown技术实现
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-04 16:59:17" itemprop="dateCreated datePublished" datetime="2020-02-04T16:59:17+08:00">2020-02-04</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/develop/" itemprop="url" rel="index"><span itemprop="name">开发技术</span></a>
                </span>
            </span>

          
            <span id="/publish-markdown-tech/" class="post-meta-item leancloud_visitors" data-flag-title="PublishMarkdown技术实现" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/publish-markdown-tech/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/publish-markdown-tech/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>7k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>6 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>先附上Publish Markdown的GitHub主页地址：<a target="_blank" rel="noopener" href="https://github.com/jzj1993/PublishMarkdown">https://github.com/jzj1993/PublishMarkdown</a></p>
<h2 id="背景">背景</h2>
<p>PublishMarkdown的背景详见另一篇文章 <a href="http://www.paincker.com/publish-markdown">WordPress+PublishMarkdown快速构建个人博客</a></p>
<h2 id="整体技术选型">整体技术选型</h2>
<p>因为希望这个工具可以同时支持主流桌面平台，并复用一套代码降低开发成本，对基于Java、Python等语言的常见GUI界面实现方案都做了一些研究，最后发现最容易的还是基于node.js的框架，一个是Electron，另一个是NW.js，最后选择了用户更多的Electron。</p>
<p>前端界面上，使用Web前端技术栈即可开发跨平台的界面，而基于<code>electron-vue</code>构建，还能直接用Vue做界面，更加方便了。</p>
<p>后台逻辑上，node.js可以直接使用的第三方node模块也非常多，其中包括最核心的Markdown渲染库，毕竟自己实现可靠的Markdown渲染还是有较大难度的。</p>
<h2 id="整体渲染流程">整体渲染流程</h2>
<p>PublishMarkdown的整体渲染流程示意图如下，后文会详细分析。</p>
<p><img data-src="/blog-imgs/dev/images/e7c5ce6a9fb683e8a13381909929bf40.png" alt=""></p>
<h2 id="文件格式、文章属性与front-matter">文件格式、文章属性与front-matter</h2>
<p>PublishMarkdown允许打开扩展名为md、编码为UTF-8的文本文件，正文使用Markdown语法编写。</p>
<p>Markdown本身只包含文章正文内容。但是发布一篇博客，除了正文内容，还希望同时设置文章的很多额外属性（Meta信息），包括标题、摘要、作者、发布时间、标签、分类、固定链接等。这个时候就需要<code>front-matter</code>上场了。在md文件开头用<code>---</code>分隔一个区域，使用YAML语法格式配置文章的各种属性，之后才是Markdown正文内容。</p>
<p>解析源文件时，先整体经过<code>front-matter</code>将Meta信息解析出来，同时获得body，即Markdown的文本，再由Markdown渲染器渲染。</p>
<p>PublishMarkdown支持的文章属性、编写格式和相关说明如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line"></span><br><span class="line"># 注释：文件开头使用YAML语法配置文章信息，之后是正常的Markdown语法</span><br><span class="line"></span><br><span class="line"># 此处如果不配置标题，则提取Markdown中的一级标题，或使用文件名</span><br><span class="line">title: Sample</span><br><span class="line"></span><br><span class="line"># 此处如果不配置摘要，则从正文提取开头若干文字</span><br><span class="line">abstract: 你好！这是一篇示例文档！</span><br><span class="line"></span><br><span class="line"># URL用于固定链接、编辑文章功能，建议所有文章都配置</span><br><span class="line">url: sample</span><br><span class="line"></span><br><span class="line"># 文章发布时间，使用的时区和系统设置一致，不设置则使用当前时间</span><br><span class="line">date: 2015-07-30 18:35:43</span><br><span class="line"></span><br><span class="line"># 文章分类</span><br><span class="line">category:</span><br><span class="line">- 分类1</span><br><span class="line">- 分类2</span><br><span class="line"></span><br><span class="line"># 文章标签</span><br><span class="line">tags:</span><br><span class="line">- 标签1</span><br><span class="line">- 标签2</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line"># Markdown内容</span><br><span class="line">## 二级标题</span><br><span class="line"></span><br><span class="line">段落</span><br></pre></td></tr></table></figure>
<h2 id="本地预览">本地预览</h2>
<p>在Electron环境下，因为本身就是基于HTML实现界面的，因此预览渲染好的HTML比较容易，直接把生成的HTML放到界面中就好了，用Vue的<code>v-html</code>指令即可实现。</p>
<h2 id="远程发布">远程发布</h2>
<p>远程发布目前支持MetaWeblog接口，兼容WordPress等博客，使用node库<code>metaweblog-api</code>实现。</p>
<p>支持配置多个站点，同时发布到多个博客。</p>
<p>文章有创建和编辑两种操作模式。对于某一个站点，首次使用PublishMarkdown发布一篇文章时为创建模式，发布成功后会将文章的url和远程返回的id缓存起来，下次发布相同url的文章时，会提示编辑文章还是创建新文章。其中url为固定链接，在文章开头使用YAML格式配置。<strong>如果没有配置url则不会执行缓存策略，之后也无法使用本工具更新远程文章。</strong></p>
<h2 id="Markdown的渲染">Markdown的渲染</h2>
<p>NPM仓库中的Markdown渲染库有很多种。一开始用的是性能比较好的<code>marked</code>，但是后来发现性能虽然好，但是可扩展性不是很好，难以满足Markdown渲染的一些需要。受限于技术能力，自己直接去改源码又比较困难。</p>
<p>对比了很多同类模块，终于发现<code>markdown-it</code>才是我想要的渲染库，因为它支持各种插件，包括删除线、下划线、代码高亮、MathJax等语法的插件，灵活性很高。</p>
<h2 id="图片的预览和上传">图片的预览和上传</h2>
<h3 id="图片的预览">图片的预览</h3>
<p>PublishMarkdown中，图片支持网络图片和本地图片，本地图片支持相对路径和绝对路径。</p>
<p>Markdown渲染器在渲染时，会把图片路径原封不动的放到img标签的src属性中，而Electron环境相当于浏览器，网络图片可以直接加载，但是本地图片不能通过src中的原始文件路径加载。</p>
<p>为了在Electron中显示本地图，通过DOM操作将src属性中的本地文件路径替换成完整的<code>file://</code>格式，例如<code>/home/doc/article.md</code>文件中通过相对路径引用了<code>img/demo.png</code>，src会被替换成<code>file:///home/doc/img/demo.png</code>。同时，还需要设置Electron中的webSecurity属性以允许加载本地图。</p>
<h3 id="图片的上传">图片的上传</h3>
<p>使用Markdown写博客的人在插入图片时常有两种方式，一种是写文章时直接把图片上传到图床；另一种是图片放在本地，发布时再统一上传，两种方式各有优缺点，在<a href="http://www.paincker.com/publish-markdown">WordPress+PublishMarkdown快速构建个人博客</a>一文中已经做过分析。</p>
<p>使用PublishMarkdown发布博客时，上述两种方式都是没问题的。PublishMarkdown会自动判断图片地址，如果是网络图片，就直接发布原始HTML引用图片链接；如果是本地图片文件，则批量上传图片到博客站点，获取到生成的URL，修改正文的HTML，把引用从<code>file://</code>改为图片URL。</p>
<p>PublishMarkdown会对每个站点上传过的图片MD5和URL分别做缓存。下次该站点上传相同图片时，如果根据MD5判断图片已上传，且验证图片URL可用（使用HEAD方法发HTTP请求），就不需要重复上传图片了。这个功能主要用于编辑已经发布的博客，避免重复上传相同图片。</p>
<h2 id="代码高亮">代码高亮</h2>
<p>代码高亮使用<code>highlight.js</code>渲染，支持180+种编程语言。</p>
<h3 id="整体流程">整体流程</h3>
<p>1、代码在Markdown中的编写格式如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">行内代码 `int a = 1`。</span><br><span class="line"></span><br><span class="line">代码块（设置使用的编程语言为js）：</span><br><span class="line"></span><br><span class="line">​```js</span><br><span class="line">const axios = require(&quot;axios&quot;);</span><br><span class="line">// ...</span><br><span class="line">​```</span><br></pre></td></tr></table></figure>
<p>2、经过<code>markdown-it</code>处理，行内代码渲染成<code>&lt;code&gt;原始代码&lt;/code&gt;</code>，代码块渲染成<code>&lt;pre&gt;&lt;code class=&quot;language-js&quot;&gt;原始代码&lt;/code&gt;&lt;/pre&gt;</code>。</p>
<p>3、再经过<code>highlight.js</code>渲染，会根据语法规则拆分成不同类型的代码片段，最后用CSS实现不同的颜色。例如js代码块中的一行 <code>const axios = require(&quot;axios&quot;);</code> 会被渲染成下面的HTML代码。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">pre</span>&gt;</span><span class="tag">&lt;<span class="name">code</span> <span class="attr">class</span>=<span class="string">&quot;language-js hljs javascript&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;hljs-keyword&quot;</span>&gt;</span>const<span class="tag">&lt;/<span class="name">span</span>&gt;</span> axios = <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;hljs-built_in&quot;</span>&gt;</span>require<span class="tag">&lt;/<span class="name">span</span>&gt;</span>(<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;hljs-string&quot;</span>&gt;</span>&quot;axios&quot;<span class="tag">&lt;/<span class="name">span</span>&gt;</span>);<span class="tag">&lt;/<span class="name">code</span>&gt;</span><span class="tag">&lt;/<span class="name">pre</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>4、最终显示的效果如下：</p>
<p>行内代码 <code>int a = 1</code>。</p>
<p>代码块：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> axios = <span class="built_in">require</span>(<span class="string">&quot;axios&quot;</span>);</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure>
<h3 id="发布博客时的渲染">发布博客时的渲染</h3>
<p>在PublishMarkdown中，原始代码在预览和发布时经过的渲染步骤不完全相同，实现最终的代码高亮有多种方案。</p>
<p>1、发布时不渲染。只经过<code>markdown-it</code>，将行内代码转换成<code>&lt;code&gt;原始代码&lt;/code&gt;</code>，代码块渲染成<code>&lt;pre&gt;&lt;code lang=&quot;js&quot;&gt;原始代码&lt;/code&gt;&lt;/pre&gt;</code>，发布到博客。在博客站点中配置<code>highlight.js</code>前端插件（WordPress中安装<code>WP Code Highlight.js</code>插件），用户访问博客时，在用户浏览器中对代码做高亮处理。这是PublishMarkdown推荐的做法，也是为知笔记最新版本发布时的做法。</p>
<p>2、发布时渲染。经过<code>markdown-it</code>和<code>highlight.js</code>， 直接将代码渲染成最终的HTML。博客中配置CSS实现高亮。这种方式适合第三方博客站点没法自行配置代码高亮插件、但是支持CSS配置的情形。这是为知笔记早期版本发布时的做法。在PublishMarkdown中，设置代码高亮在预览和发布时都渲染即可。</p>
<p>3、内联CSS样式。在方案2的基础上，把高亮用到的CSS也内嵌到HTML的style中。这种方式适合第三方站点完全不可配置但是又想使用高亮代码的情况。PublishMarkdown暂不支持CSS样式内链到HTML。</p>
<h2 id="MathJax公式渲染">MathJax公式渲染</h2>
<h3 id="整体流程-2">整体流程</h3>
<p>1、在<a target="_blank" rel="noopener" href="https://pandoc.org/MANUAL.html#math">Pandoc</a>中规定了插入MathJax公式使用的格式，即使用美元符号<code>$</code>分割，具体规则如下。PublishMarkdown中使用了相同的格式用于插入MathJax公式。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">行内公式在单个美元符号之间 $\frac&#123;a&#125;&#123;b&#125;$。如果美元符号紧跟数字，不会识别为行内公式 $20,000 and $30,000。如果起始美元符号紧跟空格，或终止美元符号前面是空格，也不会识别为公式 $ \frac&#123;a&#125;&#123;b&#125; $。</span><br><span class="line"></span><br><span class="line">行内代码不识别为公式 `$\frac&#123;a&#125;&#123;b&#125;$`。</span><br><span class="line"></span><br><span class="line">行间公式在两个美元符号之间。同样，代码块不识别为公式。</span><br><span class="line">$$ U_o = A^2 * ( U_+ - U_- ) $$</span><br></pre></td></tr></table></figure>
<p>2、Markdown源码会通过MarkdownIt的插件markdown-it-mathjax，并将符合规则的公式识别出来，并替换成标准的MathJax分隔符格式，InlineMath分隔符为<code>\(...\)</code>，DisplayMath分隔符为<code>\[...\]</code>。</p>
<p>3、由MathJax渲染成相应的HTML代码。</p>
<p>4、渲染后的效果如下：</p>
<p>行内公式在单个美元符号之间 $\frac{a}{b}$。如果美元符号紧跟数字，不会识别为行内公式 $20,000 and $30,000。如果起始美元符号紧跟空格，或终止美元符号前面是空格，也不会识别为公式 $ \frac{a}{b} $。</p>
<p>行内代码不识别为公式 <code>$\frac&#123;a&#125;&#123;b&#125;$</code>。</p>
<p>行间公式在两个美元符号之间。同样，代码块不识别为公式。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$$ U_o = A^2 * ( U_+ - U_- ) $$</span><br></pre></td></tr></table></figure>
<h3 id="技术细节">技术细节</h3>
<p>由于MathJax渲染比较慢，为了提高性能，仅在有MathJax数学公式时才会调用。为此对插件<code>markdown-it-mathjax</code>做了一点修改，Markdown渲染完成时会返回文章中是否有公式。</p>
<p>MathJax官方提供了前端渲染和后端渲染两种库，前端库用于在浏览器环境下渲染，后端库在Node.js环境下渲染，然而在Electron环境下都不能正常工作。被坑了之后才发现第三方的<code>mathjax-electron</code>前端库比较好用，为了获得渲染好的HTML同时用于预览和发布，渲染时先创建一个不可见的div，渲染完成后再将div中的HTML返回，最后删除div。</p>
<h3 id="发布博客时的渲染-2">发布博客时的渲染</h3>
<p>和代码高亮相同，发布博客时，MathJax有发布时不渲染、发布时渲染、内联CSS样式三种方案，PublishMarkdown支持前两种方案，不再重复说明。对于WordPress，可以安装<code>Simple Mathjax</code>插件渲染公式，并设置<code>Custom mathjax config</code>参数如下。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">MathJax.Hub.Config(&#123;</span><br><span class="line">    <span class="attr">tex2jax</span>: &#123;</span><br><span class="line">        <span class="attr">inlineMath</span>: [[<span class="string">&#x27;\\(&#x27;</span>, <span class="string">&#x27;\\)&#x27;</span>]],</span><br><span class="line">        <span class="attr">displayMath</span>: [[<span class="string">&#x27;\\[&#x27;</span>,<span class="string">&#x27;\\]&#x27;</span>]]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果配置后博客加载慢，可尝试设置<code>Custom mathjax CDN</code>参数为<code>https://cdn.bootcss.com/mathjax/2.7.3/MathJax.js?config=TeX-MML-AM_CHTML</code></p>
</blockquote>
<h2 id="遇到的困难">遇到的困难</h2>
<p>开发PublishMarkdown的过程中遇到了一些困难，这里做个简单的总结和回顾。</p>
<h3 id="1、首先就是没有头绪">1、首先就是没有头绪</h3>
<p>同类工具不是很常见，开源的完整项目更是少之又少，一些东西网上很难找到。不像之前做Android开发，很多问题在谷歌的第一页几乎就能找到答案并且是中文的（这里不得不感叹移动开发近几年的火爆程度），而这个工具遇到的一些问题要尝试各种中英文关键词，多看一些博客才有进展。</p>
<p>从产品设计的角度，没想好怎么更好的解决一些实际问题，同时兼顾技术实现的可能性。例如怎么给Markdown文件配置额外的Meta信息，是应该用一个独立的数据库统一管理，还是在文件中按照固定格式编写，还是给每个文章单独编写配置文件？</p>
<p>从技术层面来说，所有东西都自己实现不现实，必然要用一些第三方的库，但是需求本身也就不明确的情况下，也不知道搜索什么关键词好。例如<code>front-matter</code>，是在我看了很多篇讨论如何自行开发Markdown编辑器的博客才意外发现的（可惜大部分文章也只是文章，要么项目没开发完，要么没开源，要么效果太差）。</p>
<h3 id="2、需要学习的新知识比较多">2、需要学习的新知识比较多</h3>
<p>因为自己之前一直做Android为主，前端开发经验并不算丰富，很多东西都是临时各种找，包括一些CSS属性的使用、DOM操作等基础问题。</p>
<p>Electron、Vue都比较生疏，需要时不时去看入门基础知识。</p>
<p>还要临时查看各种第三方库的用法，包括做一些对比。例如<code>marked.js</code>,<code>markdown-it</code>的用法，在不太能看懂源码的情况下，实现某些特殊需求就有点难办，比如想从Markdown中提取标题。WordPress博客接口有很多种，一开始想用RestAPI，看了半天才发现RestAPI必须在博客中装插件用于用户身份鉴定。MathJax渲染填坑更是差点让人丧失信心，因为完全按照官方文档使用竟然不奏效，大概是因为和Electron特殊的运行环境有冲突。</p>
<h3 id="3、开发环境相关问题较多">3、开发环境相关问题较多</h3>
<p>用Electron开发跨平台桌面应用很轻松高效，原因是Electron本身已经封装好了复杂的底层技术，既有node.js的东西，又有前端技术，还要内嵌浏览器，提供窗口管理的js接口，跨操作系统打包。</p>
<p>配置使用Electron的第一步就会感受到天朝特色，依赖下载不了，需要设置npm或者yarn使用taobao镜像。</p>
<p>Electron使用到了前端开发技术栈，而前端开发的环境配置向来比较复杂，幸亏有现成的<code>electron-vue</code>，不然仅仅是WebPack的配置就足够让人头大了。</p>
<p>使用<code>electron-builder</code>打包也遇到了不少意外。期间遇到一个问题，打出来的安装包尺寸非常大，达到了100MB（一个小工具尺寸这么大恐怕很多人难以接受），而同样基于Electron的其他应用，安装包只有不到50MB，网上找了不少Electron包瘦身的文章，还是百思不得其解。于是只好写一个空的Demo也打包，把两个程序包解压出来对比，发现多了一个<code>app.asar.unpacked</code>文件，还在GitHub给人提了个<a target="_blank" rel="noopener" href="https://github.com/electron-userland/electron-builder/issues/3573">Issue</a>。最后自己找到了原因出在<code>vuex-electron</code>声明的依赖不合理，导致无用文件被错误的打包了进去。跨平台打包和测试，还需要多种操作系统环境，倒腾虚拟机也花费了一些时间。</p>
<h2 id="其他可开发功能">其他可开发功能</h2>
<p>PublishMarkdown目前已经可以满足常见的博客发布需求。这里再列举一些其他可以开发的功能，但是不一定有时间开发这些了，有兴趣的人可以一起开发。</p>
<ul>
<li>本地直接查看渲染后的HTML。</li>
<li>图片批量上传到指定图床，而不是博客站点。</li>
<li>支持更多Meta属性，例如针对WordPress的特色图片、SEO参数等。</li>
<li>支持更多扩展的Markdown语法，例如流程图 <a target="_blank" rel="noopener" href="https://bramp.github.io/js-sequence-diagrams/">js-sequence</a>，<a target="_blank" rel="noopener" href="http://flowchart.js.org/">flowchart.js</a>，<a target="_blank" rel="noopener" href="https://knsv.github.io/mermaid/#/">mermaid</a> 等。参考自<a target="_blank" rel="noopener" href="https://support.typora.io/Draw-Diagrams-With-Markdown/">Typora文档</a></li>
<li>支持MetaWeblog博客接口以外的其他平台。例如同步发布到微信公众号（通过模拟网页点击实现，有一定的复杂度）。</li>
<li>发布时支持内联CSS样式到HTML。感觉似乎不是很有必要。</li>
<li>Markdown编辑功能加强。开发成本较高，并且没有很大必要，毕竟跨平台好用的Markdown编辑器已经不少了，例如Typora、Haroopad等。推荐先用其他工具编辑好，再用PublishMarkdown发布。</li>
</ul>

    </div>

    
    
    
      
  <div class="popular-posts-header">相关文章</div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/publish-markdown/" rel="bookmark">WordPress+PublishMarkdown快速构建个人博客</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/java-collections/" rel="bookmark">Java数据结构与集合学习笔记</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/dynamic-proxy-java-bus/" rel="bookmark">一种基于动态代理实现的Android/Java总线通信组件</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/code-design/" rel="bookmark">代码设计的三重境界</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/infer/" rel="bookmark">空指针静态代码检查工具Infer</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/dont-make-me-think/" rel="bookmark">Don't make me think思想在代码设计中的应用</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/android-resource-naming/" rel="bookmark">Android项目资源文件命名规范参考</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/android-lint-2-implements/" rel="bookmark">Android Lint：自定义Lint调试与开发</a></div>
    </li>
  </ul>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E7%BC%96%E7%A8%8B/" rel="tag"># 编程</a>
              <a href="/tags/Markdown/" rel="tag"># Markdown</a>
              <a href="/tags/node/" rel="tag"># node</a>
              <a href="/tags/electron/" rel="tag"># electron</a>
              <a href="/tags/vue/" rel="tag"># vue</a>
              <a href="/tags/%E5%BC%80%E6%BA%90/" rel="tag"># 开源</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/publish-markdown/" rel="prev" title="WordPress+PublishMarkdown快速构建个人博客">
      <i class="fa fa-chevron-left"></i> WordPress+PublishMarkdown快速构建个人博客
    </a></div>
      <div class="post-nav-item">
    <a href="/dynamic-proxy-java-bus/" rel="next" title="一种基于动态代理实现的Android/Java总线通信组件">
      一种基于动态代理实现的Android/Java总线通信组件 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%83%8C%E6%99%AF"><span class="nav-number">1.</span> <span class="nav-text">背景</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B4%E4%BD%93%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B"><span class="nav-number">2.</span> <span class="nav-text">整体技术选型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B4%E4%BD%93%E6%B8%B2%E6%9F%93%E6%B5%81%E7%A8%8B"><span class="nav-number">3.</span> <span class="nav-text">整体渲染流程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F%E3%80%81%E6%96%87%E7%AB%A0%E5%B1%9E%E6%80%A7%E4%B8%8Efront-matter"><span class="nav-number">4.</span> <span class="nav-text">文件格式、文章属性与front-matter</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%AC%E5%9C%B0%E9%A2%84%E8%A7%88"><span class="nav-number">5.</span> <span class="nav-text">本地预览</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%9C%E7%A8%8B%E5%8F%91%E5%B8%83"><span class="nav-number">6.</span> <span class="nav-text">远程发布</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Markdown%E7%9A%84%E6%B8%B2%E6%9F%93"><span class="nav-number">7.</span> <span class="nav-text">Markdown的渲染</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%BE%E7%89%87%E7%9A%84%E9%A2%84%E8%A7%88%E5%92%8C%E4%B8%8A%E4%BC%A0"><span class="nav-number">8.</span> <span class="nav-text">图片的预览和上传</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9B%BE%E7%89%87%E7%9A%84%E9%A2%84%E8%A7%88"><span class="nav-number">8.1.</span> <span class="nav-text">图片的预览</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9B%BE%E7%89%87%E7%9A%84%E4%B8%8A%E4%BC%A0"><span class="nav-number">8.2.</span> <span class="nav-text">图片的上传</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E9%AB%98%E4%BA%AE"><span class="nav-number">9.</span> <span class="nav-text">代码高亮</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B4%E4%BD%93%E6%B5%81%E7%A8%8B"><span class="nav-number">9.1.</span> <span class="nav-text">整体流程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%91%E5%B8%83%E5%8D%9A%E5%AE%A2%E6%97%B6%E7%9A%84%E6%B8%B2%E6%9F%93"><span class="nav-number">9.2.</span> <span class="nav-text">发布博客时的渲染</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MathJax%E5%85%AC%E5%BC%8F%E6%B8%B2%E6%9F%93"><span class="nav-number">10.</span> <span class="nav-text">MathJax公式渲染</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B4%E4%BD%93%E6%B5%81%E7%A8%8B-2"><span class="nav-number">10.1.</span> <span class="nav-text">整体流程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8A%80%E6%9C%AF%E7%BB%86%E8%8A%82"><span class="nav-number">10.2.</span> <span class="nav-text">技术细节</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%91%E5%B8%83%E5%8D%9A%E5%AE%A2%E6%97%B6%E7%9A%84%E6%B8%B2%E6%9F%93-2"><span class="nav-number">10.3.</span> <span class="nav-text">发布博客时的渲染</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%81%87%E5%88%B0%E7%9A%84%E5%9B%B0%E9%9A%BE"><span class="nav-number">11.</span> <span class="nav-text">遇到的困难</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%E3%80%81%E9%A6%96%E5%85%88%E5%B0%B1%E6%98%AF%E6%B2%A1%E6%9C%89%E5%A4%B4%E7%BB%AA"><span class="nav-number">11.1.</span> <span class="nav-text">1、首先就是没有头绪</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%E3%80%81%E9%9C%80%E8%A6%81%E5%AD%A6%E4%B9%A0%E7%9A%84%E6%96%B0%E7%9F%A5%E8%AF%86%E6%AF%94%E8%BE%83%E5%A4%9A"><span class="nav-number">11.2.</span> <span class="nav-text">2、需要学习的新知识比较多</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3%E3%80%81%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98%E8%BE%83%E5%A4%9A"><span class="nav-number">11.3.</span> <span class="nav-text">3、开发环境相关问题较多</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%B6%E4%BB%96%E5%8F%AF%E5%BC%80%E5%8F%91%E5%8A%9F%E8%83%BD"><span class="nav-number">12.</span> <span class="nav-text">其他可开发功能</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">jzj1993</p>
  <div class="site-description" itemprop="description">江子健的个人博客，90后理工男、微软程序员、互联网从业者，分享软件编程、开发技术、学习与思考</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">273</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">111</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/jzj1993" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;jzj1993" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      友情链接
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="http://www.dappchaser.com/" title="http:&#x2F;&#x2F;www.dappchaser.com" rel="noopener" target="_blank">DAppChaser</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.chenwenguan.com/" title="https:&#x2F;&#x2F;www.chenwenguan.com&#x2F;" rel="noopener" target="_blank">陈文管的博客</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://yifeiyuan.me/" title="http:&#x2F;&#x2F;yifeiyuan.me&#x2F;" rel="noopener" target="_blank">程序亦非猿</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.trinea.cn/" title="https:&#x2F;&#x2F;www.trinea.cn&#x2F;" rel="noopener" target="_blank">Trinea</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://blog.weshinekx.cn/" title="https:&#x2F;&#x2F;blog.weshinekx.cn&#x2F;" rel="noopener" target="_blank">Shinya</a>
        </li>
    </ul>
  </div>

      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">jzj1993</span>
</div>
  <div class="sitemap"><a href="/sitemap.xml" class="theme-link">站点地图</a>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/medium-zoom@1/dist/medium-zoom.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>

<script src="/js/utils.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : true,
      notify     : true,
      appId      : '3YlzwEecQlMdJPH9KEbFt6PX-gzGzoHsz',
      appKey     : 'raIB2P7DewB4SAboVtpHakbh',
      placeholder: "输入评论...",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '20' || 10,
      visitor    : true,
      lang       : 'zh-cn' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>

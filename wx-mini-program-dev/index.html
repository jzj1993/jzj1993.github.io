<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/logo-128.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/logo-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/logo-16.png">
  <link rel="mask-icon" href="/images/logo-128.png" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.paincker.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="备注：文章写的比较早，一直没发出来，里面有些内容可能和小程序最新的情况有一点点差异……  最近接触小程序开发，遇到了大量的坑，做个总结分(tu)享(cao)一下。">
<meta property="og:type" content="article">
<meta property="og:title" content="微信小程序开发填坑指南">
<meta property="og:url" content="https://www.paincker.com/wx-mini-program-dev/">
<meta property="og:site_name" content="Paincker">
<meta property="og:description" content="备注：文章写的比较早，一直没发出来，里面有些内容可能和小程序最新的情况有一点点差异……  最近接触小程序开发，遇到了大量的坑，做个总结分(tu)享(cao)一下。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2020-03-03T16:58:24.000Z">
<meta property="article:modified_time" content="2022-01-10T16:05:15.729Z">
<meta property="article:author" content="jzj1993">
<meta property="article:tag" content="Node.js">
<meta property="article:tag" content="前端">
<meta property="article:tag" content="小程序">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://www.paincker.com/wx-mini-program-dev/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>微信小程序开发填坑指南 | Paincker</title>
  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?01cb9081555fb604776b223fe01db45d";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Paincker</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">264</span></a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">108</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">6</span></a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.paincker.com/wx-mini-program-dev/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="jzj1993">
      <meta itemprop="description" content="江子健的个人博客，90后理工男、微软程序员、互联网从业者，分享软件编程、开发技术、学习与思考">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Paincker">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          微信小程序开发填坑指南
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-03-04 00:58:24" itemprop="dateCreated datePublished" datetime="2020-03-04T00:58:24+08:00">2020-03-04</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/develop/" itemprop="url" rel="index"><span itemprop="name">开发技术</span></a>
                </span>
            </span>

          
            <span id="/wx-mini-program-dev/" class="post-meta-item leancloud_visitors" data-flag-title="微信小程序开发填坑指南" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/wx-mini-program-dev/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/wx-mini-program-dev/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>7k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>6 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <blockquote>
<p>备注：文章写的比较早，一直没发出来，里面有些内容可能和小程序最新的情况有一点点差异……</p>
</blockquote>
<p>最近接触小程序开发，遇到了大量的坑，做个总结分(tu)享(cao)一下。</p>
<p>主要介绍坑，以及填坑的思路方向，具体实现细节略过。</p>
<blockquote>
<p>小程序坑很多，网上已经有很多文章了，例如</p>
<p><a target="_blank" rel="noopener" href="https://www.google.com/search?q=%E5%B0%8F%E7%A8%8B%E5%BA%8F+%E5%9D%91">https://www.google.com/search?q=小程序+坑</a></p>
</blockquote>
<h2 id="小程序组件高度设置全屏">小程序组件高度设置全屏</h2>
<p>用CSS设置最外层组件属性<code>height: 100%</code>时不能实现高度全屏，设置为<code>height: 100vh</code>即可。</p>
<h2 id="小程序加载图片填坑">小程序加载图片填坑</h2>
<p>加载图片有多种情况：</p>
<ol>
<li>网络图片（http/https）</li>
<li>代码包文件（即小程序代码中的静态资源图片）</li>
<li>小程序云文件</li>
<li>Base64编码的图片数据（js对象的数据类型为<code>String</code>）</li>
<li>本地图片文件（即文件系统中的图片，例如从系统相册选择的，以及下载下来的临时文件等）</li>
<li>未经编码的原始图片数据（即Bitmap格式，js对象的数据类型为<code>ArrayBuffer</code>）</li>
<li>编码过的图片数据（即PNG、JPG等格式，js对象的数据类型为<code>ArrayBuffer</code>）</li>
</ol>
<h3 id="网络图片、代码包图片、小程序云文件">网络图片、代码包图片、小程序云文件</h3>
<p>这几种都比较简单，直接用image组件的src属性即可。网络请求限制必须https而不能是http，图片目前不限制。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;/image/arrowright.png&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;aspectFill&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>image组件参考 <a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/component/image.html">https://developers.weixin.qq.com/miniprogram/dev/component/image.html</a></p>
</blockquote>
<blockquote>
<p>代码包文件可参考 <a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/framework/ability/file-system.html">https://developers.weixin.qq.com/miniprogram/dev/framework/ability/file-system.html</a></p>
</blockquote>
<h3 id="Base64图片">Base64图片</h3>
<p>直接设置给image组件即可</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;data:image/png;base64,图片base64数据&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;aspectFill&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="本地文件">本地文件</h3>
<p>小程序的<code>image</code>组件src属性设置为本地图片发现不能显示。</p>
<p>1、如果只是全屏查看图片，或者简易的保存图片、分享朋友圈功能，直接使用小程序自带的图片预览<code>wx.previewImage</code>即可。</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/api/media/image/wx.previewImage.html">https://developers.weixin.qq.com/miniprogram/dev/api/media/image/wx.previewImage.html</a></p>
</blockquote>
<p>2、绘制到Canvas上。可以用<code>CanvasContext.drawImage</code>绘制，参数为图片路径。</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/api/canvas/CanvasContext.drawImage.html">https://developers.weixin.qq.com/miniprogram/dev/api/canvas/CanvasContext.drawImage.html</a></p>
</blockquote>
<p>3、读取文件数据并转成Base64显示。以png格式图片示例代码如下。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;image&#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> base64 = wx.arrayBufferToBase64(data)</span><br><span class="line"><span class="built_in">this</span>.image = <span class="string">&#x27;data:image/png;base64,&#x27;</span> + base64</span><br></pre></td></tr></table></figure>
<blockquote>
<p>备注：在网页环境下通常还可以把arraybuffer转成Blob格式显示，但是由于小程序目前不支持Blob，所以只能用Base64格式了。可参考 <a target="_blank" rel="noopener" href="https://github.com/abbshr/abbshr.github.io/issues/28">https://github.com/abbshr/abbshr.github.io/issues/28</a></p>
</blockquote>
<p>4、上传到服务器转换成网络图片，再用image组件加载。可以用<code>wx.uploadFile</code>或者<code>wx.request</code>网络请求上传。</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/api/network/upload/wx.uploadFile.html">https://developers.weixin.qq.com/miniprogram/dev/api/network/upload/wx.uploadFile.html</a></p>
<p><a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/api/network/request/wx.request.html">https://developers.weixin.qq.com/miniprogram/dev/api/network/request/wx.request.html</a></p>
</blockquote>
<p>5、用<code>wx.cloud.uploadFile</code>上传到小程序云文件，再用image组件加载。</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-client-api/storage/uploadFile.html">https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-client-api/storage/uploadFile.html</a></p>
</blockquote>
<h3 id="未编码图片数据">未编码图片数据</h3>
<p>1、图片数据转换成Base64显示。</p>
<p>2、绘制到Canvas上。可以用<code>wx.canvasPutImageData</code>绘制。</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/api/canvas/wx.canvasPutImageData.html">https://developers.weixin.qq.com/miniprogram/dev/api/canvas/wx.canvasPutImageData.html</a></p>
</blockquote>
<h3 id="已编码图片数据">已编码图片数据</h3>
<p>1、转成Base64显示。</p>
<p>2、写入到临时文件，然后绘制到Canvas上。</p>
<p>3、上传到服务器再用image的src属性加载。</p>
<h2 id="小程序Canvas填坑指南">小程序Canvas填坑指南</h2>
<p>HTML中Canvas的API文档 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API">https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API</a></p>
<p>小程序封装的CanvasContext对应的是HTML中的CanvasRenderingContext2D对象。</p>
<h3 id="Canvas的一些坑总结">Canvas的一些坑总结</h3>
<ul>
<li>
<p>需要注意，不少API和HTML中的Canvas不一样，例如HTML中fillStyle等属性在小程序中都是方法，align和baseline支持的属性值也不一样等等。</p>
</li>
<li>
<p>在小程序中js不能获取DOM树，因此也不能像网页一样随意操作Canvas节点。</p>
</li>
<li>
<p>Canvas是小程序原生组件，有很多注意事项，例如会始终覆盖在其他非原生组件上方等</p>
<blockquote>
<p>原生组件注意事项参考 <a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/component/native-component.html">https://developers.weixin.qq.com/miniprogram/dev/component/native-component.html</a></p>
</blockquote>
</li>
<li>
<p>兼容性不好，有BUG，在Android和iOS上的表现不一致，例如在iOS设备上调用了Canvas.rotate方法可能会导致之后所有的绘制指令失效。被坑惨了，填了很久Canvas的坑，写了一堆代码，在Android上调试一切正常，发布了才发现iOS上完全不能用，最终还是不得不放弃了用Canva生成图片的方案，转而去踩其他坑。。。</p>
</li>
</ul>
<h3 id="Canvas尺寸的获取和适配">Canvas尺寸的获取和适配</h3>
<p>小程序似乎没有提供Canvas获取尺寸的API，又要通过奇怪的手法解决常规问题了。。。</p>
<p>可以使用<code>vw</code>、<code>vh</code>或<code>rpx</code>给Canvas设置尺寸，然后通过<code>wx.getSystemInfo</code>获取窗口尺寸，从而计算出Canvas的真实尺寸。</p>
<p>换算关系：</p>
<ul>
<li>窗口宽度 = 100vw</li>
<li>窗口高度 = 100vh</li>
<li>屏幕宽度 = 750rpx</li>
</ul>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/framework/view/wxss.html">https://developers.weixin.qq.com/miniprogram/dev/framework/view/wxss.html</a></p>
</blockquote>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/api/system/system-info/wx.getSystemInfo.html">https://developers.weixin.qq.com/miniprogram/dev/api/system/system-info/wx.getSystemInfo.html</a></p>
</blockquote>
<h3 id="隐藏Canvas">隐藏Canvas</h3>
<p>有时需要在Canvas不可见的情况下生成图片，但是Canvas是原生组件，始终在其他元素上方，而设置<code>display:none</code>并不会隐藏。此时可以通过CSS设置 <code>left: 10000rpx</code>将其移到屏幕外，或者在Canvas外面嵌套一个元素并设置<code>style=&quot;width:0;height:0;overflow:hidden;&quot;</code>，从而实现效果。</p>
<h3 id="动态添加-移除Canvas">动态添加/移除Canvas</h3>
<p>可以在Canvas标签外包裹一个view标签，然后用<code>wx:if=&quot;&#123;&#123;condition&#125;&#125;</code>控制。</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/framework/view/wxml/conditional.html">https://developers.weixin.qq.com/miniprogram/dev/framework/view/wxml/conditional.html</a></p>
</blockquote>
<h3 id="Canvas文字排版">Canvas文字排版</h3>
<p>Canvas本身不支持文字排版（自动换行等）。</p>
<p>实现<strong>水平文字自动换行</strong>比较简单，循环遍历所有字符调用measure判断，然后拆分成多行即可。</p>
<p><strong>竖向文字排版</strong>相对复杂一些，英文竖向排版文字会旋转，而中文文字不旋转。Canvas的旋转目前有坑，建议放弃……</p>
<h2 id="小程序图片生成填坑">小程序图片生成填坑</h2>
<p>图片生成是一个很麻烦的问题，坑非常多。我做的一个简单的小程序本来两天搞定了，然而由于需要垂直文字排版，用Canvas生成的图片用到rotate，发现在iOS上没法用（前面已经说了），之后换了好几种方案，花了一周才终于解决问题。。。</p>
<p>图片生成有多种方案，下面一一总结。</p>
<h3 id="本地使用Canvas绘制">本地使用Canvas绘制</h3>
<p>好处：</p>
<ul>
<li>不需要处理服务端的问题，更不需要自己搭建服务器、注册域名、备案等</li>
</ul>
<p>缺点：</p>
<ul>
<li>小程序封装的Canvas坑非常多。。。</li>
<li>客户端兼容问题，例如屏幕尺寸不一致等</li>
<li>客户端性能问题，复杂操作可能会导致内存不足崩溃，或者耗时很久</li>
</ul>
<h3 id="利用图床水印功能实现">利用图床水印功能实现</h3>
<p>一些简单的图片合成任务，例如在图片上添加头像、加几个简单的单行文字，可以直接利用七牛云图床的水印功能实现。</p>
<p>详情可参考七牛云的文档</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://developer.qiniu.com/dora/manual/1316/image-watermarking-processing-watermark">https://developer.qiniu.com/dora/manual/1316/image-watermarking-processing-watermark</a></p>
</blockquote>
<p>优点：</p>
<ul>
<li>使用简单，七牛云还支持可视化界面获取水印参数，可以支持多个水印操作</li>
<li>成本低，不需要开发，不用担心客户端兼容、性能问题，也不用担心服务端计算性能和网络性能问题</li>
</ul>
<p>缺点：</p>
<ul>
<li>功能比较单一，稍微复杂一点的需求实现不了</li>
<li>图片固定链接需要绑定七牛云提供的子域名并备案</li>
<li>免费版本流量有限，流量超了就需要收费</li>
</ul>
<h3 id="服务端生成">服务端生成</h3>
<p>服务端生成图片有很多办法，例如用Java实现。这里主要总结Node环境下的开源库。</p>
<h4 id="Sharp">Sharp</h4>
<p><a target="_blank" rel="noopener" href="https://github.com/lovell/sharp">https://github.com/lovell/sharp</a></p>
<ul>
<li>性能比较好，支持的文件格式多。</li>
<li>不支持文本绘制，需要结合 <a target="_blank" rel="noopener" href="https://github.com/shrhdk/text-to-svg">text-to-svg</a> 将文本转成SVG格式的图片，然后用sharp合成。</li>
<li>sharp要通过图层合成图片和文本，每个元素都是一个独立的图层，每次只能合成两个图层。因此如果需要绘制很多元素，代码实现起来会比较繁琐，而且不知道反复合并图层会不会影响性能。</li>
<li>text-to-svg只支持简单的单行文本转图片，文本换行需要自行实现。而如果是竖排文本这种需求，可能得每个字符生成单独的SVG，再用sharp合成，猜测可能会有性能问题。。。</li>
</ul>
<blockquote>
<p>sharp图片库用法总结 <a href="http://www.paincker.com/node-sharp">http://www.paincker.com/node-sharp</a></p>
</blockquote>
<h4 id="Jimp">Jimp</h4>
<p><a target="_blank" rel="noopener" href="https://github.com/oliver-moran/jimp">https://github.com/oliver-moran/jimp</a></p>
<p>相比sharp，Jimp支持的图片格式少一点，但是Jimp原生支持添加文本，没有详细研究。</p>
<h4 id="NodeCanvas">NodeCanvas</h4>
<p><a target="_blank" rel="noopener" href="https://github.com/Automattic/node-canvas">https://github.com/Automattic/node-canvas</a></p>
<p>前面两种图片库都是从图片处理的角度来对图片进行裁剪、缩放、调整、图层合成等操作，而HTML中Canvas的思路则是在画布上绘制，思路不太一样，对于复杂元素的合并，以及复杂的文字排版，用Canvas会更容易。</p>
<p>NodeCanvas是一个可以在后台Node环境下操作Canvas生成图片的库，用起来很方便，几乎实现了HTML中Canvas的所有属性，因此也可以直接复用前端Canvas绘制代码。绘制完成后可以输出文件、数据流等，还可以指定图片的编码格式和压缩比。</p>
<blockquote>
<p>Canvas的API文档 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API">https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API</a></p>
</blockquote>
<p>缺点：NodeCanvas的环境配置问题会多一点。前面两种库都是直接<code>npm install</code>就安装好了，因此甚至可以直接在小程序提供的云函数环境中使用，而不需要自己搭建服务器。而我实际开发，发现NodeCanvas在小程序云环境果然安装失败了，原因没有深入研究，最后干脆改成了自己搭建服务器。</p>
<h4 id="总结">总结</h4>
<p>服务端生成图片的优缺点</p>
<p>优点：</p>
<ul>
<li>不用担心客户端兼容性和性能问题</li>
<li>不再受限于小程序提供的坑爹Canvas API，可以使用任何熟悉的Web技术、语言和开源库实现</li>
<li>灵活性最高，只要能写代码，可以实现很复杂的效果，一种图片库解决不了问题换另一种，实在不行自己实现底层图片操作逻辑。</li>
</ul>
<p>缺点：</p>
<ul>
<li>需要注意，后台生成图片如果需要绘制文本，可能会有字体的问题。例如Linux可能默认不支持中文，导致画出来的中文是乱码，再例如同样的代码同样的字体，在Mac、Windows、Linux环境下绘制出来的效果不一样，因为系统字体实现不一样。可以考虑加载固定的字体文件进行绘制。</li>
<li>环境配置复杂，可能需要自己搭建服务器、注册域名，以及繁琐的备案流程，要花钱。</li>
<li>存在一定的开发运维成本。</li>
<li>图片较大时消耗网络流量，建议编码压缩后再传输。</li>
<li>图片生成逻辑复杂时、用户量较大时消耗性能较多，建议考虑图片缓存，或者配置性能合适的服务器。</li>
</ul>
<h2 id="小程序网络请求域名限制">小程序网络请求域名限制</h2>
<ol>
<li>小程序默认有访问域名限制，需要在后台配置白名单。</li>
<li>开发环境可以配置跳过校验。</li>
<li>小程序必须发起HTTPS请求。</li>
</ol>
<p>详见官方文档 <a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/framework/ability/network.html">https://developers.weixin.qq.com/miniprogram/dev/framework/ability/network.html</a></p>
<h3 id="绕过小程序网络限制">绕过小程序网络限制</h3>
<p>小程序网络限制主要应该是出于安全性的考虑。有没有办法绕过小程序的网络请求限制呢？</p>
<p>办法还是有的，通过小程序云函数转发网络请求即可。云函数转发的方式直接利用小程序提供的网络通道，可以做到<strong>间接访问任意域名、直接用HTTP以及IP地址、任意端口访问服务器，不需要配置域名白名单，还能保证服务器的安全性（不能通过手机抓包获取真实的服务器）。</strong></p>
<p>例如下面的云函数利用axios实现了一个简单的文件下载中转功能（由于云函数似乎不支持返回数据流，因此直接一次性返回了文件完整数据，不宜传输过大文件）。</p>
<p>在小程序端需要下载任意域名下的一张图片时，直接调用该云函数，并将url作为参数传递，即可返回图片的数据，从而进行显示或处理。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> cloud = <span class="built_in">require</span>(<span class="string">&quot;wx-server-sdk&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> axios = <span class="built_in">require</span>(<span class="string">&quot;axios&quot;</span>);</span><br><span class="line"></span><br><span class="line">cloud.init();</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.main = <span class="keyword">async</span> (event, context) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (event.url) &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">await</span> axios(&#123;</span><br><span class="line">      <span class="attr">url</span>: event.url,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&quot;get&quot;</span>,</span><br><span class="line">      <span class="attr">responseType</span>: <span class="string">&quot;arraybuffer&quot;</span></span><br><span class="line">    &#125;)).data;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(<span class="string">&quot;file download require param &#x27;url&#x27;&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="获取小程序码接口填坑">获取小程序码接口填坑</h2>
<p>官方提供了获取小程序码的接口</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/qr-code.html">https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/qr-code.html</a></p>
</blockquote>
<ol>
<li>
<p>对于只需要生成固定小程序码的情况，建议提前生成好，用的时候直接用现成图片即可；对于需要在小程序码中动态添加附加字段信息的情况，才需要调用接口。</p>
</li>
<li>
<p>出于安全考虑，接口所在的域名 <code>api.weixin.qq.com</code> 不能直接在小程序中调用（因为请求中包含了AppID、Secret、Token等加密参数），也不能在后台配置域名白名单，必须通过后台发起（云函数或者服务器），再传给小程序。</p>
</li>
<li>
<p>接口请求失败时会返回Json数据，请求成功后会直接返回图片的二进制数据。<strong>用网络库发起请求时必须指定编码</strong>，否则二进制数据默认会被转成string，这个过程是有损、不可逆的，string再转成二进制数据就和原始数据不一样了，导致保存的图片根本打不开。具体来说就是：</p>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 如果使用request库</span></span><br><span class="line">request.get(&#123;</span><br><span class="line">    <span class="attr">url</span>: url,</span><br><span class="line">    <span class="attr">encoding</span>: <span class="literal">null</span> <span class="comment">// 指定编码</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 如果使用axios库</span></span><br><span class="line">axios(&#123;</span><br><span class="line">    <span class="attr">url</span>: url,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&quot;get&quot;</span>,</span><br><span class="line">    <span class="attr">responseType</span>: <span class="string">&quot;arraybuffer&quot;</span> <span class="comment">// 指定编码</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>参考文章 <a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000002787763">https://segmentfault.com/a/1190000002787763</a></p>
</blockquote>
<h2 id="小程序云函数填坑">小程序云函数填坑</h2>
<p>小程序云函数主机上获取的时间是UTC时区，服务端处理时间时一定要注意时区问题。</p>

    </div>

    
    
    
      
  <div class="popular-posts-header">相关文章</div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/pm2-restart-process/" rel="bookmark">PM2检查进程状态并重启</a></div>
    </li>
  </ul>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Node-js/" rel="tag"># Node.js</a>
              <a href="/tags/%E5%89%8D%E7%AB%AF/" rel="tag"># 前端</a>
              <a href="/tags/%E5%B0%8F%E7%A8%8B%E5%BA%8F/" rel="tag"># 小程序</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/nginx-config/" rel="prev" title="Nginx常用配置整理">
      <i class="fa fa-chevron-left"></i> Nginx常用配置整理
    </a></div>
      <div class="post-nav-item">
    <a href="/android-crash-sdk/" rel="next" title="Android Crash监控SDK设计思路">
      Android Crash监控SDK设计思路 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%BB%84%E4%BB%B6%E9%AB%98%E5%BA%A6%E8%AE%BE%E7%BD%AE%E5%85%A8%E5%B1%8F"><span class="nav-number">1.</span> <span class="nav-text">小程序组件高度设置全屏</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD%E5%9B%BE%E7%89%87%E5%A1%AB%E5%9D%91"><span class="nav-number">2.</span> <span class="nav-text">小程序加载图片填坑</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BD%91%E7%BB%9C%E5%9B%BE%E7%89%87%E3%80%81%E4%BB%A3%E7%A0%81%E5%8C%85%E5%9B%BE%E7%89%87%E3%80%81%E5%B0%8F%E7%A8%8B%E5%BA%8F%E4%BA%91%E6%96%87%E4%BB%B6"><span class="nav-number">2.1.</span> <span class="nav-text">网络图片、代码包图片、小程序云文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Base64%E5%9B%BE%E7%89%87"><span class="nav-number">2.2.</span> <span class="nav-text">Base64图片</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%AC%E5%9C%B0%E6%96%87%E4%BB%B6"><span class="nav-number">2.3.</span> <span class="nav-text">本地文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%AA%E7%BC%96%E7%A0%81%E5%9B%BE%E7%89%87%E6%95%B0%E6%8D%AE"><span class="nav-number">2.4.</span> <span class="nav-text">未编码图片数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B7%B2%E7%BC%96%E7%A0%81%E5%9B%BE%E7%89%87%E6%95%B0%E6%8D%AE"><span class="nav-number">2.5.</span> <span class="nav-text">已编码图片数据</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B0%8F%E7%A8%8B%E5%BA%8FCanvas%E5%A1%AB%E5%9D%91%E6%8C%87%E5%8D%97"><span class="nav-number">3.</span> <span class="nav-text">小程序Canvas填坑指南</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Canvas%E7%9A%84%E4%B8%80%E4%BA%9B%E5%9D%91%E6%80%BB%E7%BB%93"><span class="nav-number">3.1.</span> <span class="nav-text">Canvas的一些坑总结</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Canvas%E5%B0%BA%E5%AF%B8%E7%9A%84%E8%8E%B7%E5%8F%96%E5%92%8C%E9%80%82%E9%85%8D"><span class="nav-number">3.2.</span> <span class="nav-text">Canvas尺寸的获取和适配</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9A%90%E8%97%8FCanvas"><span class="nav-number">3.3.</span> <span class="nav-text">隐藏Canvas</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8A%A8%E6%80%81%E6%B7%BB%E5%8A%A0-%E7%A7%BB%E9%99%A4Canvas"><span class="nav-number">3.4.</span> <span class="nav-text">动态添加&#x2F;移除Canvas</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Canvas%E6%96%87%E5%AD%97%E6%8E%92%E7%89%88"><span class="nav-number">3.5.</span> <span class="nav-text">Canvas文字排版</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%9B%BE%E7%89%87%E7%94%9F%E6%88%90%E5%A1%AB%E5%9D%91"><span class="nav-number">4.</span> <span class="nav-text">小程序图片生成填坑</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%AC%E5%9C%B0%E4%BD%BF%E7%94%A8Canvas%E7%BB%98%E5%88%B6"><span class="nav-number">4.1.</span> <span class="nav-text">本地使用Canvas绘制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A9%E7%94%A8%E5%9B%BE%E5%BA%8A%E6%B0%B4%E5%8D%B0%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="nav-number">4.2.</span> <span class="nav-text">利用图床水印功能实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E7%94%9F%E6%88%90"><span class="nav-number">4.3.</span> <span class="nav-text">服务端生成</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Sharp"><span class="nav-number">4.3.1.</span> <span class="nav-text">Sharp</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Jimp"><span class="nav-number">4.3.2.</span> <span class="nav-text">Jimp</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#NodeCanvas"><span class="nav-number">4.3.3.</span> <span class="nav-text">NodeCanvas</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">4.3.4.</span> <span class="nav-text">总结</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%9F%9F%E5%90%8D%E9%99%90%E5%88%B6"><span class="nav-number">5.</span> <span class="nav-text">小程序网络请求域名限制</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%95%E8%BF%87%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%BD%91%E7%BB%9C%E9%99%90%E5%88%B6"><span class="nav-number">5.1.</span> <span class="nav-text">绕过小程序网络限制</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%A0%81%E6%8E%A5%E5%8F%A3%E5%A1%AB%E5%9D%91"><span class="nav-number">6.</span> <span class="nav-text">获取小程序码接口填坑</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B0%8F%E7%A8%8B%E5%BA%8F%E4%BA%91%E5%87%BD%E6%95%B0%E5%A1%AB%E5%9D%91"><span class="nav-number">7.</span> <span class="nav-text">小程序云函数填坑</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">jzj1993</p>
  <div class="site-description" itemprop="description">江子健的个人博客，90后理工男、微软程序员、互联网从业者，分享软件编程、开发技术、学习与思考</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">264</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">108</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/jzj1993" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;jzj1993" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      友情链接
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="http://www.dappchaser.com/" title="http:&#x2F;&#x2F;www.dappchaser.com" rel="noopener" target="_blank">DAppChaser</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.chenwenguan.com/" title="https:&#x2F;&#x2F;www.chenwenguan.com&#x2F;" rel="noopener" target="_blank">陈文管的博客</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://yifeiyuan.me/" title="http:&#x2F;&#x2F;yifeiyuan.me&#x2F;" rel="noopener" target="_blank">程序亦非猿</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.trinea.cn/" title="https:&#x2F;&#x2F;www.trinea.cn&#x2F;" rel="noopener" target="_blank">Trinea</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://blog.weshinekx.cn/" title="https:&#x2F;&#x2F;blog.weshinekx.cn&#x2F;" rel="noopener" target="_blank">Shinya</a>
        </li>
    </ul>
  </div>

      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">jzj1993</span>
</div>
  <div class="sitemap"><a href="/sitemap.xml" class="theme-link">站点地图</a>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/medium-zoom@1/dist/medium-zoom.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>

<script src="/js/utils.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : true,
      notify     : true,
      appId      : '3YlzwEecQlMdJPH9KEbFt6PX-gzGzoHsz',
      appKey     : 'raIB2P7DewB4SAboVtpHakbh',
      placeholder: "输入评论...",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '20' || 10,
      visitor    : true,
      lang       : 'zh-cn' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>

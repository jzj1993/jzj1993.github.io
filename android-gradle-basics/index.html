<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/logo-128.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/logo-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/logo-16.png">
  <link rel="mask-icon" href="/images/logo-128.png" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.paincker.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="说明 本文主要介绍和Gradle关系密切、相对不容易理解的配置，偏重概念介绍。部分内容是Android特有的（例如ProductFlavor），其他内容则是所有Gradle工程都相同或类似的知识。">
<meta property="og:type" content="article">
<meta property="og:title" content="Android Gradle配置快速入门">
<meta property="og:url" content="https://www.paincker.com/android-gradle-basics/">
<meta property="og:site_name" content="Paincker">
<meta property="og:description" content="说明 本文主要介绍和Gradle关系密切、相对不容易理解的配置，偏重概念介绍。部分内容是Android特有的（例如ProductFlavor），其他内容则是所有Gradle工程都相同或类似的知识。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2017-09-08T12:17:22.000Z">
<meta property="article:modified_time" content="2022-01-10T16:17:51.399Z">
<meta property="article:author" content="jzj1993">
<meta property="article:tag" content="Android">
<meta property="article:tag" content="安卓">
<meta property="article:tag" content="移动开发">
<meta property="article:tag" content="编程">
<meta property="article:tag" content="Gradle">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://www.paincker.com/android-gradle-basics/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Android Gradle配置快速入门 | Paincker</title>
  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?01cb9081555fb604776b223fe01db45d";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Paincker</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">263</span></a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">108</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">6</span></a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.paincker.com/android-gradle-basics/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="jzj1993">
      <meta itemprop="description" content="江子健的个人博客，90后理工男、微软程序员、互联网从业者，分享软件编程、开发技术、学习与思考">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Paincker">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Android Gradle配置快速入门
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-09-08 20:17:22" itemprop="dateCreated datePublished" datetime="2017-09-08T20:17:22+08:00">2017-09-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/develop/" itemprop="url" rel="index"><span itemprop="name">开发技术</span></a>
                </span>
            </span>

          
            <span id="/android-gradle-basics/" class="post-meta-item leancloud_visitors" data-flag-title="Android Gradle配置快速入门" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/android-gradle-basics/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/android-gradle-basics/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>37k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>33 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="说明">说明</h2>
<p>本文主要介绍和Gradle关系密切、相对不容易理解的配置，偏重概念介绍。部分内容是Android特有的（例如ProductFlavor），其他内容则是所有Gradle工程都相同或类似的知识。</p>
<p>对于一些常规且相对简单的配置项，例如签名配置SigningConfig，不做具体介绍。而部分比较复杂且不太常用的内容，例如Manifest的具体合并规则，只做简单说明，并给出深入学习的相关链接，读者可自行阅读。</p>
<p>文章主要基于Gradle V3.3 + Android Gradle Plugin V2.3 + Android Studio 2.3，在后续版本升级后部分内容可能会改变。</p>
<p>文中的内容，有些是根据源码分析得到，有些是参考了官方文档，还有些参考了网上的文章。如有不正确的地方，欢迎指正。</p>
<p>关于Gradle DSL的语法原理和开发相关知识，可参考我的另一篇文章</p>
<blockquote>
<p>Gradle开发快速入门——DSL语法原理与常用API介绍 <a href="http://www.paincker.com/gradle-develop-basics">http://www.paincker.com/gradle-develop-basics</a></p>
</blockquote>
<h2 id="基本问题">基本问题</h2>
<p>开始看本文前，可以思考下面这些关于Gradle的基本问题。文中会对这些问题进行解释。</p>
<ol>
<li>settings.gradle有什么作用？</li>
<li><code>repositories &#123;&#125;</code>语句块的作用？</li>
<li><code>buildscript</code>和<code>allprojects</code>的区别？</li>
<li>ProductFlavor和BuildType的区别？</li>
<li>依赖冲突的原因和常见解决思路？</li>
<li><code>classpath 'com.android.tools.build:gradle:2.2.3'</code>，有什么作用？</li>
<li><code>gradle/wrapper/gradle-wrapper.properties</code>中的这句有什么作用？ <code>distributionUrl=https://services.gradle.org/distributions/gradle-2.14.1-all.zip</code></li>
<li>命令行中，gradle assemble、gradle assembleDebug、gradle build 的关系？</li>
<li>Android Studio环境下，Gradle Sync操作做了什么工作？</li>
</ol>
<h2 id="Gradle">Gradle</h2>
<p>Gradle是一个基于Groovy语言的强大的构建系统，Groovy则是在Java基础上扩展的、运行在JVM上的一种脚本语言。</p>
<p>通过丰富的插件扩展，Gradle可以支持Java、JavaWeb、Groovy、Android等工程的编译，同时可以很方便的从Maven、Ant等迁移过来。</p>
<blockquote>
<p>C系列语言也有相应的Gradle插件，但Gradle支持最好的还是Java系列语言。</p>
</blockquote>
<p>Gradle也是一个命令行可执行程序，可从官网下载Gradle，可执行文件位于<code>bin/gradle</code>。</p>
<p>执行Gradle任务的过程，主要就是在运行Java/Groovy代码。编译期间如果有代码抛出了异常，就会中断编译过程。</p>
<p>在Android Studio中开发时，编译就是基于Gradle实现的。Android Studio中内置了Gradle。</p>
<blockquote>
<p>Gradle官网 <a target="_blank" rel="noopener" href="https://gradle.org/">https://gradle.org/</a></p>
</blockquote>
<h2 id="Gradle-Wrapper">Gradle Wrapper</h2>
<p>用IDEA/Android Studio创建基于Gradle的工程时，默认会在工程根目录创建GradleWrapper，包括<code>gradlew</code>可执行脚本和<code>gradle/wrapper</code>文件夹，其中指定了和工程配套的gradle版本。</p>
<p>在工程根目录下直接执行<code>./gradlew</code>，会自动将参数传给wrapper指定版本的gradle，执行对应的命令；如果本机还没有该版本的gradle，则会先自动下载。</p>
<p>工程配置和Gradle版本通常需要对应，不正确的Gradle版本可能无法正常编译工程，因此推荐使用GradleWrapper执行Gradle命令。</p>
<p><code>gradle/wrapper/gradle-wrapper.properties</code>文件，指定了gradle版本、下载地址、下载的文件存放位置（Mac系统中默认在<code>~/.gradle/wrapper/dists</code>目录）。此文件内容示例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">distributionBase=GRADLE_USER_HOME</span><br><span class="line">distributionPath=wrapper/dists</span><br><span class="line">zipStoreBase=GRADLE_USER_HOME</span><br><span class="line">zipStorePath=wrapper/dists</span><br><span class="line">distributionUrl=https\://services.gradle.org/distributions/gradle-2.14.1-all.zip</span><br></pre></td></tr></table></figure>
<p>在Android Studio/IDEA中，可通过Preferences - Build, Execution, Deployment - Gradle，设置<code>Project-level settings</code>中Use default gradle wrapper，指定Android Studio使用工程配置的Gradle Wrapper。</p>
<h2 id="DSL、DSL-Reference">DSL、DSL Reference</h2>
<p>Gradle使用Groovy语言封装了一整套API，通常把这套API称为DSL（Domain-Specific Languages，领域特定语言）。</p>
<p>通常在我们配置Gradle编译参数时，所写的gradle脚本从形式上来看，像是一门有着特殊语法格式的语言。</p>
<p>Gradle封装的DSL，按照固定格式用很简单的语法就能实现很复杂的配置，大大简化了配置工作。另一方面，也正是由于封装的非常完善，想深入学习Gradle，会感觉无从下手。</p>
<p>可以通过DSL Reference文档查看Gradle DSL支持的语法配置项。例如：</p>
<blockquote>
<p>Gradle DSL Reference（Gradle原生支持的DSL配置） <a target="_blank" rel="noopener" href="https://docs.gradle.org/current/dsl/">https://docs.gradle.org/current/dsl/</a></p>
</blockquote>
<blockquote>
<p>Android Plugin DSL Reference（Android的DSL配置） <a target="_blank" rel="noopener" href="http://google.github.io/android-gradle-dsl/current/">http://google.github.io/android-gradle-dsl/current/</a></p>
</blockquote>
<p>关于Gradle DSL的语法原理和开发相关知识，可参考我的另一篇文章</p>
<blockquote>
<p>Gradle开发快速入门——DSL语法原理与常用API介绍 <a href="http://www.paincker.com/gradle-develop-basics">http://www.paincker.com/gradle-develop-basics</a></p>
</blockquote>
<h2 id="Project、RootProject、SubProject-Module">Project、RootProject、SubProject (Module)</h2>
<p>Project是Gradle中的基本概念之一，即一个工程。一个工程可以包含多个SubProject，也称为Module，最顶层的工程也称为RootProject。</p>
<p>一个标准的Android工程，文件结构如下。</p>
<ul>
<li>每个<code>build.gradle</code>对应一个Project，最外层的是RootProject，里面的app是SubProject。</li>
<li><code>settings.gradle</code>不是必须的，一般在包含子工程时就需要用这个文件指定，即我们通常所见的<code>include ':app'</code>脚本。</li>
<li>这里的<code>':app'</code>就是子工程的名字，通常和文件夹名称对应。</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">settings.gradle</span><br><span class="line">build.gradle</span><br><span class="line">app</span><br><span class="line">    build.gradle</span><br></pre></td></tr></table></figure>
<h2 id="StartParameter">StartParameter</h2>
<p>Gradle执行时有一些称为StartParameter的参数，StartParameter可在命令行设置，可通过<code>gradle --help</code>查看。例如：</p>
<ol>
<li><code>--quiet</code>，执行过程中，只显示Error级别的Log。</li>
<li><code>--stacktrace</code>，执行过程中，输出所有Exception的stacktrace。</li>
<li><code>--full-stacktrace</code>，执行过程中，输出所有Exception的完整stacktrace。</li>
<li><code>--no-daemon</code>，不使用Deamon。Deamon是用于加速Gradle执行的后台进程，有些情况下使用Deamon会有问题（可参考 <a target="_blank" rel="noopener" href="https://docs.gradle.org/current/userguide/gradle_daemon.html">https://docs.gradle.org/current/userguide/gradle_daemon.html</a>）</li>
<li><code>--offline</code>，离线模式，不使用网络资源。</li>
</ol>
<p>在命令行可通过<code>-P</code>参数传入projectProperties，并在Gradle脚本中获取</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 命令行传入projectProperties</span></span><br><span class="line">./gradlew clean -Pkey=value</span><br></pre></td></tr></table></figure>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// gradle脚本中获取projectProperties</span></span><br><span class="line">print gradle.startParameter.projectProperties.get(<span class="string">&#x27;key&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>还可以通过<code>-D</code>参数传入systemPropertiesArgs，并在Gradle脚本中获取</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 命令行传入systemPropertiesArgs</span></span><br><span class="line">./gradlew clean -Dkey=value</span><br></pre></td></tr></table></figure>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// gradle脚本中获取systemPropertiesArgs</span></span><br><span class="line">print gradle.startParameter.systemPropertiesArgs.get(<span class="string">&#x27;key&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="gradle-properties">gradle.properties</h2>
<p>Properties文件格式可由<code>java.util.Properties</code>解析，包含若干键值对，类似<code>HashMap&lt;String,String&gt;</code>。</p>
<p>Gradle运行时会自动读取gradle.properties文件并引用其中的属性。有多个位置可以放gradle.properties文件，按优先级从低到高如下：</p>
<ul>
<li>Project所在目录（即build.gradle所在目录），包括RootProject和SubProject</li>
<li>GradleHome目录（Mac中默认为<code>~/gradle</code>）</li>
<li>通过gradle命令行<code>-D</code>参数指定的Property</li>
</ul>
<p>在gradle.properties文件中，一些保留Key可用于配置Gradle运行环境，例如<code>org.gradle.daemon</code>用于设置GradleDeamon，<code>org.gradle.logging.level</code>用于设置Gradle的Log级别等。</p>
<blockquote>
<p>详情可参考 <a target="_blank" rel="noopener" href="https://docs.gradle.org/current/userguide/build_environment.html">https://docs.gradle.org/current/userguide/build_environment.html</a></p>
</blockquote>
<p>除了保留Key以外，其他Key都可以作为变量用于配置工程。例如在Project目录的gradle.properties中统一定义Support包的版本号，然后在build.gradle中使用定义的变量如下。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SUPPORT_LIBRARY_VERSION=23.4.0</span><br></pre></td></tr></table></figure>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    compile <span class="string">&quot;com.android.support:support-v4:$&#123;SUPPORT_LIBRARY_VERSION&#125;&quot;</span></span><br><span class="line">    compile <span class="string">&quot;com.android.support:appcompat-v7:$&#123;SUPPORT_LIBRARY_VERSION&#125;&quot;</span></span><br><span class="line">    compile <span class="string">&quot;com.android.support:design:$&#123;SUPPORT_LIBRARY_VERSION&#125;&quot;</span></span><br><span class="line">    compile <span class="string">&quot;com.android.support:recyclerview-v7:$&#123;SUPPORT_LIBRARY_VERSION&#125;&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Gradle-Task">Gradle Task</h2>
<p>Gradle以Task（任务）的形式组织每一步操作，每个Task执行一个原子操作（例如把Java编译成class文件、把class打成jar/dex文件、APK签名等）。</p>
<p>每个Project包含若干Task，Task之间存在依赖关系，执行一个Task前，会先执行它所依赖的Task。</p>
<p>每个Task有自己的名字（例如<code>'assemble'</code>），结合其所属Project的名字（例如<code>':app'</code>），可以组成完整名（例如<code>':app:assemble'</code>）。</p>
<p>Gradle内建了一个名为tasks的Task，可以列举Project中的所有Task。</p>
<h3 id="执行Task，查看Project中的所有Task">执行Task，查看Project中的所有Task</h3>
<p>执行Task时，直接把Task名称传给gradle即可。</p>
<p>如果下载了Gradle并配置了环境变量，则可在工程根目录执行：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gradle tasks</span><br></pre></td></tr></table></figure>
<p>更推荐的做法，是在工程根目录下调用GradleWrapper执行：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./gradlew tasks</span><br></pre></td></tr></table></figure>
<p>执行结果如下（省略了部分输出）：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ./gradlew tasks</span></span><br><span class="line">:tasks</span><br><span class="line"></span><br><span class="line">------------------------------------------------------------</span><br><span class="line">All tasks runnable from root project</span><br><span class="line">------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">Android tasks</span><br><span class="line">-------------</span><br><span class="line">androidDependencies - Displays the Android dependencies of the project.</span><br><span class="line">signingReport - Displays the signing info for each variant.</span><br><span class="line">sourceSets - Prints out all the source sets defined in this project.</span><br><span class="line"></span><br><span class="line">Build tasks</span><br><span class="line">-----------</span><br><span class="line">assemble - Assembles all variants of all applications and secondary packages.</span><br><span class="line">assembleAndroidTest - Assembles all the Test applications.</span><br><span class="line">assembleDebug - Assembles all Debug builds.</span><br><span class="line">assembleRelease - Assembles all Release builds.</span><br><span class="line">build - Assembles and tests this project.</span><br><span class="line">buildDependents - Assembles and tests this project and all projects that depend on it.</span><br><span class="line">buildNeeded - Assembles and tests this project and all projects it depends on.</span><br><span class="line">classes - Assembles main classes.</span><br><span class="line">clean - Deletes the build directory.</span><br><span class="line">cleanBuildCache - Deletes the build cache directory.</span><br><span class="line">compileDebugAndroidTestSources</span><br><span class="line">compileDebugSources</span><br><span class="line">compileDebugUnitTestSources</span><br><span class="line">compileReleaseSources</span><br><span class="line">compileReleaseUnitTestSources</span><br><span class="line">jar - Assembles a jar archive containing the main classes.</span><br><span class="line">mockableAndroidJar - Creates a version of android.jar that&#x27;s suitable for unit tests.</span><br><span class="line">testClasses - Assembles test classes.</span><br><span class="line"></span><br><span class="line">Build Setup tasks</span><br><span class="line">-----------------</span><br><span class="line">init - Initializes a new Gradle build. [incubating]</span><br><span class="line">wrapper - Generates Gradle wrapper files. [incubating]</span><br><span class="line"></span><br><span class="line">Documentation tasks</span><br><span class="line">-------------------</span><br><span class="line">javadoc - Generates Javadoc API documentation for the main source code.</span><br><span class="line"></span><br><span class="line">Help tasks</span><br><span class="line">----------</span><br><span class="line">buildEnvironment - Displays all buildscript dependencies declared in root project &#x27;AndroidLint&#x27;.</span><br><span class="line">components - Displays the components produced by root project &#x27;AndroidLint&#x27;. [incubating]</span><br><span class="line">dependencies - Displays all dependencies declared in root project &#x27;AndroidLint&#x27;.</span><br><span class="line">dependencyInsight - Displays the insight into a specific dependency in root project &#x27;AndroidLint&#x27;.</span><br><span class="line">dependentComponents - Displays the dependent components of components in root project &#x27;AndroidLint&#x27;. [incubating]</span><br><span class="line">help - Displays a help message.</span><br><span class="line">model - Displays the configuration model of root project &#x27;AndroidLint&#x27;. [incubating]</span><br><span class="line">projects - Displays the sub-projects of root project &#x27;AndroidLint&#x27;.</span><br><span class="line">properties - Displays the properties of root project &#x27;AndroidLint&#x27;.</span><br><span class="line">tasks - Displays the tasks runnable from root project &#x27;AndroidLint&#x27; (some of the displayed tasks may belong to subprojects).</span><br><span class="line"></span><br><span class="line">Install tasks</span><br><span class="line">-------------</span><br><span class="line">installDebug - Installs the Debug build.</span><br><span class="line">installDebugAndroidTest - Installs the android (on device) tests for the Debug build.</span><br><span class="line">uninstallAll - Uninstall all applications.</span><br><span class="line">uninstallDebug - Uninstalls the Debug build.</span><br><span class="line">uninstallDebugAndroidTest - Uninstalls the android (on device) tests for the Debug build.</span><br><span class="line">uninstallRelease - Uninstalls the Release build.</span><br><span class="line"></span><br><span class="line">Verification tasks</span><br><span class="line">------------------</span><br><span class="line">check - Runs all checks.</span><br><span class="line">connectedAndroidTest - Installs and runs instrumentation tests for all flavors on connected devices.</span><br><span class="line">connectedCheck - Runs all device checks on currently connected devices.</span><br><span class="line">connectedDebugAndroidTest - Installs and runs the tests for debug on connected devices.</span><br><span class="line">deviceAndroidTest - Installs and runs instrumentation tests using all Device Providers.</span><br><span class="line">deviceCheck - Runs all device checks using Device Providers and Test Servers.</span><br><span class="line">lint - Runs lint on all variants.</span><br><span class="line">lintDebug - Runs lint on the Debug build.</span><br><span class="line">lintRelease - Runs lint on the Release build.</span><br><span class="line">test - Run unit tests for all variants.</span><br><span class="line">testDebugUnitTest - Run unit tests for the debug build.</span><br><span class="line">testReleaseUnitTest - Run unit tests for the release build.</span><br><span class="line"></span><br><span class="line">To see all tasks and more detail, run gradlew tasks --all</span><br><span class="line"></span><br><span class="line">To see more detail about a task, run gradlew help --task &lt;task&gt;</span><br><span class="line"></span><br><span class="line">BUILD SUCCESSFUL</span><br><span class="line"></span><br><span class="line">Total time: 1.367 secs</span><br></pre></td></tr></table></figure>
<h3 id="执行多个Task">执行多个Task</h3>
<p>如果需要先后执行多个Task，例如tasks和clean，将它们依次传给gradle即可：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./gradlew tasks clean</span><br></pre></td></tr></table></figure>
<h3 id="排除特定Task">排除特定Task</h3>
<p>使用gradle的<code>-x</code>或<code>--exclude-task</code>参数，可指定执行Task时排除特定Task。例如：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./gradlew build -x check</span><br></pre></td></tr></table></figure>
<h3 id="执行SubProject中的Task">执行SubProject中的Task</h3>
<p>如果想执行子工程<code>':app'</code>中的Task，可使用Task的完整名执行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./gradlew :app:tasks</span><br></pre></td></tr></table></figure>
<p>也可以切换到子工程目录执行，但切换当前目录会影响Gradle脚本中的相对路径，不推荐。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd app</span><br><span class="line">gradle tasks</span><br></pre></td></tr></table></figure>
<h3 id="Task参数、查看Task详细信息">Task参数、查看Task详细信息</h3>
<p>Task可以定义参数，可在执行时从命令行传入。例如Gradle内建了一个叫“help”的Task，带有一个<code>--task</code>参数，可以用于查看一个Task的详细信息。</p>
<p>查看“tasks”这个Task的详细信息，就可以执行命令如下。其中会显示一个Task的名称、类型、参数、详细介绍、分组等。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ./gradlew <span class="built_in">help</span> --task tasks</span></span><br><span class="line">:help</span><br><span class="line">Detailed task information for tasks</span><br><span class="line"></span><br><span class="line">Path</span><br><span class="line">     :tasks</span><br><span class="line"></span><br><span class="line">Type</span><br><span class="line">     TaskReportTask (org.gradle.api.tasks.diagnostics.TaskReportTask)</span><br><span class="line"></span><br><span class="line">Options</span><br><span class="line">     --all     Show additional tasks and detail.</span><br><span class="line"></span><br><span class="line">Description</span><br><span class="line">     Displays the tasks runnable from root project &#x27;GradleStudy&#x27; (some of the displayed tasks may belong to subprojects).</span><br><span class="line"></span><br><span class="line">Group</span><br><span class="line">     help</span><br><span class="line"></span><br><span class="line">BUILD SUCCESSFUL</span><br><span class="line"></span><br><span class="line">Total time: 1.051 secs</span><br></pre></td></tr></table></figure>
<h3 id="一些常用GradleTask">一些常用GradleTask</h3>
<ul>
<li>
<p>clean: 清除build目录编译生成的文件 (Deletes the build directory.)</p>
</li>
<li>
<p>assemble：编译工程 (Assembles the outputs of this project. [jar])</p>
</li>
<li>
<p>build：编译并测试工程 (Assembles and tests this project. [assemble, check])</p>
</li>
<li>
<p>test：单元测试等 (Runs the unit tests. [classes, testClasses])</p>
</li>
<li>
<p>check：测试工程，包含test (Runs all checks. [test])</p>
</li>
<li>
<p>wrapper：生成GradleWrapper文件 (Generates Gradle wrapper files. [incubating])</p>
</li>
<li>
<p>help: 帮助信息 (Displays a help message.)</p>
</li>
<li>
<p>tasks：查看Project的所有Task (Displays the tasks runnable from root project ‘Xxx’.)</p>
</li>
<li>
<p>dependencies：查看Project的依赖 (Displays all dependencies declared in root project ‘Xxx’.)</p>
</li>
<li>
<p>projects: 查看SubProject (Displays the sub-projects of root project ‘Xxx’.)</p>
</li>
</ul>
<h3 id="查看Task依赖树">查看Task依赖树</h3>
<p>每个Task都会依赖若干Task，这些Task又会依赖别的Task，所有Task就会形成一个依赖树。</p>
<p>为了更加直观的学习，可以在<code>app/build.gradle</code>中添加如下的简单脚本，让Gradle输出Task的依赖树。</p>
<p>方法printDependencies通过递归的方式，输出每个Task依赖的Task。afterEvaluate语句块中，先找到<code>assembleDebug</code>这个Task，然后调用printDependencies输出其依赖树。由于Android中有大量Task依赖，打印出所有Task需要很久，所以这里限制了最大递归深度为3。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> printDependencies(Task task, String prefix, <span class="keyword">int</span> depth, <span class="keyword">int</span> maxDepth) &#123;</span><br><span class="line">    println prefix + task.project.name + <span class="string">&#x27;:&#x27;</span> + task.name</span><br><span class="line">    <span class="keyword">def</span> tasks = task.getTaskDependencies().getDependencies(task)</span><br><span class="line">    <span class="keyword">if</span> (depth &lt; maxDepth - <span class="number">1</span>) &#123;</span><br><span class="line">        tasks.each &#123; t -&gt;</span><br><span class="line">            printDependencies(t, prefix + <span class="string">&#x27;\t&#x27;</span>, depth + <span class="number">1</span>, maxDepth)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (tasks.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            println prefix + <span class="string">&#x27;\t&#x27;</span> + <span class="string">&quot;($&#123;tasks.size()&#125; child tasks...)&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">afterEvaluate &#123;</span><br><span class="line">    println <span class="string">&#x27;===============================&#x27;</span></span><br><span class="line">    <span class="keyword">def</span> buildTask = tasks.findByName(<span class="string">&#x27;assembleDebug&#x27;</span>)</span><br><span class="line">    printDependencies(buildTask, <span class="string">&#x27;&#x27;</span>, <span class="number">0</span>, <span class="number">3</span>)</span><br><span class="line">    println <span class="string">&#x27;===============================&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行任意Gradle任务，例如clean，部分输出内容如下。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ./gradlew clean</span></span><br><span class="line">===============================</span><br><span class="line">app:assembleDebug</span><br><span class="line">app:packageDebug</span><br><span class="line">app:processDebugResources</span><br><span class="line">(2 child tasks...)</span><br><span class="line">app:compileDebugJavaWithJavac</span><br><span class="line">(4 child tasks...)</span><br><span class="line">app:mergeDebugAssets</span><br><span class="line">(2 child tasks...)</span><br><span class="line">app:validateSigningDebug</span><br><span class="line">app:transformNativeLibsWithMergeJniLibsForDebug</span><br><span class="line">(3 child tasks...)</span><br><span class="line">app:transformResourcesWithMergeJavaResForDebug</span><br><span class="line">(2 child tasks...)</span><br><span class="line">app:transformClassesWithDexForDebug</span><br><span class="line">(2 child tasks...)</span><br><span class="line">app:compileDebugSources</span><br><span class="line">app:compileDebugNdk</span><br><span class="line">(1 child tasks...)</span><br><span class="line">app:compileDebugJavaWithJavac</span><br><span class="line">(4 child tasks...)</span><br><span class="line">===============================</span><br><span class="line">:clean</span><br><span class="line">:app:clean</span><br><span class="line"></span><br><span class="line">BUILD SUCCESSFUL</span><br><span class="line"></span><br><span class="line">Total time: 0.975 secs</span><br></pre></td></tr></table></figure>
<h2 id="buildscript与allprojects">buildscript与allprojects</h2>
<p>在RootProject的build.gradle中，经常会看到buildscript和allprojects两个语句块，并且里面都定义了一些相同的东西。</p>
<p>buildscript，顾名思义，是编译脚本，也就是说编译一个工程时需要的配置，例如常会看到下面这样的脚本，表示编译时要用到Android Gradle Plugin。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">buildscript &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        jcenter()</span><br><span class="line">    &#125;</span><br><span class="line">    dependencies &#123;</span><br><span class="line">        classpath <span class="string">&#x27;com.android.tools.build:gradle:2.3.3&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>allprojects，则用于配置所有project，包括SubProject，这里面的配置的东西，则是工程代码需要的东西，例如依赖的各种开源库等。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">allprojects &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        jcenter()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="关于编译与Groovy">关于编译与Groovy</h3>
<p>编译就是将程序源码转换成可执行文件或中间代码的过程。具体到Java，就是将<code>.java</code>代码文件变成<code>.class</code>或者进一步打包成<code>.jar</code>的过程。</p>
<p>Gradle基于Groovy，Groovy是在Java基础上扩展的脚本语言。Groovy有和解释型语言一样的特性，可以直接从源码运行而不需要提前编译。但实际运行过程中，也是先转换成Java的class文件，再运行在JVM上的。</p>
<p>在buildscript的dependencies中，通过classpath语句引用一些编译好的jar包，Gradle在执行时就会将其下载并加入Java的classpath，其中的class在编译时就可以被调用，运行在电脑或云主机上。</p>
<h2 id="Gradle-Plugin">Gradle Plugin</h2>
<p>Gradle之所以是个强大的构建系统，很重要的一点在于其完善的插件支持。</p>
<p>Gradle内建了Java、Groovy等插件，除此之外，还可以在Gradle提供的一整套API基础上开发插件，实现各种编译打包工作。</p>
<h3 id="Gradle-Android-Plugin">Gradle Android Plugin</h3>
<p>在Android开发编译时，会有很多Android相关的配置，这些都是由Gradle的Android插件实现的。</p>
<p>在buildscript中，通过dependencies引入了Gradle Android插件：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">buildscript &#123;</span><br><span class="line">    dependencies &#123;</span><br><span class="line">        classpath <span class="string">&#x27;com.android.tools.build:gradle:2.3.3&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在app/build.gradle中，通过apply的方式，应用了Android插件：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 对于Android Application（APK）</span></span><br><span class="line">apply <span class="attr">plugin:</span> <span class="string">&#x27;com.android.application&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 对于Android Library（AAR）</span></span><br><span class="line">apply <span class="attr">plugin:</span> <span class="string">&#x27;com.android.library&#x27;</span></span><br></pre></td></tr></table></figure>
<p>应用了Android插件后，即可在app/build.gradle中使用插件定义的Android相关DSL了：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    compileSdkVersion <span class="number">24</span></span><br><span class="line">    buildToolsVersion <span class="string">&#x27;25.0.2&#x27;</span></span><br><span class="line"></span><br><span class="line">    defaultConfig &#123;</span><br><span class="line">        applicationId <span class="string">&quot;com.paincker.lint.demo&quot;</span></span><br><span class="line">        minSdkVersion <span class="number">15</span></span><br><span class="line">        targetSdkVersion <span class="number">25</span></span><br><span class="line">        versionCode <span class="number">1</span></span><br><span class="line">        versionName <span class="string">&quot;1.0&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Repositories">Repositories</h2>
<p>很多从Eclipse转到Android Studio的开发者，刚开始都对Gradle自动下载依赖包的功能印象深刻。</p>
<p>Gradle的依赖管理完全兼容Maven和Ivy，常使用Maven仓库来实现依赖管理，当Library打包完成后上传到Maven仓库，Gradle则会从Maven仓库下载需要的依赖。</p>
<p>Repository就是用来指定所需要的Maven仓库。除了常见的jcenter()，mavenCentral()，还可以指定本地搭建的Maven仓库、指定URL的Maven仓库等，例如国内一些Maven仓库镜像，以及很多公司内部私有的Maven仓库等。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">repositories &#123;</span><br><span class="line">    jcenter()</span><br><span class="line">    mavenCentral()</span><br><span class="line">    maven &#123; url <span class="string">&#x27;http://maven.oschina.net/content/groups/public/&#x27;</span> &#125;</span><br><span class="line">    ivy &#123; url <span class="string">&quot;http://repo.mycompany.com/repo&quot;</span> &#125;</span><br><span class="line">    localRepository &#123; dirs <span class="string">&#x27;lib&#x27;</span> &#125;</span><br><span class="line">    maven &#123;</span><br><span class="line">        url <span class="string">&quot;sftp://repo.mycompany.com:22/maven2&quot;</span></span><br><span class="line">        credentials &#123;</span><br><span class="line">            username <span class="string">&#x27;user&#x27;</span></span><br><span class="line">            password <span class="string">&#x27;password&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Dependencies">Dependencies</h2>
<blockquote>
<p>Gradle依赖管理官方文档 <a target="_blank" rel="noopener" href="https://docs.gradle.org/current/userguide/dependency_management.html">https://docs.gradle.org/current/userguide/dependency_management.html</a></p>
</blockquote>
<h3 id="DependencyNotation">DependencyNotation</h3>
<p>DependencyNotation用于描述要依赖的模块。</p>
<h4 id="外部依赖">外部依赖</h4>
<p>通常用<code>group:name:version:classifier@ext</code>的形式表示。其中group通常用包名，name表示实际的名字，version表示版本，classifier在Android中是ProductFlavor和BuildType的组合（后面会介绍），ext则表示扩展名。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">compile <span class="string">&quot;org.gradle.test.classifiers:service:1.0:jdk15@jar&quot;</span></span><br><span class="line"></span><br><span class="line">compile <span class="attr">group:</span> <span class="string">&#x27;org.gradle.test.classifiers&#x27;</span>, <span class="attr">name:</span> <span class="string">&#x27;service&#x27;</span>, <span class="attr">version:</span> <span class="string">&#x27;1.0&#x27;</span>, <span class="attr">classifier:</span> <span class="string">&#x27;jdk15&#x27;</span></span><br></pre></td></tr></table></figure>
<h4 id="Project依赖">Project依赖</h4>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile project(<span class="string">&#x27;:someProject&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h4 id="文件依赖">文件依赖</h4>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">  <span class="comment">//declaring arbitrary files as dependencies</span></span><br><span class="line">  compile files(<span class="string">&#x27;hibernate.jar&#x27;</span>, <span class="string">&#x27;libs/spring.jar&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">//putting all jars from &#x27;libs&#x27; onto compile classpath</span></span><br><span class="line">  compile fileTree(<span class="string">&#x27;libs&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>参考官方文档 <a target="_blank" rel="noopener" href="https://docs.gradle.org/current/dsl/org.gradle.api.artifacts.dsl.DependencyHandler.html">https://docs.gradle.org/current/dsl/org.gradle.api.artifacts.dsl.DependencyHandler.html</a></p>
</blockquote>
<h3 id="依赖传递-transitive">依赖传递(transitive)</h3>
<p>Gradle依赖项可配置transitive属性，表示是否递归解析此模块的依赖项，默认为true。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">compile(<span class="string">&#x27;org.hibernate:hibernate:3.0.5&#x27;</span>) &#123;</span><br><span class="line">    transitive = <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="依赖树查看">依赖树查看</h3>
<p>每个模块都会依赖若干模块，这些模块又分别依赖其他模块，形成一个依赖树。Gradle提供了名为dependencies的Task，可查看Project的依赖树，执行效果如下（省略了部分输出）。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ./gradlew :app:dependencies</span></span><br><span class="line"></span><br><span class="line">------------------------------------------------------------</span><br><span class="line">Project :app</span><br><span class="line">------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">compile - Classpath for compiling the main sources.</span><br><span class="line">+--- com.android.support:appcompat-v7:24.0.0</span><br><span class="line">    +--- com.android.support:support-v4:24.0.0</span><br><span class="line">        \--- com.android.support:support-annotations:24.0.0</span><br><span class="line">    +--- com.android.support:support-vector-drawable:24.0.0</span><br><span class="line">        \--- com.android.support:support-v4:24.0.0 (*)</span><br><span class="line">    \--- com.android.support:animated-vector-drawable:24.0.0</span><br><span class="line">         \--- com.android.support:support-vector-drawable:24.0.0 (*)</span><br><span class="line">\--- com.android.support.constraint:constraint-layout:1.0.2</span><br><span class="line">     \--- com.android.support.constraint:constraint-layout-solver:1.0.2</span><br></pre></td></tr></table></figure>
<h3 id="Artifact">Artifact</h3>
<p>Artifact可以理解成一个模块的具体实现。一个依赖项可以包含多个Artifact，例如依赖项<code>com.demo:mymodule:library:1.0</code>中可以包含多个不同格式、BuildType的Artifact：</p>
<ul>
<li><code>library-1.0-debug.jar</code></li>
<li><code>library-1.0-release.jar</code></li>
<li><code>library-1.0-debug.aar</code></li>
<li><code>library-1.0-release.aar</code></li>
</ul>
<h3 id="Module-Descriptor、POM文件">Module Descriptor、POM文件</h3>
<p>Gradle是如何获取到一个模块的依赖项的呢？</p>
<p>在Maven或Ivy仓库中，模块的依赖信息并不包含在Artifact文件中，而是通过ModuleDescriptor文件声明的。</p>
<p>以阿里的Maven仓库为例，用浏览器打开链接 <a target="_blank" rel="noopener" href="http://maven.aliyun.com/nexus/content/groups/public/com/android/tools/build/gradle/2.3.0/">http://maven.aliyun.com/nexus/content/groups/public/com/android/tools/build/gradle/2.3.0/</a></p>
<p>可以看到<code>com.android.tools.build:gradle:2.3.0</code>这个模块所包含的文件。其中sources.jar为代码源文件，pom文件则为ModuleDescriptor。</p>
<ul>
<li>gradle-2.3.0-sources.jar</li>
<li>gradle-2.3.0-sources.jar.md5</li>
<li>gradle-2.3.0-sources.jar.sha1</li>
<li>gradle-2.3.0.jar</li>
<li>gradle-2.3.0.jar.md5</li>
<li>gradle-2.3.0.jar.sha1</li>
<li>gradle-2.3.0.pom</li>
<li>gradle-2.3.0.pom.md5</li>
<li>gradle-2.3.0.pom.sha1</li>
</ul>
<p>在Maven仓库中，模块的POM文件可以指定默认的Artifact，并声明其依赖项；不支持分别声明多个Artifact的依赖项。AAR工程配置多版本发布的时候，需要考虑这一特性。</p>
<blockquote>
<p>If you declare a module dependency, Gradle looks for a module descriptor file (pom.xml or ivy.xml) in the repositories. If such a module descriptor file exists, it is parsed and the artifacts of this module (e.g. hibernate-3.0.5.jar) as well as its dependencies (e.g. cglib) are downloaded. If no such module descriptor file exists, Gradle looks for a file called hibernate-3.0.5.jar to retrieve. In Maven, a module can have one and only one artifact. In Gradle and Ivy, a module can have multiple artifacts. Each artifact can have a different set of dependencies.</p>
</blockquote>
<h3 id="多Artifact的依赖处理、Artifact-only-notation">多Artifact的依赖处理、Artifact only notation</h3>
<p>Gradle在处理依赖时，对于有多个Artifact的Maven模块，可在DependencyNotation中声明需要的Artifact，没有声明则使用POM文件指定的默认版本，POM中也没有指定则默认使用和module名一致的jar包。</p>
<p>当使用“@”指定了所依赖模块的Artifact，称为Artifact only notation，此时Gradle只会下载对应的Artifact，而不会下载其依赖，此时可能就需要设置transitive属性。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">compile(<span class="string">&#x27;com.facebook.fresco:fresco:0.10.0@aar&#x27;</span>) &#123;</span><br><span class="line">    transitive = <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>If no module descriptor file can be found, Gradle by default downloads a jar with the name of the module. But sometimes, even if the repository contains module descriptors, you want to download only the artifact jar, without the dependencies. [11] And sometimes you want to download a zip from a repository, that does not have module descriptors. Gradle provides an artifact only notation for those use cases - simply prefix the extension that you want to be downloaded with ‘@’ sign.</p>
</blockquote>
<h3 id="依赖冲突分解">依赖冲突分解</h3>
<p>依赖项很多时，依赖项之间经常会发生冲突。例如多个SDK分别依赖了不同版本的AppCompat，就可能导致冲突。Gradle提供了一些API可以用来处理依赖冲突。</p>
<p>常见的依赖冲突解决思路可参考：</p>
<blockquote>
<p>Gradle依赖项学习总结，dependencies、transitive、force、exclude的使用与依赖冲突解决 <a href="http://www.paincker.com/gradle-dependencies">http://www.paincker.com/gradle-dependencies</a></p>
</blockquote>
<h2 id="ProductFlavor、BuildType与Build-Variant">ProductFlavor、BuildType与Build Variant</h2>
<p>Android中定义了ProductFlavor和BuildType的DSL。</p>
<h3 id="ProductFlavor">ProductFlavor</h3>
<p>ProductFlavor可以实现一套代码编译成不同的版本，版本之间差异比较小，例如开发版本、测试版本、线上版本；或是发布到某些应用市场的定制版本（例如需要修改一些资源文件）等。</p>
<p>ProductFlavor中包含了一些应用相关的配置，例如minSdkVersion，versionCode等。下面的代码，就是在对默认的ProductFlavor做配置。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    defaultConfig &#123;</span><br><span class="line">        applicationId <span class="string">&quot;com.paincker.gradle.demoapplication&quot;</span></span><br><span class="line">        minSdkVersion <span class="number">15</span></span><br><span class="line">        targetSdkVersion <span class="number">24</span></span><br><span class="line">        versionCode <span class="number">1</span></span><br><span class="line">        versionName <span class="string">&quot;1.0&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以在ProductFlavors中定义新的Flavor并进行配置，覆盖DefaultProductFlavor中的相应配置。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    productFlavors &#123;</span><br><span class="line">        myflavor &#123;</span><br><span class="line">            minSdkVersion <span class="number">20</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ProductFlavor还支持多维度（Multi-flavors），每个纬度之间可以进行组合。例如下面的示例，flavor有abi和version两个纬度，最后就会有6种组合：</p>
<ul>
<li>x86-freeapp</li>
<li>arm-freeapp</li>
<li>mips-freeapp</li>
<li>x86-paidapp</li>
<li>arm-paidapp</li>
<li>mips-paidapp</li>
</ul>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    ...</span><br><span class="line">    flavorGroups <span class="string">&quot;abi&quot;</span>, <span class="string">&quot;version&quot;</span></span><br><span class="line">    productFlavors &#123;</span><br><span class="line">        freeapp &#123;</span><br><span class="line">            flavorGroup <span class="string">&quot;version&quot;</span></span><br><span class="line">            ...</span><br><span class="line">        &#125;</span><br><span class="line">        paidapp &#123;</span><br><span class="line">            flavorGroup <span class="string">&quot;version&quot;</span></span><br><span class="line">            ...</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        x86 &#123;</span><br><span class="line">            flavorGroup <span class="string">&quot;abi&quot;</span></span><br><span class="line">            ...</span><br><span class="line">        &#125;</span><br><span class="line">        arm &#123;</span><br><span class="line">            flavorGroup <span class="string">&quot;abi&quot;</span></span><br><span class="line">            ...</span><br><span class="line">        &#125;</span><br><span class="line">        mips &#123;</span><br><span class="line">            flavorGroup <span class="string">&quot;abi&quot;</span></span><br><span class="line">            ...</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>参考：多定制的变种版本 <a target="_blank" rel="noopener" href="https://flyouting.gitbooks.io/gradle-plugin-user-guide-cn/content/multi-flavor_variants.html">https://flyouting.gitbooks.io/gradle-plugin-user-guide-cn/content/multi-flavor_variants.html</a></p>
</blockquote>
<h3 id="BuildType">BuildType</h3>
<p>BuildType本身是软件开发中的通用概念，表示编译版本。</p>
<p>Android中定义了自己的BuildType接口，其中包含了一些编译相关的配置，例如debuggable（是否可调试）、minifyEnable（是否开启Proguard）等。</p>
<p>可以在buildTypes中配置支持的BuildType如下。即使不做任何配置，默认也会有Debug和Release两个BuildType，且分别包含了一套默认值，例如Debug的debuggable参数默认为true，而Release的debuggable参数默认为false。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    buildTypes &#123;</span><br><span class="line">    debug &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    develop &#123;</span><br><span class="line">        debuggable <span class="literal">false</span></span><br><span class="line">            minifyEnabled <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">        release &#123;</span><br><span class="line">        debuggable <span class="literal">false</span></span><br><span class="line">            minifyEnabled <span class="literal">true</span></span><br><span class="line">            proguardFiles getDefaultProguardFile(<span class="string">&#x27;proguard-android.txt&#x27;</span>), <span class="string">&#x27;proguard-rules.pro&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="BuildVariant">BuildVariant</h3>
<p>ProductFlavor与BuildType组合，就成为BuildVariant。在前面多纬度Flavor的示例基础上，6个Flavor组合2个BuildType，总共就会有12种BuildVariant。</p>
<p>每个Build Variant包含了一个ProductFlavor和一个BuildType。BuildType和ProductFlavor中某些配置是重叠的，组合成BuildVariant后，通常会按优先级处理（一般BuildType优先级更高），或做合并处理。</p>
<p>例如两者都可以配置签名signingConfigs，合并成BuildVariant后，会优先取取BuildType中定义的；而对于配置项proguardFiles，则会采取合并处理。</p>
<blockquote>
<p>具体的合并逻辑，可以参考这个类中的实现 <code>com.android.builder.core.VariantConfiguration</code></p>
</blockquote>
<h2 id="BuildConfig">BuildConfig</h2>
<p>Android开发常用到BuildConfig类，这个类可在编译时生成，用于在代码中获取一些编译相关的参数，包括是否可以Debug、当前BuildType和Flavor名字、VersionCode和VersionName等，例如常会用<code>BuildConfig.DEBUG</code>判断是否输出Log信息。</p>
<p>BuildType配置中提供了一个buildConfigField方法，可以往BuildConfig中添加自定义字段。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> xxLibraryVersion = <span class="number">192</span></span><br><span class="line">android &#123;</span><br><span class="line">buildTypes &#123;</span><br><span class="line">    debug &#123;</span><br><span class="line">        buildConfigField <span class="string">&quot;int&quot;</span>, <span class="string">&quot;XX_LIBRARY_VERSION&quot;</span>, xxLibraryVersion</span><br><span class="line">        &#125;</span><br><span class="line">        release &#123;</span><br><span class="line">        buildConfigField <span class="string">&quot;int&quot;</span>, <span class="string">&quot;XX_LIBRARY_VERSION&quot;</span>, xxLibraryVersion</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">dependencies &#123;</span><br><span class="line">compile <span class="string">&quot;com.xxx:xx:1.0.$&#123;xxLibraryVersion&#125;&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">BuildConfig</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">boolean</span> DEBUG = Boolean.parseBoolean(<span class="string">&quot;true&quot;</span>);</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String BUILD_TYPE = <span class="string">&quot;debug&quot;</span>;</span><br><span class="line">  <span class="comment">// Fields from build type: debug</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> XX_LIBRARY_VERSION = <span class="number">192</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">showLibraryInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">String msg = <span class="string">&quot;xx library version is &quot;</span> + BuildConfig.XX_LIBRARY_VERSION;</span><br><span class="line">    Toast.makeText(context, msg, Toast.LENGTH_SHORT).show();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Configurations">Configurations</h2>
<p>在Gradle中，一个Project可以有多个Configuration，每个Configuration有不同的依赖配置。</p>
<p>例如在dependencies中，经常用到<code>compile xxx</code>，这里的compile就是一个Configuration。一些常用的Configuration例如：</p>
<ul>
<li>compile：最常用，参与编译并打包到APK中</li>
<li>testCompile：用于单元测试</li>
<li>androidTestCompile：用于Android自动化测试</li>
<li>provided：参与编译但不打包到APK中，类似eclipse中的external-libs</li>
<li>apk：打包到APK中但不参与编译，不能在代码中调用</li>
</ul>
<p>考虑到BuildType和ProductFlavor，又会和上述Configuration组合成新的Configuration，例如：</p>
<ul>
<li>compile</li>
<li>debugCompile</li>
<li>myflavorCompile</li>
<li>myflavorDebugCompile</li>
<li>testCompile</li>
<li>testDebugCompile</li>
<li>testMyflavorCompile</li>
<li>testMyflavorDebugCompile</li>
</ul>
<p>在运行<code>gradle dependencies</code>时，也会分别显示每个Configuration对应的依赖树，如下（省略了部分输出）。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">./gradlew :app:dependencies</span><br><span class="line"></span><br><span class="line">:app:dependencies</span><br><span class="line"></span><br><span class="line">------------------------------------------------------------</span><br><span class="line">Project :app</span><br><span class="line">------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">androidJacocoAgent - The Jacoco agent to use to get coverage data.</span><br><span class="line">\--- org.jacoco:org.jacoco.agent:0.7.5.201505241946</span><br><span class="line"></span><br><span class="line">androidJacocoAnt - The Jacoco ant tasks to use to get execute Gradle tasks.</span><br><span class="line">\--- org.jacoco:org.jacoco.ant:0.7.5.201505241946</span><br><span class="line">     +--- org.jacoco:org.jacoco.core:0.7.5.201505241946</span><br><span class="line">         \--- org.ow2.asm:asm-debug-all:5.0.1</span><br><span class="line">     +--- org.jacoco:org.jacoco.report:0.7.5.201505241946</span><br><span class="line">         +--- org.jacoco:org.jacoco.core:0.7.5.201505241946 (*)</span><br><span class="line">         \--- org.ow2.asm:asm-debug-all:5.0.1</span><br><span class="line">     \--- org.jacoco:org.jacoco.agent:0.7.5.201505241946</span><br><span class="line"></span><br><span class="line">androidTestAnnotationProcessor - Classpath for the annotation processor for &#x27;androidTest&#x27;.</span><br><span class="line">No dependencies</span><br><span class="line"></span><br><span class="line">androidTestApk - Classpath packaged with the compiled &#x27;androidTest&#x27; classes.</span><br><span class="line">No dependencies</span><br><span class="line"></span><br><span class="line">androidTestCompile - Classpath for compiling the androidTest sources.</span><br><span class="line">No dependencies</span><br><span class="line"></span><br><span class="line">androidTestJackPlugin - Classpath for the &#x27;androidTest&#x27; Jack plugins.</span><br><span class="line">No dependencies</span><br><span class="line"></span><br><span class="line">androidTestProvided - Classpath for only compiling the androidTest sources.</span><br><span class="line">No dependencies</span><br><span class="line"></span><br><span class="line">androidTestWearApp - Link to a wear app to embed for object &#x27;androidTest&#x27;.</span><br><span class="line">No dependencies</span><br><span class="line"></span><br><span class="line">annotationProcessor - Classpath for the annotation processor for &#x27;main&#x27;.</span><br><span class="line">No dependencies</span><br><span class="line"></span><br><span class="line">apk - Classpath packaged with the compiled &#x27;main&#x27; classes.</span><br><span class="line">No dependencies</span><br><span class="line"></span><br><span class="line">archives - Configuration for archive artifacts.</span><br><span class="line">No dependencies</span><br><span class="line"></span><br><span class="line">compile - Classpath for compiling the main sources.</span><br><span class="line">+--- com.android.support:appcompat-v7:24.0.0</span><br><span class="line">    +--- com.android.support:support-v4:24.0.0</span><br><span class="line">        \--- com.android.support:support-annotations:24.0.0</span><br><span class="line">    +--- com.android.support:support-vector-drawable:24.0.0</span><br><span class="line">        \--- com.android.support:support-v4:24.0.0 (*)</span><br><span class="line">    \--- com.android.support:animated-vector-drawable:24.0.0</span><br><span class="line">         \--- com.android.support:support-vector-drawable:24.0.0 (*)</span><br><span class="line">\--- com.android.support.constraint:constraint-layout:1.0.2</span><br><span class="line">     \--- com.android.support.constraint:constraint-layout-solver:1.0.2</span><br><span class="line"></span><br><span class="line">debugAnnotationProcessor - Classpath for the annotation processor for &#x27;debug&#x27;.</span><br><span class="line">No dependencies</span><br><span class="line"></span><br><span class="line">debugApk - Classpath packaged with the compiled &#x27;debug&#x27; classes.</span><br><span class="line">No dependencies</span><br><span class="line"></span><br><span class="line">debugCompile - Classpath for compiling the debug sources.</span><br><span class="line">No dependencies</span><br><span class="line"></span><br><span class="line">debugJackPlugin - Classpath for the &#x27;debug&#x27; Jack plugins.</span><br><span class="line">No dependencies</span><br><span class="line"></span><br><span class="line">debugProvided - Classpath for only compiling the debug sources.</span><br><span class="line">No dependencies</span><br><span class="line"></span><br><span class="line">debugWearApp - Link to a wear app to embed for object &#x27;debug&#x27;.</span><br><span class="line">No dependencies</span><br><span class="line"></span><br><span class="line">default - Configuration for default artifacts.</span><br><span class="line">No dependencies</span><br><span class="line"></span><br><span class="line">default-mapping - Configuration for default mapping artifacts.</span><br><span class="line">No dependencies</span><br><span class="line"></span><br><span class="line">default-metadata - Metadata for the produced APKs.</span><br><span class="line">No dependencies</span><br><span class="line"></span><br><span class="line">jackPlugin - Classpath for the &#x27;main&#x27; Jack plugins.</span><br><span class="line">No dependencies</span><br><span class="line"></span><br><span class="line">provided - Classpath for only compiling the main sources.</span><br><span class="line">No dependencies</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h2 id="SourceSet">SourceSet</h2>
<p>Gradle中使用SourceSet管理Java源码；Android定义了自己的SourceSet，其用法和Gradle类似。</p>
<blockquote>
<p>Gradle的SourceSet官方文档： <a target="_blank" rel="noopener" href="https://docs.gradle.org/current/dsl/org.gradle.api.tasks.SourceSet.html">https://docs.gradle.org/current/dsl/org.gradle.api.tasks.SourceSet.html</a></p>
</blockquote>
<blockquote>
<p>Android的SourceSet官方文档： <a target="_blank" rel="noopener" href="http://google.github.io/android-gradle-dsl/current/com.android.build.gradle.api.AndroidSourceSet.html">http://google.github.io/android-gradle-dsl/current/com.android.build.gradle.api.AndroidSourceSet.html</a></p>
</blockquote>
<p>默认的SourceSet即main，根目录位于<code>src/main</code>，其中又包括多个子目录，例如：</p>
<ul>
<li>src/main/java，Java源码</li>
<li>src/main/resources，Java资源文件</li>
<li>src/main/res，Android资源文件</li>
<li>src/main/assets，Android assets文件</li>
</ul>
<p>ProductFlavor、BuildType、BuildVariant、test/androidTest，也会按照一定的形式组合产生SourceSet。</p>
<p>可以配置某个SourceSet的根目录，或者指定具体的子目录（支持多个目录），如下：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">sourceSets &#123;</span><br><span class="line">    myflavor &#123;</span><br><span class="line">            res.srcDirs = [<span class="string">&#x27;src/main/res&#x27;</span>, <span class="string">&#x27;src/main/res2&#x27;</span>]</span><br><span class="line">        &#125;</span><br><span class="line">        debug.setRoot(<span class="string">&#x27;src/main&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用Gradle的sourceSet可以查看项目中所有的SourceSet。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><span class="line">$ ./<span class="attr">gradlew :</span><span class="attr">app:</span>sourceSets</span><br><span class="line">:<span class="attr">app:</span>sourceSets</span><br><span class="line"></span><br><span class="line">------------------------------------------------------------</span><br><span class="line"><span class="attr">Project :</span>app</span><br><span class="line">------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">androidTest</span><br><span class="line">-----------</span><br><span class="line">Compile <span class="attr">configuration:</span> androidTestCompile</span><br><span class="line">build.gradle <span class="attr">name:</span> android.sourceSets.androidTest</span><br><span class="line">Java <span class="attr">sources:</span> [app<span class="regexp">/src/</span>androidTest/java]</span><br><span class="line">Manifest <span class="attr">file:</span> app<span class="regexp">/src/</span>androidTest/AndroidManifest.xml</span><br><span class="line">Android <span class="attr">resources:</span> [app<span class="regexp">/src/</span>androidTest/res]</span><br><span class="line"><span class="attr">Assets:</span> [app<span class="regexp">/src/</span>androidTest/assets]</span><br><span class="line">AIDL <span class="attr">sources:</span> [app<span class="regexp">/src/</span>androidTest/aidl]</span><br><span class="line">RenderScript <span class="attr">sources:</span> [app<span class="regexp">/src/</span>androidTest/rs]</span><br><span class="line">JNI <span class="attr">sources:</span> [app<span class="regexp">/src/</span>androidTest/jni]</span><br><span class="line">JNI <span class="attr">libraries:</span> [app<span class="regexp">/src/</span>androidTest/jniLibs]</span><br><span class="line">Java-style <span class="attr">resources:</span> [app<span class="regexp">/src/</span>androidTest/resources]</span><br><span class="line"></span><br><span class="line">androidTestMyflavor</span><br><span class="line">-------------------</span><br><span class="line">Compile <span class="attr">configuration:</span> androidTestMyflavorCompile</span><br><span class="line">build.gradle <span class="attr">name:</span> android.sourceSets.androidTestMyflavor</span><br><span class="line">Java <span class="attr">sources:</span> [app<span class="regexp">/src/</span>androidTestMyflavor/java]</span><br><span class="line">Manifest <span class="attr">file:</span> app<span class="regexp">/src/</span>androidTestMyflavor/AndroidManifest.xml</span><br><span class="line">Android <span class="attr">resources:</span> [app<span class="regexp">/src/</span>androidTestMyflavor/res]</span><br><span class="line"><span class="attr">Assets:</span> [app<span class="regexp">/src/</span>androidTestMyflavor/assets]</span><br><span class="line">AIDL <span class="attr">sources:</span> [app<span class="regexp">/src/</span>androidTestMyflavor/aidl]</span><br><span class="line">RenderScript <span class="attr">sources:</span> [app<span class="regexp">/src/</span>androidTestMyflavor/rs]</span><br><span class="line">JNI <span class="attr">sources:</span> [app<span class="regexp">/src/</span>androidTestMyflavor/jni]</span><br><span class="line">JNI <span class="attr">libraries:</span> [app<span class="regexp">/src/</span>androidTestMyflavor/jniLibs]</span><br><span class="line">Java-style <span class="attr">resources:</span> [app<span class="regexp">/src/</span>androidTestMyflavor/resources]</span><br><span class="line"></span><br><span class="line">debug</span><br><span class="line">-----</span><br><span class="line">Compile <span class="attr">configuration:</span> debugCompile</span><br><span class="line">build.gradle <span class="attr">name:</span> android.sourceSets.debug</span><br><span class="line">Java <span class="attr">sources:</span> [app<span class="regexp">/src/</span>debug/java]</span><br><span class="line">Manifest <span class="attr">file:</span> app<span class="regexp">/src/</span>debug/AndroidManifest.xml</span><br><span class="line">Android <span class="attr">resources:</span> [app<span class="regexp">/src/</span>debug/res]</span><br><span class="line"><span class="attr">Assets:</span> [app<span class="regexp">/src/</span>debug/assets]</span><br><span class="line">AIDL <span class="attr">sources:</span> [app<span class="regexp">/src/</span>debug/aidl]</span><br><span class="line">RenderScript <span class="attr">sources:</span> [app<span class="regexp">/src/</span>debug/rs]</span><br><span class="line">JNI <span class="attr">sources:</span> [app<span class="regexp">/src/</span>debug/jni]</span><br><span class="line">JNI <span class="attr">libraries:</span> [app<span class="regexp">/src/</span>debug/jniLibs]</span><br><span class="line">Java-style <span class="attr">resources:</span> [app<span class="regexp">/src/</span>debug/resources]</span><br><span class="line"></span><br><span class="line">main</span><br><span class="line">----</span><br><span class="line">Compile <span class="attr">configuration:</span> compile</span><br><span class="line">build.gradle <span class="attr">name:</span> android.sourceSets.main</span><br><span class="line">Java <span class="attr">sources:</span> [app<span class="regexp">/src/</span>main/java]</span><br><span class="line">Manifest <span class="attr">file:</span> app<span class="regexp">/src/</span>main/AndroidManifest.xml</span><br><span class="line">Android <span class="attr">resources:</span> [app<span class="regexp">/src/</span>main/res]</span><br><span class="line"><span class="attr">Assets:</span> [app<span class="regexp">/src/</span>main/assets]</span><br><span class="line">AIDL <span class="attr">sources:</span> [app<span class="regexp">/src/</span>main/aidl]</span><br><span class="line">RenderScript <span class="attr">sources:</span> [app<span class="regexp">/src/</span>main/rs]</span><br><span class="line">JNI <span class="attr">sources:</span> [app<span class="regexp">/src/</span>main/jni]</span><br><span class="line">JNI <span class="attr">libraries:</span> [app<span class="regexp">/src/</span>main/jniLibs]</span><br><span class="line">Java-style <span class="attr">resources:</span> [app<span class="regexp">/src/</span>main/resources]</span><br><span class="line"></span><br><span class="line">myflavor</span><br><span class="line">--------</span><br><span class="line">Compile <span class="attr">configuration:</span> myflavorCompile</span><br><span class="line">build.gradle <span class="attr">name:</span> android.sourceSets.myflavor</span><br><span class="line">Java <span class="attr">sources:</span> [app<span class="regexp">/src/</span>myflavor/java]</span><br><span class="line">Manifest <span class="attr">file:</span> app<span class="regexp">/src/</span>myflavor/AndroidManifest.xml</span><br><span class="line">Android <span class="attr">resources:</span> [app<span class="regexp">/src/</span>myflavor/res]</span><br><span class="line"><span class="attr">Assets:</span> [app<span class="regexp">/src/</span>myflavor/assets]</span><br><span class="line">AIDL <span class="attr">sources:</span> [app<span class="regexp">/src/</span>myflavor/aidl]</span><br><span class="line">RenderScript <span class="attr">sources:</span> [app<span class="regexp">/src/</span>myflavor/rs]</span><br><span class="line">JNI <span class="attr">sources:</span> [app<span class="regexp">/src/</span>myflavor/jni]</span><br><span class="line">JNI <span class="attr">libraries:</span> [app<span class="regexp">/src/</span>myflavor/jniLibs]</span><br><span class="line">Java-style <span class="attr">resources:</span> [app<span class="regexp">/src/</span>myflavor/resources]</span><br><span class="line"></span><br><span class="line">myflavorDebug</span><br><span class="line">-------------</span><br><span class="line">Compile <span class="attr">configuration:</span> myflavorDebugCompile</span><br><span class="line">build.gradle <span class="attr">name:</span> android.sourceSets.myflavorDebug</span><br><span class="line">Java <span class="attr">sources:</span> [app<span class="regexp">/src/</span>myflavorDebug/java]</span><br><span class="line">Manifest <span class="attr">file:</span> app<span class="regexp">/src/</span>myflavorDebug/AndroidManifest.xml</span><br><span class="line">Android <span class="attr">resources:</span> [app<span class="regexp">/src/</span>myflavorDebug/res]</span><br><span class="line"><span class="attr">Assets:</span> [app<span class="regexp">/src/</span>myflavorDebug/assets]</span><br><span class="line">AIDL <span class="attr">sources:</span> [app<span class="regexp">/src/</span>myflavorDebug/aidl]</span><br><span class="line">RenderScript <span class="attr">sources:</span> [app<span class="regexp">/src/</span>myflavorDebug/rs]</span><br><span class="line">JNI <span class="attr">sources:</span> [app<span class="regexp">/src/</span>myflavorDebug/jni]</span><br><span class="line">JNI <span class="attr">libraries:</span> [app<span class="regexp">/src/</span>myflavorDebug/jniLibs]</span><br><span class="line">Java-style <span class="attr">resources:</span> [app<span class="regexp">/src/</span>myflavorDebug/resources]</span><br><span class="line"></span><br><span class="line">myflavorRelease</span><br><span class="line">---------------</span><br><span class="line">Compile <span class="attr">configuration:</span> myflavorReleaseCompile</span><br><span class="line">build.gradle <span class="attr">name:</span> android.sourceSets.myflavorRelease</span><br><span class="line">Java <span class="attr">sources:</span> [app<span class="regexp">/src/</span>myflavorRelease/java]</span><br><span class="line">Manifest <span class="attr">file:</span> app<span class="regexp">/src/</span>myflavorRelease/AndroidManifest.xml</span><br><span class="line">Android <span class="attr">resources:</span> [app<span class="regexp">/src/</span>myflavorRelease/res]</span><br><span class="line"><span class="attr">Assets:</span> [app<span class="regexp">/src/</span>myflavorRelease/assets]</span><br><span class="line">AIDL <span class="attr">sources:</span> [app<span class="regexp">/src/</span>myflavorRelease/aidl]</span><br><span class="line">RenderScript <span class="attr">sources:</span> [app<span class="regexp">/src/</span>myflavorRelease/rs]</span><br><span class="line">JNI <span class="attr">sources:</span> [app<span class="regexp">/src/</span>myflavorRelease/jni]</span><br><span class="line">JNI <span class="attr">libraries:</span> [app<span class="regexp">/src/</span>myflavorRelease/jniLibs]</span><br><span class="line">Java-style <span class="attr">resources:</span> [app<span class="regexp">/src/</span>myflavorRelease/resources]</span><br><span class="line"></span><br><span class="line">release</span><br><span class="line">-------</span><br><span class="line">Compile <span class="attr">configuration:</span> releaseCompile</span><br><span class="line">build.gradle <span class="attr">name:</span> android.sourceSets.release</span><br><span class="line">Java <span class="attr">sources:</span> [app<span class="regexp">/src/</span>release/java]</span><br><span class="line">Manifest <span class="attr">file:</span> app<span class="regexp">/src/</span>release/AndroidManifest.xml</span><br><span class="line">Android <span class="attr">resources:</span> [app<span class="regexp">/src/</span>release/res]</span><br><span class="line"><span class="attr">Assets:</span> [app<span class="regexp">/src/</span>release/assets]</span><br><span class="line">AIDL <span class="attr">sources:</span> [app<span class="regexp">/src/</span>release/aidl]</span><br><span class="line">RenderScript <span class="attr">sources:</span> [app<span class="regexp">/src/</span>release/rs]</span><br><span class="line">JNI <span class="attr">sources:</span> [app<span class="regexp">/src/</span>release/jni]</span><br><span class="line">JNI <span class="attr">libraries:</span> [app<span class="regexp">/src/</span>release/jniLibs]</span><br><span class="line">Java-style <span class="attr">resources:</span> [app<span class="regexp">/src/</span>release/resources]</span><br><span class="line"></span><br><span class="line">test</span><br><span class="line">----</span><br><span class="line">Compile <span class="attr">configuration:</span> testCompile</span><br><span class="line">build.gradle <span class="attr">name:</span> android.sourceSets.test</span><br><span class="line">Java <span class="attr">sources:</span> [app<span class="regexp">/src/</span>test/java]</span><br><span class="line">Java-style <span class="attr">resources:</span> [app<span class="regexp">/src/</span>test/resources]</span><br><span class="line"></span><br><span class="line">testDebug</span><br><span class="line">---------</span><br><span class="line">Compile <span class="attr">configuration:</span> testDebugCompile</span><br><span class="line">build.gradle <span class="attr">name:</span> android.sourceSets.testDebug</span><br><span class="line">Java <span class="attr">sources:</span> [app<span class="regexp">/src/</span>testDebug/java]</span><br><span class="line">Java-style <span class="attr">resources:</span> [app<span class="regexp">/src/</span>testDebug/resources]</span><br><span class="line"></span><br><span class="line">testMyflavor</span><br><span class="line">------------</span><br><span class="line">Compile <span class="attr">configuration:</span> testMyflavorCompile</span><br><span class="line">build.gradle <span class="attr">name:</span> android.sourceSets.testMyflavor</span><br><span class="line">Java <span class="attr">sources:</span> [app<span class="regexp">/src/</span>testMyflavor/java]</span><br><span class="line">Java-style <span class="attr">resources:</span> [app<span class="regexp">/src/</span>testMyflavor/resources]</span><br><span class="line"></span><br><span class="line">testMyflavorDebug</span><br><span class="line">-----------------</span><br><span class="line">Compile <span class="attr">configuration:</span> testMyflavorDebugCompile</span><br><span class="line">build.gradle <span class="attr">name:</span> android.sourceSets.testMyflavorDebug</span><br><span class="line">Java <span class="attr">sources:</span> [app<span class="regexp">/src/</span>testMyflavorDebug/java]</span><br><span class="line">Java-style <span class="attr">resources:</span> [app<span class="regexp">/src/</span>testMyflavorDebug/resources]</span><br><span class="line"></span><br><span class="line">testMyflavorRelease</span><br><span class="line">-------------------</span><br><span class="line">Compile <span class="attr">configuration:</span> testMyflavorReleaseCompile</span><br><span class="line">build.gradle <span class="attr">name:</span> android.sourceSets.testMyflavorRelease</span><br><span class="line">Java <span class="attr">sources:</span> [app<span class="regexp">/src/</span>testMyflavorRelease/java]</span><br><span class="line">Java-style <span class="attr">resources:</span> [app<span class="regexp">/src/</span>testMyflavorRelease/resources]</span><br><span class="line"></span><br><span class="line">testRelease</span><br><span class="line">-----------</span><br><span class="line">Compile <span class="attr">configuration:</span> testReleaseCompile</span><br><span class="line">build.gradle <span class="attr">name:</span> android.sourceSets.testRelease</span><br><span class="line">Java <span class="attr">sources:</span> [app<span class="regexp">/src/</span>testRelease/java]</span><br><span class="line">Java-style <span class="attr">resources:</span> [app<span class="regexp">/src/</span>testRelease/resources]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">BUILD SUCCESSFUL</span><br><span class="line"></span><br><span class="line">Total <span class="attr">time:</span> <span class="number">1.041</span> secs</span><br></pre></td></tr></table></figure>
<h3 id="SourceSet的合并、Manifest合并">SourceSet的合并、Manifest合并</h3>
<p>对于某个具体的编译任务中某一类源文件，会根据一定的优先级与合并规则，对多个SourceSet中的同类源文件进行合并得到。</p>
<p>一般情况下，优先级从高到底分别是：</p>
<ul>
<li>BuildVariant（src/armFreeappDebug）</li>
<li>BuildType（src/debug）</li>
<li>MultiFlavor（src/armFreeapp）</li>
<li>每个单独的Flavor（src/arm, src/freeapp）</li>
<li>sourceSet.main（src/main）</li>
<li>依赖中的对应文件（JAR、AAR或SubProject中解析出来的源文件）</li>
</ul>
<p>对于Java类、drawable目录下的图片资源文件、layout等，合并措施一般就是同名文件直接覆盖。</p>
<p>对于values目录下的标签类型资源，合并时会以每个标签为最小单元进行覆盖。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 多个SourceSet都定义了同名style标签，则高优先级会直接覆盖低优先级 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- src/debug/res/values/xxx.xml  高优先级 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">&quot;txt_main&quot;</span>&gt;</span><span class="xml"></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;android:textSize&quot;</span>&gt;</span>12sp<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- src/main/res/values/yyy.xml  低优先级 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">&quot;txt_main&quot;</span>&gt;</span><span class="xml"></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;android:textSize&quot;</span>&gt;</span>14sp<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;android:textColor&quot;</span>&gt;</span>@android:color/white<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 合并后 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">&quot;txt_main&quot;</span>&gt;</span><span class="xml"></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;android:textSize&quot;</span>&gt;</span>12sp<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>而Manifest文件的合并规则更复杂一些。具体可参考官方文档：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://developer.android.com/studio/build/manifest-merge.html">https://developer.android.com/studio/build/manifest-merge.html</a></p>
</blockquote>
<h2 id="Android-Gradle-Task">Android Gradle Task</h2>
<p>Android Gradle环境下，有下面几个常见的Task。</p>
<ul>
<li>assemble：Gradle内建的编译任务（生成APK / JAR / AAR）</li>
<li>test：Gradle内建的测试任务</li>
<li>lint：Android定义的Lint检查任务</li>
<li>check：Gradle内建的检查任务，依赖lint、test</li>
<li>build：Gradle内建的Build任务，依赖assemble、check</li>
</ul>
<p>结合ProductFlavor、BuildType、BuildVariant，又会组合成很多Task。</p>
<p>这些Task的依赖关系示例如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">app:build</span><br><span class="line">        app:check</span><br><span class="line">                app:lint</span><br><span class="line">                app:test</span><br><span class="line">                        app:testMyflavor2DebugUnitTest</span><br><span class="line">                        app:testMyflavor2ReleaseUnitTest</span><br><span class="line">                        app:testMyflavor1DebugUnitTest</span><br><span class="line">                        app:testMyflavor1ReleaseUnitTest</span><br><span class="line">        app:assemble</span><br><span class="line">                app:assembleDebug</span><br><span class="line">                        app:assembleMyflavor2Debug</span><br><span class="line">                        app:assembleMyflavor1Debug</span><br><span class="line">                app:assembleRelease</span><br><span class="line">                        app:assembleMyflavor1Release</span><br><span class="line">                        app:assembleMyflavor2Release</span><br></pre></td></tr></table></figure>
<h2 id="Android-Studio-IDEA相关">Android Studio/IDEA相关</h2>
<p>在Android Studio/IDEA中开发时，会在Build Variants窗口选择指定的Build参数，例如myflavor1Debug。</p>
<h3 id="Sync-Project-With-Gradle-Files">Sync Project With Gradle Files</h3>
<p>当修改了gradle文件等情况，会提示：</p>
<blockquote>
<p>Gradle files have changed since last project sync. A project sync may be necessary for the IDE to work properly.</p>
</blockquote>
<p>此时点击提示栏中的Sync，会触发Gradle同步操作。刚打开工程，或者手动选择菜单Tools-Android-Sync Project With Gradle Files或工具栏中的同步按钮，也会触发同步操作。</p>
<p>在同步过程中，Gradle会执行很多任务，包括解析并下载所有依赖项，解压AAR、合并SourceSet、生成BuildConfig、R文件（结果会输出到build目录）等，这样Android Studio就能加载所有引用的class、jar文件，对源码进行语法解析，从而代码也可以正常的跳转了。</p>
<p>通过GradleConsole窗口，可以看到同步过程中Gradle所执行的Task，其中最主要的是<code>generateMyflavor1DebugSources</code>，即生成源码的过程，依赖了prepareMyflavor1DebugDependencies、generateMyflavor1DebugBuildConfig、generateMyflavor1DebugResValues等Task。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">:app:preBuild UP-TO-DATE</span><br><span class="line">:app:preMyflavor1DebugBuild UP-TO-DATE</span><br><span class="line">:app:checkMyflavor1DebugManifest</span><br><span class="line">:app:preMyflavor1ReleaseBuild UP-TO-DATE</span><br><span class="line">:app:preMyflavor2DebugBuild UP-TO-DATE</span><br><span class="line">:app:preMyflavor2ReleaseBuild UP-TO-DATE</span><br><span class="line">:app:prepareComAndroidSupportAnimatedVectorDrawable2400Library</span><br><span class="line">:app:prepareComAndroidSupportAppcompatV72400Library</span><br><span class="line">:app:prepareComAndroidSupportConstraintConstraintLayout102Library</span><br><span class="line">:app:prepareComAndroidSupportSupportV42400Library</span><br><span class="line">:app:prepareComAndroidSupportSupportVectorDrawable2400Library</span><br><span class="line">:app:prepareComFacebookFrescoDrawee0100Library</span><br><span class="line">:app:prepareComFacebookFrescoFbcore0100Library</span><br><span class="line">:app:prepareComFacebookFrescoFresco0100Library</span><br><span class="line">:app:prepareComFacebookFrescoImagepipeline0100Library</span><br><span class="line">:app:prepareComFacebookFrescoImagepipelineBase0100Library</span><br><span class="line">:app:prepareMyflavor1DebugDependencies</span><br><span class="line">:app:compileMyflavor1DebugAidl</span><br><span class="line">:app:compileMyflavor1DebugRenderscript</span><br><span class="line">:app:generateMyflavor1DebugBuildConfig</span><br><span class="line">:app:generateMyflavor1DebugResValues</span><br><span class="line">:app:generateMyflavor1DebugResources</span><br><span class="line">:app:mergeMyflavor1DebugResources</span><br><span class="line">:app:processMyflavor1DebugManifest</span><br><span class="line">:app:processMyflavor1DebugResources</span><br><span class="line">:app:generateMyflavor1DebugSources</span><br><span class="line">:app:preMyflavor1DebugAndroidTestBuild UP-TO-DATE</span><br><span class="line">:app:prepareMyflavor1DebugAndroidTestDependencies</span><br><span class="line">:app:compileMyflavor1DebugAndroidTestAidl</span><br><span class="line">:app:processMyflavor1DebugAndroidTestManifest</span><br><span class="line">:app:compileMyflavor1DebugAndroidTestRenderscript</span><br><span class="line">:app:generateMyflavor1DebugAndroidTestBuildConfig</span><br><span class="line">:app:generateMyflavor1DebugAndroidTestResValues</span><br><span class="line">:app:generateMyflavor1DebugAndroidTestResources</span><br><span class="line">:app:mergeMyflavor1DebugAndroidTestResources</span><br><span class="line">:app:processMyflavor1DebugAndroidTestResources</span><br><span class="line">:app:generateMyflavor1DebugAndroidTestSources</span><br><span class="line">:app:mockableAndroidJar UP-TO-DATE</span><br><span class="line">:app:preMyflavor1DebugUnitTestBuild UP-TO-DATE</span><br><span class="line">:app:prepareMyflavor1DebugUnitTestDependencies</span><br><span class="line"></span><br><span class="line">BUILD SUCCESSFUL</span><br><span class="line"></span><br><span class="line">Total time: 6.425 secs</span><br></pre></td></tr></table></figure>
<h3 id="Run">Run</h3>
<p>点击三角形箭头时，除了执行assembleMyflavor1Debug，还会执行install（将APK安装至设备）等Task。</p>
<p>在Android Studio的Run/Debug Configuration窗口中，还可以指定点击三角箭头时要执行的Gradle Task。例如可以添加一个clean操作，每次编译前先用clean清理build目录。</p>
<h2 id="AAR多版本发布">AAR多版本发布</h2>
<p>Android开发经常会用到AAR，有时候希望AAR能支持发布多个版本，并在不同的情况下依赖不同版本（包括不同的BuildType和ProductFlavor）。例如主工程依赖xxLibrary，希望Debug版本APK依赖Debug版本的AAR，而Release版本APK依赖Release版本的AAR。</p>
<p>在Android中依赖SubProject或AAR时，如果没有特殊配置，AAR的发布和模块依赖默认均为Release版本。</p>
<blockquote>
<p>实际尝试主工程依赖子工程，子工程中读取<code>BuildConfig.DEBUG</code>的值始终是false，修改Android Studio中子模块的BuildVariant配置也没有效果。</p>
</blockquote>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">compile project(<span class="string">&#x27;:xxx_library&#x27;</span>)</span><br><span class="line">compile <span class="string">&#x27;com.xxx:xxx:1.0.5@aar&#x27;</span> &#123;</span><br><span class="line">    transitive = <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可用如下方式配置子模块或者独立AAR工程发布所有版本：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">apply <span class="attr">plugin:</span> <span class="string">&#x27;com.android.library&#x27;</span></span><br><span class="line"></span><br><span class="line">android &#123;</span><br><span class="line"><span class="comment">// 发布非默认版本</span></span><br><span class="line">    publishNonDefault <span class="literal">true</span></span><br><span class="line">    <span class="comment">// 指定默认版本，发布AAR到Maven时会从默认版本生成POM依赖配置。</span></span><br><span class="line">    <span class="comment">// 不指定会导致POM无法正确生成，从而依赖不能传递。</span></span><br><span class="line">    defaultPublishConfig <span class="string">&quot;falvorARelease&quot;</span></span><br><span class="line"></span><br><span class="line">    productFlavors &#123;</span><br><span class="line">        flavorA &#123; &#125;</span><br><span class="line">        flavorB &#123; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>用下面的方式依赖子模块或已经发布的AAR：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Debug、Release版本APK，分别依赖Debug、Release版本子模块</span></span><br><span class="line">    debugCompile project(<span class="attr">path:</span> <span class="string">&#x27;:xxx&#x27;</span>, <span class="attr">configuration:</span> <span class="string">&#x27;flavorADebug&#x27;</span>)</span><br><span class="line">    releaseCompile project(<span class="attr">path:</span> <span class="string">&#x27;:xxx&#x27;</span>, <span class="attr">configuration:</span> <span class="string">&#x27;flavorARelease&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 指定依赖aar版本，并设置transitive为true</span></span><br><span class="line">    debugCompile(<span class="string">&#x27;com.xxx:library:1.0.5:flavorADebug@aar&#x27;</span>) &#123;</span><br><span class="line">    transitive = <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    releaseCompile(<span class="string">&#x27;com.xxx:library:1.0.5:flavorARelease@aar&#x27;</span>) &#123;</span><br><span class="line">    transitive = <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

    </div>

    
    
    
      
  <div class="popular-posts-header">相关文章</div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/gradle-develop-basics/" rel="bookmark">Gradle开发快速入门——DSL语法原理与常用API介绍</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/gradle-plugin-and-principle/" rel="bookmark">Gradle插件开发与执行原理浅析</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/gradle-dependencies/" rel="bookmark">Gradle依赖项学习总结，dependencies、transitive、force、exclude的使用与依赖冲突解决</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/gradle-download-jar-file/" rel="bookmark">Gradle不能下载jar包的解决思路</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/android-lint-2-implements/" rel="bookmark">Android Lint：自定义Lint调试与开发</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/android-lint-1-usage/" rel="bookmark">Android Lint：基本使用与配置</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/nine-patch-usage/" rel="bookmark">NinePatch图（9-Patch图，.9图）使用全面介绍</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/android-bitmap/" rel="bookmark">Android Bitmap操作内存问题总结(图片处理、截屏等)</a></div>
    </li>
  </ul>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Android/" rel="tag"># Android</a>
              <a href="/tags/%E5%AE%89%E5%8D%93/" rel="tag"># 安卓</a>
              <a href="/tags/%E7%A7%BB%E5%8A%A8%E5%BC%80%E5%8F%91/" rel="tag"># 移动开发</a>
              <a href="/tags/%E7%BC%96%E7%A8%8B/" rel="tag"># 编程</a>
              <a href="/tags/Gradle/" rel="tag"># Gradle</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/nine-patch-usage/" rel="prev" title="NinePatch图（9-Patch图，.9图）使用全面介绍">
      <i class="fa fa-chevron-left"></i> NinePatch图（9-Patch图，.9图）使用全面介绍
    </a></div>
      <div class="post-nav-item">
    <a href="/gradle-develop-basics/" rel="next" title="Gradle开发快速入门——DSL语法原理与常用API介绍">
      Gradle开发快速入门——DSL语法原理与常用API介绍 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AF%B4%E6%98%8E"><span class="nav-number">1.</span> <span class="nav-text">说明</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E9%97%AE%E9%A2%98"><span class="nav-number">2.</span> <span class="nav-text">基本问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Gradle"><span class="nav-number">3.</span> <span class="nav-text">Gradle</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Gradle-Wrapper"><span class="nav-number">4.</span> <span class="nav-text">Gradle Wrapper</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DSL%E3%80%81DSL-Reference"><span class="nav-number">5.</span> <span class="nav-text">DSL、DSL Reference</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Project%E3%80%81RootProject%E3%80%81SubProject-Module"><span class="nav-number">6.</span> <span class="nav-text">Project、RootProject、SubProject (Module)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#StartParameter"><span class="nav-number">7.</span> <span class="nav-text">StartParameter</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#gradle-properties"><span class="nav-number">8.</span> <span class="nav-text">gradle.properties</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Gradle-Task"><span class="nav-number">9.</span> <span class="nav-text">Gradle Task</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%A7%E8%A1%8CTask%EF%BC%8C%E6%9F%A5%E7%9C%8BProject%E4%B8%AD%E7%9A%84%E6%89%80%E6%9C%89Task"><span class="nav-number">9.1.</span> <span class="nav-text">执行Task，查看Project中的所有Task</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%A7%E8%A1%8C%E5%A4%9A%E4%B8%AATask"><span class="nav-number">9.2.</span> <span class="nav-text">执行多个Task</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8E%92%E9%99%A4%E7%89%B9%E5%AE%9ATask"><span class="nav-number">9.3.</span> <span class="nav-text">排除特定Task</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%A7%E8%A1%8CSubProject%E4%B8%AD%E7%9A%84Task"><span class="nav-number">9.4.</span> <span class="nav-text">执行SubProject中的Task</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Task%E5%8F%82%E6%95%B0%E3%80%81%E6%9F%A5%E7%9C%8BTask%E8%AF%A6%E7%BB%86%E4%BF%A1%E6%81%AF"><span class="nav-number">9.5.</span> <span class="nav-text">Task参数、查看Task详细信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%80%E4%BA%9B%E5%B8%B8%E7%94%A8GradleTask"><span class="nav-number">9.6.</span> <span class="nav-text">一些常用GradleTask</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8BTask%E4%BE%9D%E8%B5%96%E6%A0%91"><span class="nav-number">9.7.</span> <span class="nav-text">查看Task依赖树</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#buildscript%E4%B8%8Eallprojects"><span class="nav-number">10.</span> <span class="nav-text">buildscript与allprojects</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B3%E4%BA%8E%E7%BC%96%E8%AF%91%E4%B8%8EGroovy"><span class="nav-number">10.1.</span> <span class="nav-text">关于编译与Groovy</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Gradle-Plugin"><span class="nav-number">11.</span> <span class="nav-text">Gradle Plugin</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Gradle-Android-Plugin"><span class="nav-number">11.1.</span> <span class="nav-text">Gradle Android Plugin</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Repositories"><span class="nav-number">12.</span> <span class="nav-text">Repositories</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dependencies"><span class="nav-number">13.</span> <span class="nav-text">Dependencies</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#DependencyNotation"><span class="nav-number">13.1.</span> <span class="nav-text">DependencyNotation</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%96%E9%83%A8%E4%BE%9D%E8%B5%96"><span class="nav-number">13.1.1.</span> <span class="nav-text">外部依赖</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Project%E4%BE%9D%E8%B5%96"><span class="nav-number">13.1.2.</span> <span class="nav-text">Project依赖</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E4%BE%9D%E8%B5%96"><span class="nav-number">13.1.3.</span> <span class="nav-text">文件依赖</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BE%9D%E8%B5%96%E4%BC%A0%E9%80%92-transitive"><span class="nav-number">13.2.</span> <span class="nav-text">依赖传递(transitive)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BE%9D%E8%B5%96%E6%A0%91%E6%9F%A5%E7%9C%8B"><span class="nav-number">13.3.</span> <span class="nav-text">依赖树查看</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Artifact"><span class="nav-number">13.4.</span> <span class="nav-text">Artifact</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Module-Descriptor%E3%80%81POM%E6%96%87%E4%BB%B6"><span class="nav-number">13.5.</span> <span class="nav-text">Module Descriptor、POM文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9AArtifact%E7%9A%84%E4%BE%9D%E8%B5%96%E5%A4%84%E7%90%86%E3%80%81Artifact-only-notation"><span class="nav-number">13.6.</span> <span class="nav-text">多Artifact的依赖处理、Artifact only notation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BE%9D%E8%B5%96%E5%86%B2%E7%AA%81%E5%88%86%E8%A7%A3"><span class="nav-number">13.7.</span> <span class="nav-text">依赖冲突分解</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ProductFlavor%E3%80%81BuildType%E4%B8%8EBuild-Variant"><span class="nav-number">14.</span> <span class="nav-text">ProductFlavor、BuildType与Build Variant</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ProductFlavor"><span class="nav-number">14.1.</span> <span class="nav-text">ProductFlavor</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#BuildType"><span class="nav-number">14.2.</span> <span class="nav-text">BuildType</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#BuildVariant"><span class="nav-number">14.3.</span> <span class="nav-text">BuildVariant</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#BuildConfig"><span class="nav-number">15.</span> <span class="nav-text">BuildConfig</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Configurations"><span class="nav-number">16.</span> <span class="nav-text">Configurations</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SourceSet"><span class="nav-number">17.</span> <span class="nav-text">SourceSet</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#SourceSet%E7%9A%84%E5%90%88%E5%B9%B6%E3%80%81Manifest%E5%90%88%E5%B9%B6"><span class="nav-number">17.1.</span> <span class="nav-text">SourceSet的合并、Manifest合并</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Android-Gradle-Task"><span class="nav-number">18.</span> <span class="nav-text">Android Gradle Task</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Android-Studio-IDEA%E7%9B%B8%E5%85%B3"><span class="nav-number">19.</span> <span class="nav-text">Android Studio&#x2F;IDEA相关</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Sync-Project-With-Gradle-Files"><span class="nav-number">19.1.</span> <span class="nav-text">Sync Project With Gradle Files</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Run"><span class="nav-number">19.2.</span> <span class="nav-text">Run</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#AAR%E5%A4%9A%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83"><span class="nav-number">20.</span> <span class="nav-text">AAR多版本发布</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">jzj1993</p>
  <div class="site-description" itemprop="description">江子健的个人博客，90后理工男、微软程序员、互联网从业者，分享软件编程、开发技术、学习与思考</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">263</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">108</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/jzj1993" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;jzj1993" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      友情链接
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="http://www.dappchaser.com/" title="http:&#x2F;&#x2F;www.dappchaser.com" rel="noopener" target="_blank">DAppChaser</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.chenwenguan.com/" title="https:&#x2F;&#x2F;www.chenwenguan.com&#x2F;" rel="noopener" target="_blank">陈文管的博客</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://yifeiyuan.me/" title="http:&#x2F;&#x2F;yifeiyuan.me&#x2F;" rel="noopener" target="_blank">程序亦非猿</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.trinea.cn/" title="https:&#x2F;&#x2F;www.trinea.cn&#x2F;" rel="noopener" target="_blank">Trinea</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://blog.weshinekx.cn/" title="https:&#x2F;&#x2F;blog.weshinekx.cn&#x2F;" rel="noopener" target="_blank">Shinya</a>
        </li>
    </ul>
  </div>

      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">jzj1993</span>
</div>
  <div class="sitemap"><a href="/sitemap.xml" class="theme-link">站点地图</a>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/medium-zoom@1/dist/medium-zoom.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>

<script src="/js/utils.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : true,
      notify     : true,
      appId      : '3YlzwEecQlMdJPH9KEbFt6PX-gzGzoHsz',
      appKey     : 'raIB2P7DewB4SAboVtpHakbh',
      placeholder: "输入评论...",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '20' || 10,
      visitor    : true,
      lang       : 'zh-cn' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
